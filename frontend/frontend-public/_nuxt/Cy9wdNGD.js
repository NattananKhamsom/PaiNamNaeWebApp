import{_ as E,m as H,r as d,x as I,i as q,c as o,a as e,b as G,f as A,h as m,v as _,z,t as l,g as v,F as p,q as g,w as J,T as K,o as i,n as Q,C as F,s as W}from"./DPSIKoxe.js";import{d as k}from"./B5yDJBm8.js";import{b as X}from"./C5FTVxxA.js";import{u as Y}from"./DOK8vhV6.js";import{u as Z}from"./BaxiziUg.js";import"./Cpj98o6Y.js";const ee={class:"px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8"},te={class:"p-6 mb-8 bg-white border border-gray-300 rounded-lg shadow-md"},se={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},le={class:"lg:col-span-2"},oe={class:"bg-white border border-gray-300 rounded-lg shadow-md"},ie={class:"p-6 border-b border-gray-300"},ae={class:"text-lg font-semibold text-gray-900"},ne={key:0,class:"p-6 text-center text-gray-500"},re={key:1,class:"divide-y divide-gray-200"},de={key:0,class:"p-6 text-center text-gray-500"},ue=["onClick"],ce={class:"flex items-start space-x-4"},me=["src","alt"],ve={class:"flex-1"},pe={class:"flex items-start justify-between"},ge={class:"flex items-center"},be={class:"font-semibold text-gray-900"},fe={key:0,class:"relative group ml-1.5 flex items-center"},xe={class:"flex items-center mt-1"},ye={class:"flex text-yellow-400"},he={class:"ml-2 text-sm text-gray-600"},_e={class:"text-right"},we={class:"text-lg font-bold text-blue-600"},ke={class:"mt-3"},Le={class:"flex flex-wrap items-center text-sm text-gray-600"},Me={class:"font-medium"},Ce={class:"ml-1"},Se={class:"ml-1"},Te={class:"flex items-center mt-2 text-sm text-gray-600"},Ve={key:0,class:"pt-4 mt-4 duration-300 border-t border-gray-300 animate-in slide-in-from-top"},Ae={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Be={class:"space-y-1 text-sm text-gray-600"},$e={class:"space-y-1 text-sm text-gray-600"},je={class:"mt-4 space-y-4"},ze={key:0},Fe={class:"p-3 text-sm text-gray-700 border border-gray-300 rounded-md bg-gray-50"},De={key:1},Ne={class:"grid grid-cols-3 gap-2 mt-2"},Ue=["src"],Pe={class:"flex justify-end mt-4"},Oe=["onClick","disabled"],Re={class:"lg:col-span-1"},Ee={class:"sticky overflow-hidden bg-white border border-gray-300 rounded-lg shadow-md top-8"},He={class:"modal-content"},Ie={class:"p-6"},qe={class:"mb-6"},Ge={class:"flex items-center p-3 space-x-3 rounded-lg bg-gray-50"},Je=["src","alt"],Ke={class:"flex items-center"},Qe={class:"font-medium text-gray-900"},We={key:0,class:"relative group ml-1.5 flex items-center"},Xe={class:"flex items-center"},Ye={class:"flex text-sm text-yellow-400"},Ze={class:"ml-2 text-sm text-gray-600"},et={class:"grid grid-cols-1 gap-6 mb-6 md:grid-cols-2"},tt={class:"p-3 text-gray-900 rounded-lg bg-gray-50"},st={class:"p-3 text-gray-900 rounded-lg bg-gray-50"},lt={class:"mb-6"},ot={class:"flex items-center p-3 space-x-4 rounded-lg bg-gray-50"},it={class:"flex-1"},at={class:"font-medium text-gray-900"},nt={class:"flex-1 text-right"},rt={class:"font-medium text-gray-900"},dt={class:"mb-6 space-y-4"},ut=["value"],ct={class:"p-4 mb-6 rounded-lg bg-blue-50"},mt={class:"flex items-center justify-between mb-2"},vt={class:"font-medium text-gray-900"},pt={class:"flex items-center justify-between mb-2"},gt={class:"font-medium text-gray-900"},bt={class:"pt-2 mt-2 border-t border-gray-300"},ft={class:"flex items-center justify-between"},xt={class:"text-lg font-bold text-blue-600"},yt={__name:"indexOld",setup(ht){k.locale("th"),k.extend(X);const{$api:B}=H(),{toast:M}=W(),{token:D}=Y();Z({});const u=d({origin:"",destination:"",date:"",seats:"1"}),x=d([]),c=d(null),C=d(!1),S=d(null);let T=null;const V=d(!1),a=d(null),b=d(1),y=d(""),h=d(""),N=I(()=>a.value?b.value*a.value.price:0);async function $(){C.value=!0,c.value=null;try{const t=(await B("/routes",{})).filter(s=>s.status==="AVAILABLE").map(s=>{var j;const r={name:`${s.driver.firstName} ${s.driver.lastName}`,image:s.driver.profilePicture||`https://ui-avatars.com/api/?name=${s.driver.firstName}&background=random&size=64`,rating:4.5,reviews:Math.floor(Math.random()*50)+5,isVerified:s.driver.isVerified},f=[];return s.vehicle?(f.push(`${s.vehicle.vehicleModel} (${s.vehicle.vehicleType})`),s.vehicle.amenities&&s.vehicle.amenities.length>0&&f.push(...s.vehicle.amenities)):f.push("ไม่มีข้อมูลรถ"),{id:s.id,availableSeats:s.availableSeats,price:s.pricePerSeat,departureTime:k(s.departureTime).format("HH:mm น."),date:k(s.departureTime).format("D MMMM BBBB"),origin:`จาก Lat: ${s.startLocation.lat.toFixed(2)}, Lng: ${s.startLocation.lng.toFixed(2)}`,destination:`ถึง Lat: ${s.endLocation.lat.toFixed(2)}, Lng: ${s.endLocation.lng.toFixed(2)}`,driver:r,carDetails:f,conditions:s.conditions,photos:(j=s.vehicle)==null?void 0:j.photos,stops:["จุดแวะพัก (รอข้อมูล)"],duration:s.duration||"ประมาณ 8 ชั่วโมง",coordinates:[[s.startLocation.lat,s.startLocation.lng],[s.endLocation.lat,s.endLocation.lng]]}});x.value=t}catch(n){console.error("Failed to fetch routes:",n),x.value=[]}finally{C.value=!1}}const U=n=>{c.value&&c.value.id===n.id?c.value=null:c.value=n};function P(n){if(!D.value)return F("/login");n&&n.availableSeats>0&&(a.value=n,b.value=1,y.value="",h.value="",V.value=!0)}function w(){V.value=!1,setTimeout(()=>{a.value=null},300)}async function O(){var t;if(!a.value)return;if(!y.value.trim()||!h.value.trim()){M.warning("ข้อมูลไม่ครบถ้วน","กรุณากรอกข้อมูลจุดรับและจุดส่งให้ครบถ้วน");return}const n={routeId:a.value.id,numberOfSeats:b.value,pickupLocation:{name:y.value,lat:16.432,lng:102.833},dropoffLocation:{name:h.value,lat:16.456,lng:102.876}};try{await B("/bookings",{method:"POST",body:n}),w(),M.success("ส่งคำขอจองสำเร็จ!","คำขอของคุณถูกส่งไปให้ผู้ขับแล้ว โปรดรอการยืนยัน"),setTimeout(()=>{F("/myTrip")},1500)}catch(s){console.error("Failed to create booking:",s),M.error("เกิดข้อผิดพลาดในการจอง",((t=s.data)==null?void 0:t.message)||"โปรดลองใหม่อีกครั้งในภายหลัง")}}const R=()=>{if(!(typeof L>"u"||!S.value||T))try{T=L.map(S.value).setView([13.7563,100.5018],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(T)}catch(n){console.error("Error initializing map:",n)}};return q(()=>{window.L&&R(),$()}),(n,t)=>(i(),o("div",null,[e("div",ee,[e("div",te,[t[13]||(t[13]=e("h2",{class:"mb-6 text-xl font-semibold text-gray-900"},"ค้นหาการเดินทาง",-1)),e("form",{onSubmit:A($,["prevent"]),class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"จุดเริ่มต้น",-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value.origin=s),type:"text",placeholder:"เช่น กรุงเทพฯ",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,u.value.origin]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"จุดปลายทาง",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value.destination=s),type:"text",placeholder:"เช่น เชียงใหม่",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,u.value.destination]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"วันที่",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>u.value.date=s),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,u.value.date]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"จำนวนที่นั่ง",-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value.seats=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},t[10]||(t[10]=[e("option",{value:"1"},"1 ที่นั่ง",-1),e("option",{value:"2"},"2 ที่นั่ง",-1),e("option",{value:"3"},"3 ที่นั่ง",-1),e("option",{value:"4"},"4 ที่นั่ง",-1)]),512),[[z,u.value.seats]])]),t[12]||(t[12]=e("div",{class:"flex items-end"},[e("button",{type:"submit",class:"w-full px-4 py-2 text-white transition duration-200 bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," ค้นหา ")],-1))],32)]),e("div",se,[e("div",le,[e("div",oe,[e("div",ie,[e("h3",ae,"ผลการค้นหา ("+l(x.value.length)+" รายการ)",1)]),C.value?(i(),o("div",ne," กำลังค้นหาเส้นทาง... ")):(i(),o("div",re,[x.value.length===0?(i(),o("div",de," ไม่พบเส้นทางที่ค้นหา ")):v("",!0),(i(!0),o(p,null,g(x.value,s=>(i(),o("div",{key:s.id,class:"p-6 transition-all duration-300 cursor-pointer route-card hover:shadow-lg",onClick:r=>U(s)},[e("div",ce,[e("img",{src:s.driver.image,alt:s.driver.name,class:"object-cover w-12 h-12 rounded-full"},null,8,me),e("div",ve,[e("div",pe,[e("div",null,[e("div",ge,[e("h4",be,l(s.driver.name),1),s.driver.isVerified?(i(),o("div",fe,t[14]||(t[14]=[e("svg",{class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.603 3.799A4.49 4.49 0 0112 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 013.498 1.307 4.491 4.491 0 011.307 3.497A4.49 4.49 0 0121.75 12c0 1.357-.6 2.573-1.549 3.397a4.49 4.49 0 01-1.307 3.498 4.491 4.491 0 01-3.497 1.307A4.49 4.49 0 0112 21.75a4.49 4.49 0 01-3.397-1.549 4.49 4.49 0 01-3.498-1.306 4.491 4.491 0 01-1.307-3.498A4.49 4.49 0 012.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 011.307-3.497 4.49 4.49 0 013.497-1.307zm7.007 6.387a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.07-.01l3.5-4.875z","clip-rule":"evenodd"})],-1),e("span",{class:"absolute px-2 py-1 mb-2 text-xs text-white transition-opacity -translate-x-1/2 bg-gray-800 rounded-md opacity-0 pointer-events-none bottom-full left-1/2 w-max group-hover:opacity-100"}," ผู้ขับขี่ยืนยันตัวตนแล้ว ",-1)]))):v("",!0)]),e("div",xe,[e("div",ye,[(i(),o(p,null,g(5,r=>e("span",{key:r},l(r<=s.driver.rating?"★":"☆"),1)),64))]),e("span",he,l(s.driver.rating)+" ("+l(s.driver.reviews)+" รีวิว) ",1)])]),e("div",_e,[e("div",we,l(s.price)+" บาท",1),t[15]||(t[15]=e("div",{class:"text-sm text-gray-600"},"ต่อที่นั่ง",-1))])]),e("div",ke,[e("div",Le,[e("span",Me,l(s.date),1),t[16]||(t[16]=e("span",{class:"mx-2 text-gray-300"},"|",-1)),t[17]||(t[17]=e("span",{class:"font-medium"},"เวลาออก:",-1)),e("span",Ce,l(s.departureTime),1),t[18]||(t[18]=e("span",{class:"mx-2 text-gray-300"},"|",-1)),t[19]||(t[19]=e("span",{class:"font-medium"},"ระยะเวลา:",-1)),e("span",Se,l(s.duration),1)]),e("div",Te,[e("span",{class:Q(["px-2 py-1 rounded-full text-xs font-medium",s.availableSeats>2?"bg-green-100 text-green-800":s.availableSeats>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},l(s.availableSeats>0?`เหลือ ${s.availableSeats}
                                                    ที่นั่ง`:"เต็มแล้ว"),3)])])])]),c.value&&c.value.id===s.id?(i(),o("div",Ve,[e("div",Ae,[e("div",null,[t[20]||(t[20]=e("h5",{class:"mb-2 font-medium text-gray-900"},"รายละเอียดเส้นทาง",-1)),e("ul",Be,[(i(!0),o(p,null,g(s.stops,r=>(i(),o("li",{key:r},"• "+l(r),1))),128))])]),e("div",null,[t[21]||(t[21]=e("h5",{class:"mb-2 font-medium text-gray-900"},"รายละเอียดรถ",-1)),e("ul",$e,[(i(!0),o(p,null,g(s.carDetails,r=>(i(),o("li",{key:r},"• "+l(r),1))),128))])])]),e("div",je,[s.conditions?(i(),o("div",ze,[t[22]||(t[22]=e("h5",{class:"mb-2 font-medium text-gray-900"},"เงื่อนไขการเดินทาง",-1)),e("p",Fe,l(s.conditions),1)])):v("",!0),s.photos&&s.photos.length>0?(i(),o("div",De,[t[23]||(t[23]=e("h5",{class:"mb-2 font-medium text-gray-900"},"รูปภาพรถยนต์",-1)),e("div",Ne,[(i(!0),o(p,null,g(s.photos.slice(0,3),(r,f)=>(i(),o("div",{key:f,class:""},[e("img",{src:r,alt:"Vehicle photo",class:"object-cover w-full transition-opacity border border-gray-300 rounded-lg shadow-sm cursor-pointer aspect-video hover:opacity-90"},null,8,Ue)]))),128))])])):v("",!0)]),e("div",Pe,[e("button",{onClick:A(r=>P(s),["stop"]),disabled:s.availableSeats===0,class:"px-6 py-2 text-white transition duration-200 bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," จองที่นั่ง ",8,Oe)])])):v("",!0)],8,ue))),128))]))])]),e("div",Re,[e("div",Ee,[t[24]||(t[24]=e("div",{class:"p-6 border-b border-gray-300"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"แผนที่เส้นทาง")],-1)),e("div",{ref_key:"mapContainer",ref:S,class:"h-96"},null,512)])])])]),G(K,{name:"modal-fade"},{default:J(()=>[V.value&&a.value?(i(),o("div",{key:0,class:"modal-overlay",onClick:A(w,["self"])},[e("div",He,[e("div",{class:"flex items-center justify-between p-6 border-b border-gray-300"},[t[26]||(t[26]=e("h3",{class:"text-xl font-semibold text-gray-900"},"ยืนยันการจอง",-1)),e("button",{onClick:w,class:"text-gray-400 hover:text-gray-600"},t[25]||(t[25]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ie,[e("div",qe,[t[28]||(t[28]=e("h4",{class:"mb-3 font-semibold text-gray-900"},"เดินทางกับ",-1)),e("div",Ge,[e("img",{src:a.value.driver.image,alt:a.value.driver.name,class:"object-cover w-12 h-12 rounded-full"},null,8,Je),e("div",null,[e("div",Ke,[e("div",Qe,l(a.value.driver.name),1),a.value.driver.isVerified?(i(),o("div",We,t[27]||(t[27]=[e("svg",{class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.603 3.799A4.49 4.49 0 0112 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 013.498 1.307 4.491 4.491 0 011.307 3.497A4.49 4.49 0 0121.75 12c0 1.357-.6 2.573-1.549 3.397a4.49 4.49 0 01-1.307 3.498 4.491 4.491 0 01-3.497 1.307A4.49 4.49 0 0112 21.75a4.49 4.49 0 01-3.397-1.549 4.49 4.49 0 01-3.498-1.306 4.491 4.491 0 01-1.307-3.498A4.49 4.49 0 012.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 011.307-3.497 4.49 4.49 0 013.497-1.307zm7.007 6.387a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.07-.01l3.5-4.875z","clip-rule":"evenodd"})],-1),e("span",{class:"absolute px-2 py-1 mb-2 text-xs text-white transition-opacity -translate-x-1/2 bg-gray-800 rounded-md opacity-0 pointer-events-none bottom-full left-1/2 w-max group-hover:opacity-100"}," ผู้ขับขี่ยืนยันตัวตนแล้ว ",-1)]))):v("",!0)]),e("div",Xe,[e("div",Ye,[(i(),o(p,null,g(5,s=>e("span",{key:s},l(s<=a.value.driver.rating?"★":"☆"),1)),64))]),e("span",Ze,l(a.value.driver.rating)+" ("+l(a.value.driver.reviews)+" รีวิว)",1)])])])]),e("div",et,[e("div",null,[t[29]||(t[29]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"วันที่เดินทาง",-1)),e("div",tt,l(a.value.date),1)]),e("div",null,[t[30]||(t[30]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"เวลาออก",-1)),e("div",st,l(a.value.departureTime),1)])]),e("div",lt,[t[34]||(t[34]=e("h4",{class:"mb-3 font-semibold text-gray-900"},"เส้นทางการเดินทาง",-1)),e("div",ot,[e("div",it,[e("div",at,l(a.value.origin),1),t[31]||(t[31]=e("div",{class:"text-sm text-gray-600"},"จุดเริ่มต้น",-1))]),t[33]||(t[33]=e("div",{class:"text-blue-600"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1)),e("div",nt,[e("div",rt,l(a.value.destination),1),t[32]||(t[32]=e("div",{class:"text-sm text-gray-600"},"จุดปลายทาง",-1))])])]),e("div",dt,[e("div",null,[t[35]||(t[35]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"จำนวนที่นั่งที่ต้องการจอง",-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>b.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[(i(!0),o(p,null,g(a.value.availableSeats,s=>(i(),o("option",{key:s,value:s},l(s)+" ที่นั่ง ",9,ut))),128))],512),[[z,b.value]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"เลือกจุดขึ้นรถ",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>y.value=s),placeholder:"กรอกเพื่อค้นหาจุดขึ้นรถ...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,y.value]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"เลือกจุดลงรถ",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),placeholder:"กรอกเพื่อค้นหาจุดลงรถ...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,h.value]])])]),e("div",ct,[e("div",mt,[t[38]||(t[38]=e("span",{class:"text-gray-700"},"ราคาต่อที่นั่ง",-1)),e("span",vt,l(a.value.price)+" บาท",1)]),e("div",pt,[t[39]||(t[39]=e("span",{class:"text-gray-700"},"จำนวนที่นั่ง",-1)),e("span",gt,l(b.value)+" ที่นั่ง",1)]),e("div",bt,[e("div",ft,[t[40]||(t[40]=e("span",{class:"font-semibold text-gray-900"},"ยอดรวม",-1)),e("span",xt,l(N.value)+" บาท",1)])])]),e("div",{class:"flex space-x-4"},[e("button",{onClick:w,class:"flex-1 px-4 py-3 font-semibold text-gray-800 transition duration-200 bg-gray-200 rounded-md hover:bg-gray-300"}," ยกเลิก "),e("button",{onClick:O,class:"flex-1 px-4 py-3 font-semibold text-white transition duration-200 bg-blue-600 rounded-md hover:bg-blue-700"}," ยืนยันการจอง ")])])])])):v("",!0)]),_:1})]))}},St=E(yt,[["__scopeId","data-v-65d7b8bf"]]);export{St as default};
