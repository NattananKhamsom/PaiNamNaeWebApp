import{r as w,A as q,x as j,i as re,H as de,c as u,b as $,a as t,h as p,v as L,I as ce,z as M,e as ue,t as d,g as me,F as I,q as P,y as Y,J as K,s as pe,C as S,o as m,d as y,n as T}from"./DPSIKoxe.js";import{u as ge}from"./BaxiziUg.js";import{d as V}from"./B5yDJBm8.js";import{b as xe}from"./C5FTVxxA.js";import{A as fe,_ as ye}from"./CaCOxDSn.js";import{C as ve}from"./CL2Ezi0q.js";import"./Cpj98o6Y.js";import"./Lcixqshc.js";import"./DOK8vhV6.js";const be={class:""},he={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},_e={class:"mx-auto max-w-8xl"},we={class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},Le={class:"flex items-center gap-2"},ke={class:"mb-4 bg-white border border-gray-300 rounded-lg shadow-sm"},Ce={class:"grid grid-cols-1 gap-3 px-4 py-4 sm:px-6 lg:grid-cols-[repeat(24,minmax(0,1fr))]"},Ae={class:"lg:col-span-5"},Ee={class:"lg:col-span-5"},Be={class:"lg:col-span-4"},Ne={class:"lg:col-span-5"},$e={class:"lg:col-span-5"},Me={class:"lg:col-span-4"},Ie={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Se={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 sm:px-6"},Te={class:"text-sm text-gray-600"},Ve={key:0,class:"p-8 text-center text-gray-500"},Re={key:1,class:"p-8 text-center text-red-600"},De={key:2,class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200"},Fe={class:"bg-white divide-y divide-gray-200"},ze={class:"px-4 py-3"},He={class:"flex items-start gap-3"},qe={class:"flex-1"},je={class:"font-medium text-gray-900"},Pe={class:"text-xs text-gray-500"},Ye={class:"px-4 py-3"},Ke={class:"flex items-center gap-3"},Oe=["src"],Ge={class:"font-medium text-gray-900"},Je={class:"text-xs text-gray-500"},We={class:"px-4 py-3"},Qe={class:"text-gray-700"},Xe={class:"text-xs text-gray-500"},Ze={class:"px-4 py-3 text-gray-700"},et={class:"text-sm"},tt={class:"px-4 py-3 text-gray-700"},st={class:"text-sm"},ot={class:"text-xs text-gray-500"},at={class:"px-4 py-3"},nt={class:"px-4 py-3 text-gray-700"},it={class:"text-sm"},lt={class:"text-xs text-gray-500"},rt={class:"px-4 py-3"},dt=["onClick"],ct=["onClick"],ut=["onClick"],mt={key:0},pt={class:"flex flex-col gap-3 px-4 py-4 border-t border-gray-200 sm:px-6 sm:flex-row sm:items-center sm:justify-between"},gt={class:"flex flex-wrap items-center gap-3 text-sm"},xt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-1"},yt=["disabled"],vt={key:0,class:"px-2 text-sm text-gray-500"},bt=["disabled","onClick"],ht=["disabled"],Mt={__name:"index",setup(_t){V.locale("th"),V.extend(xe);const{toast:A}=pe(),x=w(!1),v=w(""),k=w([]),l=q({page:1,limit:20,total:0,totalPages:1}),n=q({q:"",startName:"",endName:"",status:"",departureFrom:"",departureTo:"",sort:""}),b=j(()=>Math.max(1,l.totalPages||Math.ceil((l.total||0)/(l.limit||20)))),O=j(()=>{const o=b.value,e=l.page;if(!o||o<1)return[];if(o<=5)return Array.from({length:o},(r,c)=>c+1);const a=new Set([1,o,e]);e-1>1&&a.add(e-1),e+1<o&&a.add(e+1);const s=Array.from(a).sort((r,c)=>r-c),i=[];for(let r=0;r<s.length;r++)r>0&&s[r]-s[r-1]>1&&i.push("…"),i.push(s[r]);return i});function G(o){return o==="AVAILABLE"?"bg-green-100 text-green-700":o==="FULL"?"bg-gray-200 text-gray-700":o==="CANCELLED"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}function E(o){return o?V(o).format("D MMMM BBBB HH:mm"):"-"}function J(o){if(!o&&o!==0)return"-";const e=o/1e3;return`${e.toFixed(e<10?1:0)} กม.`}function W(o){if(!o&&o!==0)return"-";const e=Math.floor(o/3600),a=Math.round(o%3600/60);return e?`${e} ชม. ${a} นาที`:`${a} นาที`}function Q(o){const[e,a]=(o||"").split(":");return!e||!["asc","desc"].includes(a)?{sortBy:void 0,sortOrder:void 0}:{sortBy:e,sortOrder:a}}async function h(o=1){var e;x.value=!0,v.value="";try{const a=Y(),s=K("token").value||localStorage.getItem("token"),{sortBy:i,sortOrder:r}=Q(n.sort),c=await $fetch("/routes/admin",{baseURL:a.public.apiBase,headers:{Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{}},query:{page:o,limit:l.limit,q:n.q||void 0,startName:n.startName||void 0,endName:n.endName||void 0,status:n.status||void 0,departureFrom:n.departureFrom||void 0,departureTo:n.departureTo||void 0,sortBy:i,sortOrder:r},credentials:"include"}),_=(c==null?void 0:c.data)||(c==null?void 0:c.items)||[],g=(c==null?void 0:c.pagination)||{};k.value=_,l.page=Number(g.page??o),l.limit=Number(g.limit??l.limit),l.total=Number(g.total??_.length),l.totalPages=Number(g.totalPages??Math.ceil(l.total/l.limit))}catch(a){console.error(a),v.value=((e=a==null?void 0:a.data)==null?void 0:e.message)||"ไม่สามารถโหลดข้อมูลได้",A.error("เกิดข้อผิดพลาด",v.value),k.value=[]}finally{x.value=!1}}function B(o){o<1||o>b.value||h(o)}function C(){l.page=1,h(1)}function X(){n.q="",n.startName="",n.endName="",n.status="",n.departureFrom="",n.departureTo="",n.sort="",l.page=1,h(1)}function Z(){S("/admin/routes/create").catch(()=>{})}function ee(o){S(`/admin/routes/${o.id}/edit`).catch(()=>{})}function te(o){S(`/admin/routes/${o.id}`).catch(()=>{})}const N=w(!1),f=w(null);function se(o){f.value=o,N.value=!0}function R(){N.value=!1,f.value=null}async function oe(){var e,a,s;if(!f.value)return;const o=f.value;try{await ae(o.id),A.success("ลบเส้นทางเรียบร้อย",`${((e=o.startLocation)==null?void 0:e.name)||"-"} → ${((a=o.endLocation)==null?void 0:a.name)||"-"} ถูกลบถาวรแล้ว`),R(),h(Math.min(l.page,b.value))}catch(i){console.error(i);const r=(i==null?void 0:i.message)||((s=i==null?void 0:i.data)==null?void 0:s.message)||"ลบไม่สำเร็จ";A.error("ลบไม่สำเร็จ",r)}}async function ae(o){const e=Y(),a=K("token").value||localStorage.getItem("token"),s=await fetch(`${e.public.apiBase}/routes/admin/${o}`,{method:"DELETE",headers:{Accept:"application/json",...a?{Authorization:`Bearer ${a}`}:{}},credentials:"include"});let i;try{i=await s.json()}catch{const r=await s.text(),c=new Error(r||"Unexpected response from server");throw c.status=s.status,c}if(!s.ok){const r=new Error((i==null?void 0:i.message)||`Request failed with status ${s.status}`);throw r.status=s.status,r.payload=i,r}return i}ge({});function ne(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.remove("mobile-open"),e.classList.add("hidden"))}function ie(){window.toggleSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),a=document.getElementById("toggle-icon");!o||!e||!a||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(e.style.marginLeft="80px",a.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",a.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.toggleSubmenu=function(o){const e=document.getElementById(o),a=document.getElementById(o+"-icon");!e||!a||(e.classList.toggle("hidden"),e.classList.contains("hidden")?a.classList.replace("fa-chevron-up","fa-chevron-down"):a.classList.replace("fa-chevron-down","fa-chevron-up"))},window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),a=document.getElementById("overlay");!o||!e||!a||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),a.classList.add("hidden"),o.classList.contains("collapsed")?e.style.marginLeft="80px":e.style.marginLeft="280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function le(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.closeMobileSidebar,delete window.toggleSubmenu,delete window.__adminResizeHandler__}return re(()=>{ie(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),h(1)}),de(()=>{le()}),(o,e)=>{var a;return m(),u("div",be,[$(fe),$(ye),t("main",he,[t("div",_e,[t("div",we,[t("div",{class:"flex items-center gap-3"},[e[11]||(e[11]=t("h1",{class:"text-2xl font-semibold text-gray-800"},"Route Management",-1)),t("button",{onClick:Z,class:"inline-flex items-center gap-2 px-3 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"},e[10]||(e[10]=[t("i",{class:"fa-solid fa-plus"},null,-1),t("span",{class:"hidden sm:inline"},"สร้างเส้นทางใหม่",-1)]))]),t("div",Le,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.q=s),onKeyup:ce(C,["enter"]),type:"text",placeholder:"ค้นหา : สรุปเส้นทาง / ไดรเวอร์ / ยานพาหนะ",class:"max-w-full px-3 py-2 border border-gray-300 rounded-md w-72 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[L,n.q,void 0,{trim:!0}]]),t("button",{onClick:C,class:"px-4 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"}," ค้นหา ")])]),t("div",ke,[t("div",Ce,[t("div",Ae,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดเริ่มต้น (ใช้ key: name)",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.startName=s),type:"text",placeholder:"เช่น มอแดง เพลส",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[L,n.startName,void 0,{trim:!0}]])]),t("div",Ee,[e[13]||(e[13]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ปลายทาง (ใช้ key: name)",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.endName=s),type:"text",placeholder:"เช่น โลตัส ขอนแก่น 2",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[L,n.endName,void 0,{trim:!0}]])]),t("div",Be,[e[15]||(e[15]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สถานะ",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[14]||(e[14]=[t("option",{value:""},"ทั้งหมด",-1),t("option",{value:"AVAILABLE"},"AVAILABLE",-1),t("option",{value:"FULL"},"FULL",-1),t("option",{value:"CANCELLED"},"CANCELLED",-1)]),512),[[M,n.status]])]),t("div",Ne,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เวลาออกเดินทางตั้งแต่ (YYYY-MM-DD)",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.departureFrom=s),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[L,n.departureFrom]])]),t("div",$e,[e[17]||(e[17]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ถึงวันที่",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.departureTo=s),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[L,n.departureTo]])]),t("div",Me,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เรียงตาม",-1)),p(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.sort=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[18]||(e[18]=[ue('<option value="">(ค่าเริ่มต้น)</option><option value="createdAt:desc">createdAt desc</option><option value="createdAt:asc">createdAt asc</option><option value="updatedAt:desc">updatedAt desc</option><option value="updatedAt:asc">updatedAt asc</option><option value="departureTime:desc">departureTime desc</option><option value="departureTime:asc">departureTime asc</option>',7)]),512),[[M,n.sort]])]),t("div",{class:"flex items-end justify-end gap-2 mt-1 lg:col-span-4 lg:mt-0"},[t("button",{onClick:X,class:"px-3 py-2 text-gray-700 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50"}," ล้างตัวกรอง "),t("button",{onClick:C,class:"px-4 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"}," ใช้ตัวกรอง ")])])]),t("div",Ie,[t("div",Se,[t("div",Te," หน้าที่ "+d(l.page)+" / "+d(b.value)+" • ทั้งหมด "+d(l.total)+" เส้นทาง ",1)]),x.value?(m(),u("div",Ve,"กำลังโหลดข้อมูล...")):v.value?(m(),u("div",Re,d(v.value),1)):(m(),u("div",De,[t("table",Ue,[e[26]||(e[26]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"เส้นทาง "),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ไดรเวอร์ "),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ยานพาหนะ "),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," ออกเดินทาง"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," ที่นั่ง/ราคา"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"สถานะ "),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," สร้างเมื่อ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"การกระทำ ")])],-1)),t("tbody",Fe,[(m(!0),u(I,null,P(k.value,s=>{var i,r,c,_,g,D,U,F,z;return m(),u("tr",{key:s.id,class:"transition-opacity hover:bg-gray-50"},[t("td",ze,[t("div",He,[t("div",qe,[t("div",je,[y(d(((i=s.startLocation)==null?void 0:i.name)||"-")+" ",1),e[20]||(e[20]=t("span",{class:"mx-2 text-gray-400"},"→",-1)),y(" "+d(((r=s.endLocation)==null?void 0:r.name)||"-"),1)]),t("div",Pe,[y(" ระยะทาง : "+d(J(s.distanceMeters))+" ",1),e[21]||(e[21]=t("span",{class:"mx-2 text-gray-300"},"|",-1)),y(" เวลา : "+d(W(s.durationSeconds)),1)])])])]),t("td",Ye,[t("div",Ke,[t("img",{src:((c=s.driver)==null?void 0:c.profilePicture)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((_=s.driver)==null?void 0:_.firstName)||"D")}&background=random&size=64`,class:"object-cover rounded-full w-9 h-9",alt:"avatar"},null,8,Oe),t("div",null,[t("div",Ge,d((g=s.driver)==null?void 0:g.firstName)+" "+d((D=s.driver)==null?void 0:D.lastName),1),t("div",Je,d((U=s.driver)!=null&&U.isVerified?"ยืนยันแล้ว":"ยังไม่ยืนยัน"),1)])])]),t("td",We,[t("div",Qe,[y(d(((F=s.vehicle)==null?void 0:F.vehicleModel)||"-")+" ",1),t("span",Xe,"("+d(((z=s.vehicle)==null?void 0:z.vehicleType)||"-")+")",1)])]),t("td",Ze,[t("div",et,d(E(s.departureTime)),1)]),t("td",tt,[t("div",st,d(s.availableSeats)+" ที่นั่ง",1),t("div",ot,"฿"+d(s.pricePerSeat)+" / ที่นั่ง",1)]),t("td",at,[t("span",{class:T(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",G(s.status)])},[t("i",{class:T(["mr-1 fa-solid",s.status==="AVAILABLE"?"fa-circle-check":s.status==="FULL"?"fa-circle-xmark":"fa-triangle-exclamation"])},null,2),y(" "+d(s.status||"-"),1)],2)]),t("td",nt,[t("div",it,d(E(s.createdAt)),1),t("div",lt,"อัปเดต "+d(E(s.updatedAt)),1)]),t("td",rt,[t("button",{onClick:H=>te(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-emerald-600",title:"ดูรายละเอียด","aria-label":"ดูรายละเอียด"},e[22]||(e[22]=[t("i",{class:"text-lg fa-regular fa-eye"},null,-1)]),8,dt),t("button",{onClick:H=>ee(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-blue-600",title:"แก้ไข","aria-label":"แก้ไข"},e[23]||(e[23]=[t("i",{class:"text-lg fa-regular fa-pen-to-square"},null,-1)]),8,ct),t("button",{onClick:H=>se(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-red-600",title:"ลบ","aria-label":"ลบ"},e[24]||(e[24]=[t("i",{class:"text-lg fa-regular fa-trash-can"},null,-1)]),8,ut)])])}),128)),k.value.length?me("",!0):(m(),u("tr",mt,e[25]||(e[25]=[t("td",{colspan:"8",class:"px-4 py-10 text-center text-gray-500"},"ไม่มีข้อมูลเส้นทาง",-1)])))])])])),t("div",pt,[t("div",gt,[t("div",xt,[e[28]||(e[28]=t("span",{class:"text-xs text-gray-500"},"Limit:",-1)),p(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.limit=s),onChange:C,class:"px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500"},e[27]||(e[27]=[t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)]),544),[[M,l.limit,void 0,{number:!0}]])])]),t("nav",ft,[t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:l.page<=1||x.value,onClick:e[8]||(e[8]=s=>B(l.page-1))}," Previous ",8,yt),(m(!0),u(I,null,P(O.value,(s,i)=>(m(),u(I,{key:`p-${i}-${s}`},[s==="…"?(m(),u("span",vt,"…")):(m(),u("button",{key:1,class:T(["px-3 py-2 text-sm border rounded-md",s===l.page?"bg-blue-50 text-blue-600 border-blue-200":"hover:bg-gray-50"]),disabled:x.value,onClick:r=>B(s)},d(s),11,bt))],64))),128)),t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:l.page>=b.value||x.value,onClick:e[9]||(e[9]=s=>B(l.page+1))}," Next ",8,ht)])])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:ne}),$(ve,{show:N.value,title:`ลบเส้นทาง${(a=f.value)!=null&&a.id?" : "+f.value.id:""}`,message:"การลบนี้เป็นการลบถาวร ข้อมูลทั้งหมดจะถูกลบและไม่สามารถกู้คืนได้ คุณต้องการดำเนินการต่อหรือไม่?",confirmText:"ลบถาวร",cancelText:"ยกเลิก",variant:"danger",onConfirm:oe,onCancel:R},null,8,["show","title"])])}}};export{Mt as default};
