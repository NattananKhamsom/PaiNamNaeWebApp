import{_ as Q,m as W,r as g,x as R,i as X,B as Y,p as Z,c as a,a as e,b as ee,F as f,q as y,g as h,t as r,s as te,o as n,n as z,f as E}from"./DPSIKoxe.js";import{d as M}from"./B5yDJBm8.js";import{b as se}from"./C5FTVxxA.js";import{C as oe}from"./CL2Ezi0q.js";import{u as ae}from"./BaxiziUg.js";import{s as ne}from"./x_rD_Ya3.js";import"./Cpj98o6Y.js";const le={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ie={class:"bg-white border border-gray-300 rounded-lg shadow-md p-6 mb-8"},re={class:"flex flex-wrap gap-2"},de=["onClick"],ce={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ue={class:"lg:col-span-2"},me={class:"bg-white border border-gray-300 rounded-lg shadow-md"},ge={key:0,class:"p-12 text-center text-gray-500"},ve={key:1,class:"divide-y divide-gray-200"},pe={key:0,class:"p-12 text-center text-gray-500"},fe=["onClick"],he={class:"flex items-start justify-between mb-4"},_e={class:"flex-1"},ye={class:"flex items-center justify-between"},xe={class:"font-semibold text-gray-900 text-lg"},be={key:0,class:"status-badge status-pending"},ke={key:1,class:"status-badge status-confirmed"},we={key:2,class:"status-badge status-rejected"},Ce={key:3,class:"status-badge status-cancelled"},Te={class:"text-sm text-gray-600 mt-1"},Le={class:"text-sm text-gray-600"},Me={class:"flex items-center space-x-4 mb-4"},$e=["src","alt"],je={class:"flex-1"},Be={class:"font-medium text-gray-900"},De={class:"flex items-center"},Pe={class:"flex text-yellow-400 text-sm"},Fe={class:"ml-2 text-sm text-gray-600"},Ne={class:"text-right"},Ae={class:"text-lg font-bold text-blue-600"},Ee={class:"text-sm text-gray-600"},Oe={key:0,class:"mt-4 mb-5 pt-4 border-t border-gray-300 animate-in slide-in-from-top duration-300"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"text-sm text-gray-600 space-y-1"},Ie={class:"text-sm text-gray-600 space-y-1"},Se={class:"mt-4 space-y-4"},Re={key:0},ze={class:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md border border-gray-300"},qe={key:1},Je={class:"grid grid-cols-3 gap-2 mt-2"},Ue=["src"],Ge=["onClick"],Ke=["onClick"],Qe={key:1,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm"},We=["onClick"],Xe={class:"lg:col-span-1"},Ye={class:"bg-white border border-gray-300 rounded-lg shadow-md overflow-hidden sticky top-8"},Ze={class:"p-3 border-gray-300"},et={class:"text-sm text-gray-600 mt-1"},tt={__name:"index copy",setup(st){M.locale("th"),M.extend(se);const{$api:$}=W(),{toast:x}=te(),_=g("pending"),v=g(null),j=g(!1),B=g(null);let d=null,b=null,D=[];const u=g([]),q=[{status:"pending",label:"รอดำเนินการ"},{status:"confirmed",label:"ยืนยันแล้ว"},{status:"rejected",label:"ปฏิเสธ"},{status:"cancelled",label:"ยกเลิก"},{status:"all",label:"ทั้งหมด"}],k=R(()=>_.value==="all"?u.value:u.value.filter(o=>o.status===_.value)),P=R(()=>u.value.find(o=>o.id===v.value)||null);async function O(){var o,s,t,l,C,H,I;j.value=!0;try{const p=await $("/routes/me"),S=[];for(const i of p){const T=[];i.vehicle?(T.push(`${i.vehicle.vehicleModel} (${i.vehicle.vehicleType})`),Array.isArray(i.vehicle.amenities)&&i.vehicle.amenities.length>0&&T.push(...i.vehicle.amenities)):T.push("ไม่มีข้อมูลรถ");const K=[[i.startLocation.lat,i.startLocation.lng],[i.endLocation.lat,i.endLocation.lng]];for(const c of i.bookings||[])S.push({id:c.id,status:(c.status||"").toLowerCase(),origin:`จาก Lat: ${i.startLocation.lat.toFixed(2)}`,destination:`ถึง Lat: ${i.endLocation.lat.toFixed(2)}`,pickupPoint:((o=c.pickupLocation)==null?void 0:o.name)||"-",date:M(i.departureTime).format("D MMMM BBBB"),time:M(i.departureTime).format("HH:mm น."),price:(i.pricePerSeat||0)*(c.numberOfSeats||0),seats:c.numberOfSeats||0,passenger:{name:`${((s=c.passenger)==null?void 0:s.firstName)||""} ${((t=c.passenger)==null?void 0:t.lastName)||""}`.trim()||"ผู้โดยสาร",image:((l=c.passenger)==null?void 0:l.profilePicture)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((C=c.passenger)==null?void 0:C.firstName)||"P")}&background=random&size=64`,rating:4.5,reviews:Math.floor(Math.random()*50)+5},coords:K,stops:["ไม่มีข้อมูลจุดแวะพัก"],carDetails:T,conditions:i.conditions,photos:((H=i.vehicle)==null?void 0:H.photos)||[]})}u.value=S}catch(p){console.error("Failed to fetch routes:",p),u.value=[],x.error("เกิดข้อผิดพลาด",((I=p==null?void 0:p.data)==null?void 0:I.message)||"ไม่สามารถโหลดข้อมูลได้")}finally{j.value=!1}}const J=o=>o==="all"?u.value.length:u.value.filter(s=>s.status===o).length,U=o=>{const s=u.value.find(t=>t.id===o);s&&V(s),v.value=v.value===o?null:o},V=o=>{if(!d||!o)return;b&&d.removeLayer(b),D.forEach(l=>d.removeLayer(l)),D=[],b=L.polyline(o.coords,{color:"#3b82f6",weight:4}).addTo(d);const s=L.marker(o.coords[0]).bindPopup("จุดเริ่มต้น").addTo(d),t=L.marker(o.coords[o.coords.length-1]).bindPopup("จุดปลายทาง").addTo(d);D.push(s,t),d.fitBounds(b.getBounds(),{padding:[40,40]})},F=g(!1),w=g(null),m=g({title:"",message:"",confirmText:"",action:null,variant:"danger"}),N=(o,s)=>{w.value=o,s==="confirm"?m.value={title:"ยืนยันคำขอจอง",message:`ยืนยันคำขอของผู้โดยสาร "${o.passenger.name}" ใช่หรือไม่?`,confirmText:"ยืนยันคำขอ",action:"confirm",variant:"primary"}:s==="reject"?m.value={title:"ปฏิเสธคำขอจอง",message:`ต้องการปฏิเสธคำขอของ "${o.passenger.name}" ใช่หรือไม่?`,confirmText:"ปฏิเสธ",action:"reject",variant:"danger"}:s==="delete"&&(m.value={title:"ยืนยันการลบรายการ",message:"ต้องการลบคำขอนี้ออกจากรายการใช่หรือไม่?",confirmText:"ลบรายการ",action:"delete",variant:"danger"}),F.value=!0},A=()=>{F.value=!1,w.value=null},G=async()=>{var t;if(!w.value)return;const o=m.value.action,s=w.value.id;try{o==="confirm"?(await $(`/bookings/${s}/status`,{method:"PATCH",body:{status:"CONFIRMED"}}),x.success("สำเร็จ","ยืนยันคำขอแล้ว")):o==="reject"?(await $(`/bookings/${s}/status`,{method:"PATCH",body:{status:"REJECTED"}}),x.success("สำเร็จ","ปฏิเสธคำขอแล้ว")):o==="delete"&&console.log(`Delete booking ${s} (TODO)`),A(),await O()}catch(l){console.error(`Failed to ${o} booking:`,l),x.error("เกิดข้อผิดพลาด",((t=l==null?void 0:l.data)==null?void 0:t.message)||"ไม่สามารถดำเนินการได้"),A()}};return ae({}),X(()=>{O();const o=ne(()=>{typeof L<"u"&&(clearInterval(o),Y(()=>{B.value&&!d&&(d=L.map(B.value).setView([13.7563,100.5018],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(d))}))},100)}),Z(_,()=>{v.value=null,k.value.length>0&&V(k.value[0])}),(o,s)=>(n(),a("div",null,[e("div",le,[s[8]||(s[8]=e("div",{class:"mb-8"},[e("h2",{class:"text-2xl font-bold text-gray-900"},"คำขอจองเส้นทางของฉัน"),e("p",{class:"mt-2 text-gray-600"},"ดูและจัดการคำขอจองจากผู้โดยสารในเส้นทางที่คุณสร้าง")],-1)),e("div",ie,[e("div",re,[(n(),a(f,null,y(q,t=>e("button",{key:t.status,onClick:l=>_.value=t.status,class:z(["tab-button px-4 py-2 rounded-md font-medium",{active:_.value===t.status}])},r(t.label)+" ("+r(J(t.status))+") ",11,de)),64))])]),e("div",ce,[e("div",ue,[e("div",me,[s[6]||(s[6]=e("div",{class:"p-6 border-b border-gray-300"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"รายการคำขอจอง")],-1)),j.value?(n(),a("div",ge,s[0]||(s[0]=[e("p",null,"กำลังโหลดข้อมูล...",-1)]))):(n(),a("div",ve,[k.value.length===0?(n(),a("div",pe,s[1]||(s[1]=[e("p",null,"ไม่พบรายการในหมวดหมู่นี้",-1)]))):h("",!0),(n(!0),a(f,null,y(k.value,t=>(n(),a("div",{key:t.id,class:"trip-card p-6 cursor-pointer transition-colors duration-200 hover:bg-gray-50",onClick:l=>U(t.id)},[e("div",he,[e("div",_e,[e("div",ye,[e("h4",xe,r(t.origin)+" → "+r(t.destination),1),t.status==="pending"?(n(),a("span",be,"รอดำเนินการ")):t.status==="confirmed"?(n(),a("span",ke,"ยืนยันแล้ว")):t.status==="rejected"?(n(),a("span",we,"ปฏิเสธ")):t.status==="cancelled"?(n(),a("span",Ce,"ยกเลิก")):h("",!0)]),e("p",Te,"จุดนัดพบ: "+r(t.pickupPoint),1),e("p",Le," วันที่: "+r(t.date)+" เวลา: "+r(t.time),1)])]),e("div",Me,[e("img",{src:t.passenger.image,alt:t.passenger.name,class:"w-12 h-12 rounded-full object-cover"},null,8,$e),e("div",je,[e("h5",Be,r(t.passenger.name),1),e("div",De,[e("div",Pe,[e("span",null,r("★".repeat(Math.round(t.passenger.rating)))+r("☆".repeat(5-Math.round(t.passenger.rating))),1)]),e("span",Fe,r(t.passenger.rating)+" ("+r(t.passenger.reviews)+" รีวิว)",1)])]),e("div",Ne,[e("div",Ae,r(t.price)+" บาท",1),e("div",Ee,"จำนวน "+r(t.seats)+" ที่นั่ง",1)])]),v.value===t.id?(n(),a("div",Oe,[e("div",Ve,[e("div",null,[s[2]||(s[2]=e("h5",{class:"font-medium text-gray-900 mb-2"},"รายละเอียดเส้นทาง",-1)),e("ul",He,[(n(!0),a(f,null,y(t.stops,l=>(n(),a("li",{key:l},"• "+r(l),1))),128))])]),e("div",null,[s[3]||(s[3]=e("h5",{class:"font-medium text-gray-900 mb-2"},"รายละเอียดรถ",-1)),e("ul",Ie,[(n(!0),a(f,null,y(t.carDetails,l=>(n(),a("li",{key:l},"• "+r(l),1))),128))])])]),e("div",Se,[t.conditions?(n(),a("div",Re,[s[4]||(s[4]=e("h5",{class:"font-medium text-gray-900 mb-2"},"เงื่อนไขการเดินทาง",-1)),e("p",ze,r(t.conditions),1)])):h("",!0),t.photos&&t.photos.length>0?(n(),a("div",qe,[s[5]||(s[5]=e("h5",{class:"font-medium text-gray-900 mb-2"},"รูปภาพรถยนต์",-1)),e("div",Je,[(n(!0),a(f,null,y(t.photos.slice(0,3),(l,C)=>(n(),a("div",{key:C},[e("img",{src:l,alt:"Vehicle photo",class:"w-full aspect-video object-cover rounded-lg shadow-sm cursor-pointer hover:opacity-90 transition-opacity"},null,8,Ue)]))),128))])])):h("",!0)])])):h("",!0),e("div",{class:z(["flex justify-end space-x-3",{"mt-4":v.value!==t.id}])},[t.status==="pending"?(n(),a(f,{key:0},[e("button",{onClick:E(l=>N(t,"confirm"),["stop"]),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm"}," ยืนยันคำขอ ",8,Ge),e("button",{onClick:E(l=>N(t,"reject"),["stop"]),class:"px-4 py-2 border border-red-300 text-red-600 rounded-md hover:bg-red-50 transition duration-200 text-sm"}," ปฏิเสธ ",8,Ke)],64)):t.status==="confirmed"?(n(),a("button",Qe," แชทกับผู้โดยสาร ")):["rejected","cancelled"].includes(t.status)?(n(),a("button",{key:2,onClick:E(l=>N(t,"delete"),["stop"]),class:"px-4 py-2 border border-gray-300 text-gray-600 rounded-md hover:bg-gray-50 transition duration-200 text-sm"}," ลบรายการ ",8,We)):h("",!0)],2)],8,fe))),128))]))])]),e("div",Xe,[e("div",Ye,[e("div",Ze,[s[7]||(s[7]=e("h3",{class:"text-lg font-semibold text-gray-900"},"แผนที่เส้นทาง",-1)),e("p",et,r(P.value?P.value.origin+" → "+P.value.destination:"คลิกที่รายการเพื่อดูเส้นทาง"),1)]),e("div",{ref_key:"mapContainer",ref:B,id:"map"},null,512)])])])]),ee(oe,{show:F.value,title:m.value.title,message:m.value.message,confirmText:m.value.confirmText,variant:m.value.variant,onConfirm:G,onCancel:A},null,8,["show","title","message","confirmText","variant"])]))}},ct=Q(tt,[["__scopeId","data-v-a1257929"]]);export{ct as default};
