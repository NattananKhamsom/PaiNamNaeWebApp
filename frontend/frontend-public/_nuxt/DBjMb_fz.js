import{_ as ue,m as ce,r as p,A as me,y as pe,i as ge,c as k,a as t,b as Y,f as R,d as h,h as b,v as S,z as be,F as fe,q as ve,t as C,w as ye,T as xe,s as we,B as Pe,o as _,g as ee,C as te}from"./DPSIKoxe.js";import{u as ke}from"./BaxiziUg.js";import{V as he}from"./CGg3eoUs.js";const Se={class:"max-w-4xl px-4 py-8 mx-auto sm:px-6 lg:px-8"},Ce={class:"p-8 bg-white border border-gray-300 rounded-lg shadow-md"},_e={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Me={class:"relative"},Ie={class:"relative"},Te={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Ve={key:0,class:"grid items-center grid-cols-1 gap-6 md:grid-cols-2"},Ae=["value"],Le={class:"self-end"},Ne={key:1,class:"p-8 bg-white border border-gray-300 shadow-xl rounded-xl"},Ee={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 bg-[#F2F2F2] p-4 md:px-6 md:py-6 rounded-[8px]"},Fe={class:"flex justify-end gap-4 pt-6"},De=["disabled"],$e={class:"modal-content"},Be={class:"flex items-center justify-between p-4 border-b border-gray-300"},Ue={class:"text-lg font-semibold text-gray-900"},qe={class:"p-4 space-y-3"},ze={class:"text-sm text-gray-700"},Oe={class:"truncate"},je={key:0,class:"text-gray-500"},Ke={class:"flex gap-3 pt-2"},Ze=["disabled"],j="__gmapsReadyCreateTrip__",Ge={__name:"index_v3",setup(He){var X;const{$api:K}=ce(),{toast:M}=we(),D=p(!1),I=p(!1),U=p([]),a=me({vehicleId:"",startPoint:"",endPoint:"",date:"",time:"",availableSeats:null,pricePerSeat:null,conditions:""}),q=p(null),z=p(null);let f=null,v=null;const y=p({lat:null,lng:null,name:null,address:null,placeId:null}),x=p({lat:null,lng:null,name:null,address:null,placeId:null}),O=p(!1),T=p(null),Z=p(null);let $=null,V=null;const r=p({name:"",lat:null,lng:null});let G=null,A=null;const le=pe(),ae=[];(X=window.google)!=null&&X.maps||ae.push({key:"gmaps",src:`https://maps.googleapis.com/maps/api/js?key=${le.public.googleMapsApiKey}&libraries=places&callback=${j}`,async:!0,defer:!0}),ke({});const H=async()=>{try{const n=await K("/vehicles");if(U.value=n,n.length>0){const e=n.find(l=>l.isDefault)||n[0];a.vehicleId=e.id}}catch(n){console.error("Failed to fetch vehicles:",n),showErrorToast&&M.error("เกิดข้อผิดพลาด","ไม่สามารถโหลดข้อมูลรถยนต์ได้")}},se=async()=>{D.value=!1,await H()},ne=async()=>{var l,o;if(I.value)return;if(!a.vehicleId||!a.date||!a.time||!a.availableSeats||!a.pricePerSeat){M.error("ข้อมูลไม่ครบถ้วน","กรุณากรอกข้อมูลที่มีเครื่องหมาย * ให้ครบถ้วน");return}I.value=!0;const n=new Date(`${a.date}T${a.time}`).toISOString(),e={vehicleId:a.vehicleId,startLocation:{lat:Number(y.value.lat),lng:Number(y.value.lng),name:y.value.name||a.startPoint||null,address:y.value.address||a.startPoint||null},endLocation:{lat:Number(x.value.lat),lng:Number(x.value.lng),name:x.value.name||a.endPoint||null,address:x.value.address||a.endPoint||null},departureTime:n,availableSeats:Number(a.availableSeats),pricePerSeat:Number(a.pricePerSeat),conditions:a.conditions};try{await K("/routes",{method:"POST",body:e}),M.success("สำเร็จ","สร้างเส้นทางการเดินทางเรียบร้อยแล้ว!"),setTimeout(()=>{te("/findTrip")},1500)}catch(s){console.error("Failed to create route:",s),s.statusCode===403&&((l=s.data)!=null&&l.message.includes("ยืนยันตัวตนผู้ขับ"))?(M.error("จำเป็นต้องยืนยันตัวตน","คุณต้องยืนยันตัวตนผู้ขับก่อนจึงจะสร้างเส้นทางได้"),setTimeout(()=>{te("/profile/driver-verification")},2e3)):M.error("เกิดข้อผิดพลาด",((o=s.data)==null?void 0:o.message)||"ไม่สามารถสร้างเส้นทางได้")}finally{I.value=!1}};function J(){var l,o;if(!((o=(l=window.google)==null?void 0:l.maps)!=null&&o.places))return;G=new google.maps.Geocoder;const n=document.createElement("div");A=new google.maps.places.PlacesService(n);const e={fields:["place_id","name","formatted_address","geometry"],types:["geocode","establishment"]};q.value&&(f!=null&&f.unbindAll&&f.unbindAll(),f=new google.maps.places.Autocomplete(q.value,e),f.addListener("place_changed",()=>{var P,m,N,E,g,F;const s=f.getPlace();if(!s)return;const i=((N=(m=(P=s.geometry)==null?void 0:P.location)==null?void 0:m.lat)==null?void 0:N.call(m))??null,c=((F=(g=(E=s.geometry)==null?void 0:E.location)==null?void 0:g.lng)==null?void 0:F.call(g))??null,d=s.name||L(w(s.formatted_address||""))||a.startPoint,u=w(s.formatted_address||d||"");a.startPoint=d,y.value={lat:i,lng:c,name:d,address:u,placeId:s.place_id||null}})),z.value&&(v!=null&&v.unbindAll&&v.unbindAll(),v=new google.maps.places.Autocomplete(z.value,e),v.addListener("place_changed",()=>{var P,m,N,E,g,F;const s=v.getPlace();if(!s)return;const i=((N=(m=(P=s.geometry)==null?void 0:P.location)==null?void 0:m.lat)==null?void 0:N.call(m))??null,c=((F=(g=(E=s.geometry)==null?void 0:E.location)==null?void 0:g.lng)==null?void 0:F.call(g))??null,d=s.name||L(w(s.formatted_address||""))||a.endPoint,u=w(s.formatted_address||d||"");a.endPoint=d,x.value={lat:i,lng:c,name:d,address:u,placeId:s.place_id||null}}))}function Q(n){T.value=n,r.value={name:"",lat:null,lng:null},O.value=!0,Pe(()=>{const e=n==="start"?y.value:x.value,l=e.lat!=null&&e.lng!=null,o=l?{lat:e.lat,lng:e.lng}:{lat:13.7563,lng:100.5018};$=new google.maps.Map(Z.value,{center:o,zoom:l?14:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),$.addListener("click",s=>{const i=s.latLng;oe(i),W(i)})})}function oe(n){if(V){V.setPosition(n);return}V=new google.maps.Marker({position:n,map:$,draggable:!0}),V.addListener("dragend",e=>{W(e.latLng)})}async function W(n){const e=n.lat(),l=n.lng(),o=await new Promise(c=>{G.geocode({location:{lat:e,lng:l}},(d,u)=>{u==="OK"&&(d!=null&&d.length)?c(d[0]):c(null)})});let s="",i="";if(o!=null&&o.formatted_address&&(i=w(o.formatted_address),s=L(i)),o!=null&&o.place_id&&await new Promise(c=>{A.getDetails({placeId:o.place_id,fields:["name"]},(d,u)=>{u===google.maps.places.PlacesServiceStatus.OK&&(d!=null&&d.name)&&(s=d.name),c()})}),!s||de(s)){const c=await ie(e,l,150);c!=null&&c.place_id?await new Promise(d=>{A.getDetails({placeId:c.place_id,fields:["name","formatted_address"]},(u,P)=>{if(P===google.maps.places.PlacesServiceStatus.OK){const m=w((u==null?void 0:u.formatted_address)||s);s=(u==null?void 0:u.name)||L(m),i=m||i}d()})}):o!=null&&o.formatted_address&&(i=w(o.formatted_address),s=L(i))}r.value={name:s,address:i||s,lat:e,lng:l}}function re(){!T.value||!r.value.name||(T.value==="start"?(a.startPoint=r.value.name,y.value={lat:r.value.lat,lng:r.value.lng,name:r.value.name,address:r.value.address||r.value.name,placeId:null}):(a.endPoint=r.value.name,x.value={lat:r.value.lat,lng:r.value.lng,name:r.value.name,address:r.value.address||r.value.name,placeId:null}),B())}function B(){O.value=!1,T.value=null,V=null,$=null}function de(n){return n?/^[A-Z0-9]{4,}\+[A-Z0-9]{2,}/i.test(n.trim()):!1}function w(n){return(n||"").replace(/,?\s*(Thailand|ไทย)\s*$/i,"")}function L(n){return(n||"").replace(/^[A-Z0-9]{4,}\+[A-Z0-9]{2,}\s*,?\s*/i,"")}function ie(n,e,l=120){return new Promise(o=>{if(!A)return o(null);A.nearbySearch({location:{lat:n,lng:e},radius:l},(s,i)=>{i===google.maps.places.PlacesServiceStatus.OK&&(s!=null&&s.length)?o(s[0]):o(null)})})}return ge(()=>{var n,e;H(),(e=(n=window.google)==null?void 0:n.maps)!=null&&e.places?J():window[j]=()=>{try{delete window[j]}catch{}J()}}),(n,e)=>(_(),k("div",null,[t("div",Se,[e[31]||(e[31]=t("div",{class:"mb-8"},[t("h2",{class:"mb-2 text-3xl font-bold text-gray-900"}," สร้างการเดินทางของคุณ "),t("p",{class:"text-gray-600"}," กำหนดจุดเริ่มต้น ปลายทาง และรายละเอียดต่างๆ เพื่อให้ผู้โดยสารมาร่วมทาง ")],-1)),t("div",Ce,[t("form",{onSubmit:R(ne,["prevent"]),id:"postRouteForm",novalidate:"",class:"space-y-8"},[t("div",null,[e[16]||(e[16]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," ข้อมูลเส้นทาง ",-1)),t("div",_e,[t("div",null,[e[13]||(e[13]=t("label",{for:"startPoint",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" จุดเริ่มต้น "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Me,[b(t("input",{ref_key:"startInputEl",ref:q,"onUpdate:modelValue":e[0]||(e[0]=l=>a.startPoint=l),id:"startPoint",name:"startPoint",type:"text",placeholder:"เช่น กรุงเทพมหานคร, ถนนสุขุมวิท",required:"",class:"w-full px-4 py-3 pr-10 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.startPoint]]),t("button",{type:"button",onClick:e[1]||(e[1]=l=>Q("start")),class:"absolute inset-y-0 my-auto text-gray-500 right-2 hover:text-blue-600",title:"เลือกจากแผนที่"},e[12]||(e[12]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"})],-1)]))])]),t("div",null,[e[15]||(e[15]=t("label",{for:"endPoint",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" จุดปลายทาง "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ie,[b(t("input",{ref_key:"endInputEl",ref:z,"onUpdate:modelValue":e[2]||(e[2]=l=>a.endPoint=l),id:"endPoint",name:"endPoint",type:"text",placeholder:"เช่น เชียงใหม่, ถนนนิมมานเหมินท์",required:"",class:"w-full px-4 py-3 pr-10 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.endPoint]]),t("button",{type:"button",onClick:e[3]||(e[3]=l=>Q("end")),class:"absolute inset-y-0 my-auto text-gray-500 right-2 hover:text-blue-600",title:"เลือกจากแผนที่"},e[14]||(e[14]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"})],-1)]))])])])]),t("div",null,[e[22]||(e[22]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," รายละเอียดการเดินทาง ",-1)),t("div",Te,[t("div",null,[e[17]||(e[17]=t("label",{for:"travelDate",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" วันที่เดินทาง "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.date=l),id:"travelDate",name:"travelDate",type:"date",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.date]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"travelTime",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" เวลาออกเดินทาง "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.time=l),id:"travelTime",name:"travelTime",type:"time",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.time]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"seatCount",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" จำนวนที่นั่งที่รับได้ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.availableSeats=l),id:"seatCount",name:"seatCount",type:"number",min:"1",placeholder:"กรอกจำนวนที่นั่ง (เช่น 4)",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.availableSeats,void 0,{number:!0}]]),e[20]||(e[20]=t("p",{class:"mt-1 text-xs text-gray-500"}," รถยนต์ส่วนบุคคลทั่วไปมี 4–5 ที่นั่ง หากใช้รถตู้/รถบัส ให้ระบุจำนวนได้ตามจริง ",-1))]),t("div",null,[e[21]||(e[21]=t("label",{for:"pricePerSeat",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" ราคาต่อที่นั่ง (บาท) "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.pricePerSeat=l),id:"pricePerSeat",name:"pricePerSeat",type:"number",min:"0",placeholder:"เช่น 250",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[S,a.pricePerSeat,void 0,{number:!0}]])])])]),t("div",null,[e[26]||(e[26]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," ข้อมูลรถยนต์ ",-1)),U.value.length>0?(_(),k("div",Ve,[t("div",null,[e[24]||(e[24]=t("label",{for:"vehicle",class:"block mb-2 text-sm font-medium text-gray-700"},[h(" เลือกรถยนต์ที่จะใช้ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.vehicleId=l),id:"vehicle",name:"vehicle",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},[e[23]||(e[23]=t("option",{disabled:"",value:""},"กรุณาเลือกรถยนต์",-1)),(_(!0),k(fe,null,ve(U.value,l=>(_(),k("option",{key:l.id,value:l.id},C(l.vehicleModel)+" ("+C(l.licensePlate)+") ",9,Ae))),128))],512),[[be,a.vehicleId]])]),t("div",Le,[t("button",{type:"button",onClick:e[9]||(e[9]=l=>D.value=!0),class:"w-full px-4 py-3 text-sm text-gray-800 transition-colors bg-gray-100 rounded-md md:w-auto hover:bg-gray-200"}," เพิ่ม / จัดการข้อมูลรถยนต์ ")])])):(_(),k("div",Ne,[t("div",Ee,[e[25]||(e[25]=t("p",{class:"text-gray-800 text-base md:text-[18px] text-center sm:text-left"}," คุณยังไม่มีข้อมูลรถยนต์ ",-1)),t("button",{type:"button",onClick:e[10]||(e[10]=l=>D.value=!0),class:"bg-[#2563EB] hover:bg-blue-600 text-white text-sm md:text-[16px] px-4 py-2 rounded-lg transition-colors whitespace-nowrap"}," เพิ่ม / จัดการข้อมูล ")])]))]),Y(he,{show:D.value,onClose:se},null,8,["show"]),t("div",null,[e[27]||(e[27]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," เงื่อนไขและข้อตกลง ",-1)),b(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.conditions=l),id:"terms",name:"terms",rows:"4",placeholder:"ระบุเงื่อนไข เช่น ไม่สูบบุหรี่, ไม่นำสัตว์เลี้ยง, ชำระเงินล่วงหน้า 50%",class:"w-full px-4 py-3 border border-gray-300 rounded-md resize-none focus:ring-blue-500"},null,512),[[S,a.conditions]])]),t("div",Fe,[e[28]||(e[28]=t("button",{type:"button",class:"px-6 py-3 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"}," ยกเลิก ",-1)),t("button",{type:"submit",disabled:I.value,class:"px-6 py-3 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed"},C(I.value?"กำลังสร้าง...":"สร้างการเดินทาง"),9,De)])],32)]),Y(xe,{name:"modal-fade"},{default:ye(()=>[O.value?(_(),k("div",{key:0,class:"modal-overlay",onClick:R(B,["self"])},[t("div",$e,[t("div",Be,[t("h3",Ue," เลือก"+C(T.value==="start"?"จุดเริ่มต้น":"จุดปลายทาง"),1),t("button",{onClick:B,class:"text-gray-400 hover:text-gray-600"},e[29]||(e[29]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",qe,[t("div",{ref_key:"placePickerMapEl",ref:Z,class:"w-full border border-gray-200 rounded-md h-80"},null,512),t("div",ze,[e[30]||(e[30]=t("div",{class:"font-medium"},"ตำแหน่งที่เลือก:",-1)),t("div",Oe,C(r.value.name||"— ยังไม่เลือก —"),1),r.value.lat&&r.value.lng?(_(),k("div",je," lat: "+C(r.value.lat.toFixed(6))+", lng: "+C(r.value.lng.toFixed(6)),1)):ee("",!0)]),t("div",Ke,[t("button",{onClick:B,class:"flex-1 px-4 py-2 font-semibold text-gray-800 bg-gray-200 rounded-md hover:bg-gray-300"}," ยกเลิก "),t("button",{disabled:!r.value.name,onClick:re,class:"flex-1 px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," ใช้ตำแหน่งนี้ ",8,Ze)])])])])):ee("",!0)]),_:1})])]))}},Xe=ue(Ge,[["__scopeId","data-v-88a8cf31"]]);export{Xe as default};
