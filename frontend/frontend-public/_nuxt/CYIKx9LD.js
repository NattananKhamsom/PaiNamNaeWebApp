import{_ as ne,m as re,r as c,A as ie,y as de,i as ue,c as v,a as t,b as J,f as Q,d as y,h as p,v as x,z as ce,F as me,q as pe,t as w,w as ge,T as be,s as fe,B as ve,o as P,g as W,C as X}from"./DPSIKoxe.js";import{u as ye}from"./BaxiziUg.js";import{V as xe}from"./CGg3eoUs.js";const we={class:"max-w-4xl px-4 py-8 mx-auto sm:px-6 lg:px-8"},Pe={class:"p-8 bg-white border border-gray-300 rounded-lg shadow-md"},ke={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},he={class:"relative"},Se={class:"relative"},Ce={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Me={key:0,class:"grid items-center grid-cols-1 gap-6 md:grid-cols-2"},Te=["value"],_e={class:"self-end"},Ve={key:1,class:"p-8 bg-white border border-gray-300 shadow-xl rounded-xl"},Ie={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 bg-[#F2F2F2] p-4 md:px-6 md:py-6 rounded-[8px]"},Ae={class:"flex justify-end gap-4 pt-6"},Le=["disabled"],Ne={class:"modal-content"},Ee={class:"flex items-center justify-between p-4 border-b border-gray-300"},Fe={class:"text-lg font-semibold text-gray-900"},De={class:"p-4 space-y-3"},$e={class:"text-sm text-gray-700"},Be={class:"truncate"},Ue={key:0,class:"text-gray-500"},qe={class:"flex gap-3 pt-2"},ze=["disabled"],U="__gmapsReadyCreateTrip__",Oe={__name:"index_v2",setup(je){var H;const{$api:q}=re(),{toast:S}=fe(),I=c(!1),C=c(!1),N=c([]),a=ie({vehicleId:"",startPoint:"",endPoint:"",date:"",time:"",availableSeats:null,pricePerSeat:null,conditions:""}),E=c(null),F=c(null);let g=null,b=null;const k=c({lat:null,lng:null}),h=c({lat:null,lng:null}),D=c(!1),M=c(null),z=c(null);let A=null,T=null;const u=c({name:"",lat:null,lng:null});let O=null,_=null;const Y=de(),R=[];(H=window.google)!=null&&H.maps||R.push({key:"gmaps",src:`https://maps.googleapis.com/maps/api/js?key=${Y.public.googleMapsApiKey}&libraries=places&callback=${U}`,async:!0,defer:!0}),ye({});const j=async()=>{try{const s=await q("/vehicles");if(N.value=s,s.length>0){const e=s.find(l=>l.isDefault)||s[0];a.vehicleId=e.id}}catch(s){console.error("Failed to fetch vehicles:",s),showErrorToast&&S.error("เกิดข้อผิดพลาด","ไม่สามารถโหลดข้อมูลรถยนต์ได้")}},ee=async()=>{I.value=!1,await j()},te=async()=>{var l,n;if(C.value)return;if(!a.vehicleId||!a.date||!a.time||!a.availableSeats||!a.pricePerSeat){S.error("ข้อมูลไม่ครบถ้วน","กรุณากรอกข้อมูลที่มีเครื่องหมาย * ให้ครบถ้วน");return}C.value=!0;const s=new Date(`${a.date}T${a.time}`).toISOString(),e={vehicleId:a.vehicleId,startLocation:{lat:Number(k.value.lat),lng:Number(k.value.lng)},endLocation:{lat:Number(h.value.lat),lng:Number(h.value.lng)},departureTime:s,availableSeats:Number(a.availableSeats),pricePerSeat:Number(a.pricePerSeat),conditions:a.conditions};try{await q("/routes",{method:"POST",body:e}),S.success("สำเร็จ","สร้างเส้นทางการเดินทางเรียบร้อยแล้ว!"),setTimeout(()=>{X("/findTrip")},1500)}catch(o){console.error("Failed to create route:",o),o.statusCode===403&&((l=o.data)!=null&&l.message.includes("ยืนยันตัวตนผู้ขับ"))?(S.error("จำเป็นต้องยืนยันตัวตน","คุณต้องยืนยันตัวตนผู้ขับก่อนจึงจะสร้างเส้นทางได้"),setTimeout(()=>{X("/profile/driver-verification")},2e3)):S.error("เกิดข้อผิดพลาด",((n=o.data)==null?void 0:n.message)||"ไม่สามารถสร้างเส้นทางได้")}finally{C.value=!1}};function K(){var l,n;if(!((n=(l=window.google)==null?void 0:l.maps)!=null&&n.places))return;O=new google.maps.Geocoder;const s=document.createElement("div");_=new google.maps.places.PlacesService(s);const e={fields:["place_id","name","formatted_address","geometry"],types:["geocode","establishment"]};E.value&&(g!=null&&g.unbindAll&&g.unbindAll(),g=new google.maps.places.Autocomplete(E.value,e),g.addListener("place_changed",()=>{var i,r,d,f,m,V;const o=g.getPlace();o&&(a.startPoint=o.name||o.formatted_address||a.startPoint,k.value.lat=((d=(r=(i=o.geometry)==null?void 0:i.location)==null?void 0:r.lat)==null?void 0:d.call(r))??null,k.value.lng=((V=(m=(f=o.geometry)==null?void 0:f.location)==null?void 0:m.lng)==null?void 0:V.call(m))??null)})),F.value&&(b!=null&&b.unbindAll&&b.unbindAll(),b=new google.maps.places.Autocomplete(F.value,e),b.addListener("place_changed",()=>{var i,r,d,f,m,V;const o=b.getPlace();o&&(a.endPoint=o.name||o.formatted_address||a.endPoint,h.value.lat=((d=(r=(i=o.geometry)==null?void 0:i.location)==null?void 0:r.lat)==null?void 0:d.call(r))??null,h.value.lng=((V=(m=(f=o.geometry)==null?void 0:f.location)==null?void 0:m.lng)==null?void 0:V.call(m))??null)}))}function Z(s){M.value=s,u.value={name:"",lat:null,lng:null},D.value=!0,ve(()=>{const e=s==="start"?k.value:h.value,l=e.lat!=null&&e.lng!=null,n=l?{lat:e.lat,lng:e.lng}:{lat:13.7563,lng:100.5018};A=new google.maps.Map(z.value,{center:n,zoom:l?14:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),A.addListener("click",o=>{const i=o.latLng;le(i),G(i)})})}function le(s){if(T){T.setPosition(s);return}T=new google.maps.Marker({position:s,map:A,draggable:!0}),T.addListener("dragend",e=>{G(e.latLng)})}async function G(s){const e=s.lat(),l=s.lng(),n=await new Promise(i=>{O.geocode({location:{lat:e,lng:l}},(r,d)=>{d==="OK"&&(r!=null&&r.length)?i(r[0]):i(null)})});let o="";if(n!=null&&n.formatted_address&&(o=B($(n.formatted_address))),n!=null&&n.place_id&&await new Promise(i=>{_.getDetails({placeId:n.place_id,fields:["name"]},(r,d)=>{d===google.maps.places.PlacesServiceStatus.OK&&(r!=null&&r.name)&&(o=r.name),i()})}),!o||se(o)){const i=await oe(e,l,150);i!=null&&i.place_id?await new Promise(r=>{_.getDetails({placeId:i.place_id,fields:["name","formatted_address"]},(d,f)=>{f===google.maps.places.PlacesServiceStatus.OK&&(o=(d==null?void 0:d.name)||B($((d==null?void 0:d.formatted_address)||o))),r()})}):n!=null&&n.formatted_address&&(o=B($(n.formatted_address)))}u.value={name:o,lat:e,lng:l}}function ae(){!M.value||!u.value.name||(M.value==="start"?(a.startPoint=u.value.name,k.value={lat:u.value.lat,lng:u.value.lng}):(a.endPoint=u.value.name,h.value={lat:u.value.lat,lng:u.value.lng}),L())}function L(){D.value=!1,M.value=null,T=null,A=null}function se(s){return s?/^[A-Z0-9]{4,}\+[A-Z0-9]{2,}/i.test(s.trim()):!1}function $(s){return(s||"").replace(/,?\s*(Thailand|ไทย)\s*$/i,"")}function B(s){return(s||"").replace(/^[A-Z0-9]{4,}\+[A-Z0-9]{2,}\s*,?\s*/i,"")}function oe(s,e,l=120){return new Promise(n=>{if(!_)return n(null);_.nearbySearch({location:{lat:s,lng:e},radius:l},(o,i)=>{i===google.maps.places.PlacesServiceStatus.OK&&(o!=null&&o.length)?n(o[0]):n(null)})})}return ue(()=>{var s,e;j(),(e=(s=window.google)==null?void 0:s.maps)!=null&&e.places?K():window[U]=()=>{try{delete window[U]}catch{}K()}}),(s,e)=>(P(),v("div",null,[t("div",we,[e[31]||(e[31]=t("div",{class:"mb-8"},[t("h2",{class:"mb-2 text-3xl font-bold text-gray-900"}," สร้างการเดินทางของคุณ "),t("p",{class:"text-gray-600"}," กำหนดจุดเริ่มต้น ปลายทาง และรายละเอียดต่างๆ เพื่อให้ผู้โดยสารมาร่วมทาง ")],-1)),t("div",Pe,[t("form",{onSubmit:Q(te,["prevent"]),id:"postRouteForm",novalidate:"",class:"space-y-8"},[t("div",null,[e[16]||(e[16]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," ข้อมูลเส้นทาง ",-1)),t("div",ke,[t("div",null,[e[13]||(e[13]=t("label",{for:"startPoint",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" จุดเริ่มต้น "),t("span",{class:"text-red-500"},"*")],-1)),t("div",he,[p(t("input",{ref_key:"startInputEl",ref:E,"onUpdate:modelValue":e[0]||(e[0]=l=>a.startPoint=l),id:"startPoint",name:"startPoint",type:"text",placeholder:"เช่น กรุงเทพมหานคร, ถนนสุขุมวิท",required:"",class:"w-full px-4 py-3 pr-10 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.startPoint]]),t("button",{type:"button",onClick:e[1]||(e[1]=l=>Z("start")),class:"absolute inset-y-0 my-auto text-gray-500 right-2 hover:text-blue-600",title:"เลือกจากแผนที่"},e[12]||(e[12]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"})],-1)]))])]),t("div",null,[e[15]||(e[15]=t("label",{for:"endPoint",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" จุดปลายทาง "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Se,[p(t("input",{ref_key:"endInputEl",ref:F,"onUpdate:modelValue":e[2]||(e[2]=l=>a.endPoint=l),id:"endPoint",name:"endPoint",type:"text",placeholder:"เช่น เชียงใหม่, ถนนนิมมานเหมินท์",required:"",class:"w-full px-4 py-3 pr-10 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.endPoint]]),t("button",{type:"button",onClick:e[3]||(e[3]=l=>Z("end")),class:"absolute inset-y-0 my-auto text-gray-500 right-2 hover:text-blue-600",title:"เลือกจากแผนที่"},e[14]||(e[14]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"})],-1)]))])])])]),t("div",null,[e[22]||(e[22]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," รายละเอียดการเดินทาง ",-1)),t("div",Ce,[t("div",null,[e[17]||(e[17]=t("label",{for:"travelDate",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" วันที่เดินทาง "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.date=l),id:"travelDate",name:"travelDate",type:"date",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.date]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"travelTime",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" เวลาออกเดินทาง "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.time=l),id:"travelTime",name:"travelTime",type:"time",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.time]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"seatCount",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" จำนวนที่นั่งที่รับได้ "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.availableSeats=l),id:"seatCount",name:"seatCount",type:"number",min:"1",placeholder:"กรอกจำนวนที่นั่ง (เช่น 4)",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.availableSeats,void 0,{number:!0}]]),e[20]||(e[20]=t("p",{class:"mt-1 text-xs text-gray-500"}," รถยนต์ส่วนบุคคลทั่วไปมี 4–5 ที่นั่ง หากใช้รถตู้/รถบัส ให้ระบุจำนวนได้ตามจริง ",-1))]),t("div",null,[e[21]||(e[21]=t("label",{for:"pricePerSeat",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" ราคาต่อที่นั่ง (บาท) "),t("span",{class:"text-red-500"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.pricePerSeat=l),id:"pricePerSeat",name:"pricePerSeat",type:"number",min:"0",placeholder:"เช่น 250",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[x,a.pricePerSeat,void 0,{number:!0}]])])])]),t("div",null,[e[26]||(e[26]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," ข้อมูลรถยนต์ ",-1)),N.value.length>0?(P(),v("div",Me,[t("div",null,[e[24]||(e[24]=t("label",{for:"vehicle",class:"block mb-2 text-sm font-medium text-gray-700"},[y(" เลือกรถยนต์ที่จะใช้ "),t("span",{class:"text-red-500"},"*")],-1)),p(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.vehicleId=l),id:"vehicle",name:"vehicle",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500"},[e[23]||(e[23]=t("option",{disabled:"",value:""},"กรุณาเลือกรถยนต์",-1)),(P(!0),v(me,null,pe(N.value,l=>(P(),v("option",{key:l.id,value:l.id},w(l.vehicleModel)+" ("+w(l.licensePlate)+") ",9,Te))),128))],512),[[ce,a.vehicleId]])]),t("div",_e,[t("button",{type:"button",onClick:e[9]||(e[9]=l=>I.value=!0),class:"w-full px-4 py-3 text-sm text-gray-800 transition-colors bg-gray-100 rounded-md md:w-auto hover:bg-gray-200"}," เพิ่ม / จัดการข้อมูลรถยนต์ ")])])):(P(),v("div",Ve,[t("div",Ie,[e[25]||(e[25]=t("p",{class:"text-gray-800 text-base md:text-[18px] text-center sm:text-left"}," คุณยังไม่มีข้อมูลรถยนต์ ",-1)),t("button",{type:"button",onClick:e[10]||(e[10]=l=>I.value=!0),class:"bg-[#2563EB] hover:bg-blue-600 text-white text-sm md:text-[16px] px-4 py-2 rounded-lg transition-colors whitespace-nowrap"}," เพิ่ม / จัดการข้อมูล ")])]))]),J(xe,{show:I.value,onClose:ee},null,8,["show"]),t("div",null,[e[27]||(e[27]=t("h3",{class:"pb-2 mb-6 text-xl font-semibold text-gray-900 border-b border-gray-300"}," เงื่อนไขและข้อตกลง ",-1)),p(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>a.conditions=l),id:"terms",name:"terms",rows:"4",placeholder:"ระบุเงื่อนไข เช่น ไม่สูบบุหรี่, ไม่นำสัตว์เลี้ยง, ชำระเงินล่วงหน้า 50%",class:"w-full px-4 py-3 border border-gray-300 rounded-md resize-none focus:ring-blue-500"},null,512),[[x,a.conditions]])]),t("div",Ae,[e[28]||(e[28]=t("button",{type:"button",class:"px-6 py-3 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"}," ยกเลิก ",-1)),t("button",{type:"submit",disabled:C.value,class:"px-6 py-3 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed"},w(C.value?"กำลังสร้าง...":"สร้างการเดินทาง"),9,Le)])],32)]),J(be,{name:"modal-fade"},{default:ge(()=>[D.value?(P(),v("div",{key:0,class:"modal-overlay",onClick:Q(L,["self"])},[t("div",Ne,[t("div",Ee,[t("h3",Fe," เลือก"+w(M.value==="start"?"จุดเริ่มต้น":"จุดปลายทาง"),1),t("button",{onClick:L,class:"text-gray-400 hover:text-gray-600"},e[29]||(e[29]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",De,[t("div",{ref_key:"placePickerMapEl",ref:z,class:"w-full border border-gray-200 rounded-md h-80"},null,512),t("div",$e,[e[30]||(e[30]=t("div",{class:"font-medium"},"ตำแหน่งที่เลือก:",-1)),t("div",Be,w(u.value.name||"— ยังไม่เลือก —"),1),u.value.lat&&u.value.lng?(P(),v("div",Ue," lat: "+w(u.value.lat.toFixed(6))+", lng: "+w(u.value.lng.toFixed(6)),1)):W("",!0)]),t("div",qe,[t("button",{onClick:L,class:"flex-1 px-4 py-2 font-semibold text-gray-800 bg-gray-200 rounded-md hover:bg-gray-300"}," ยกเลิก "),t("button",{disabled:!u.value.name,onClick:ae,class:"flex-1 px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," ใช้ตำแหน่งนี้ ",8,ze)])])])])):W("",!0)]),_:1})])]))}},He=ne(Oe,[["__scopeId","data-v-131ee866"]]);export{He as default};
