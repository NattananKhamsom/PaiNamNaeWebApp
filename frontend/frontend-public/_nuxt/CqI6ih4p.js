import{_ as Me}from"./Lcixqshc.js";import{a5 as Be,r as h,x as Ee,p as $e,i as Ne,y as me,H as Ae,c as p,b as G,a as t,w as Te,t as n,g as N,e as Ce,n as ge,d as A,F as De,q as ze,J as Re,o as f,B as Fe}from"./DPSIKoxe.js";import{u as He}from"./BaxiziUg.js";import{A as Ie,_ as Se}from"./CaCOxDSn.js";import{d as L}from"./B5yDJBm8.js";import{b as Pe}from"./C5FTVxxA.js";import"./DOK8vhV6.js";import"./Cpj98o6Y.js";const Ve={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},Ge={class:"mb-8"},je={class:"mx-auto max-w-8xl"},Oe={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Je={key:0,class:"p-8 text-center text-gray-500"},qe={key:1,class:"p-8 text-center text-red-600"},Ue={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6 text-[15px]"},We={class:"w-full max-w-[80rem] mx-auto space-y-6"},Ke={class:"overflow-hidden border border-gray-300 rounded-lg"},Qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Xe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ye={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ze={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},et={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},tt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},st={key:0,class:"mt-1 text-xs text-gray-500"},ot={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},at={key:0,class:"mt-1 text-xs text-gray-500"},rt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},lt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},nt={key:0,class:"mt-1 text-xs text-gray-500"},it={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},dt={key:0,class:"mt-1 text-xs text-gray-500"},ut={class:"grid grid-cols-1 gap-4 mt-4 sm:grid-cols-3"},mt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},gt={class:"text-gray-900"},ct={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},pt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},ft={class:"grid grid-cols-1 gap-4 mt-4 sm:grid-cols-2"},yt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},bt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},xt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},vt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},wt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},_t={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},kt={key:0,class:"space-y-1 text-gray-700"},ht={key:1,class:"text-gray-500"},Lt={key:0},Mt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Bt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Et={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},$t={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Nt={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},At={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Tt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},j="__gmapsReadyAdminBooking__",Vt={__name:"index",setup(Ct){L.locale("th"),L.extend(Pe),He({});const ce=Be(),T=h(!0),C=h(""),i=h(null),d=h(null),pe=Ee(()=>{var e;const s=(e=i.value)==null?void 0:e.passenger;return s?`${s.firstName||""} ${s.lastName||""}`.trim():""}),P=h(null);let m=null,D=null,z=null,R=null,F=null,H=null;const O=h(!1),fe=me();function I(s){return(s||"").replace(/,?\s*(Thailand|ไทย|ประเทศ)\s*$/i,"").replace(/\s{2,}/g," ").trim()}function J(s,e=!1){return s?e?L(s).format("D MMM BBBB HH:mm"):L(s).format("D MMM BBBB"):"-"}function q(s){if(!s)return"-";const e=s.name||"";return e||(typeof s.lat=="number"&&typeof s.lng=="number"?`(${s.lat.toFixed(6)}, ${s.lng.toFixed(6)})`:"-")}function ye(s){return s==="PENDING"?"bg-amber-100 text-amber-700":s==="CONFIRMED"?"bg-green-100 text-green-700":s==="CANCELLED"?"bg-red-100 text-red-700":s==="REJECTED"?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-700"}function be(s){return s==="PENDING"?"fa-clock":s==="CONFIRMED"?"fa-circle-check":s==="CANCELLED"?"fa-triangle-exclamation":s==="REJECTED"?"fa-circle-xmark":"fa-circle"}function xe(s,e){if(typeof s=="string"&&s.includes("+")){const l=s.split("+");let a=0;for(const r of l){const u=parseFloat(r.replace(/[^\d.]/g,""));Number.isNaN(u)||(/กม/.test(r)?a+=u*1e3:(/เมตร|ม\./.test(r),a+=u))}if(a>=1e3){const r=Math.round(a/1e3*10)/10;return`${r%1===0?r.toFixed(0):r} กม.`}return`${Math.round(a)} ม.`}if(typeof e=="number"){if(e>=1e3){const l=Math.round(e/1e3*10)/10;return`${l%1===0?l.toFixed(0):l} กม.`}return`${Math.round(e)} ม.`}return s||"-"}function ve(s,e){if(typeof s=="string"&&s.includes("+")){const l=s.split("+");let a=0;for(const g of l){const y=parseFloat(g.replace(/[^\d.]/g,""));Number.isNaN(y)||(/ชม/.test(g)?a+=y*60:a+=y)}const r=Math.floor(a/60),u=Math.round(a%60);return r?u?`${r} ชม. ${u} นาที`:`${r} ชม.`:`${u} นาที`}if(typeof e=="number"){const l=Math.round(e/60),a=Math.floor(l/60),r=l%60;return a?r?`${a} ชม. ${r} นาที`:`${a} ชม.`:`${r} นาที`}return s||"-"}function V(){!P.value||m||(m=new google.maps.Map(P.value,{center:{lat:13.7563,lng:100.5018},zoom:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0}),O.value=!0,setTimeout(()=>{google.maps.event.trigger(m,"resize")},0))}function U(){D&&(D.setMap(null),D=null),z&&(z.setMap(null),z=null),R&&(R.setMap(null),R=null),F&&(F.setMap(null),F=null),H&&(H.setMap(null),H=null)}async function M(){var y,w;if(!m||!i.value)return;U();const s=i.value.route||{},e=s.startLocation||{},l=s.endLocation||{},a=i.value.pickupLocation||{},r=i.value.dropoffLocation||{};typeof e.lat=="number"&&typeof e.lng=="number"&&(z=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:m,label:"A"})),typeof l.lat=="number"&&typeof l.lng=="number"&&(R=new google.maps.Marker({position:{lat:l.lat,lng:l.lng},map:m,label:"B"})),typeof a.lat=="number"&&typeof a.lng=="number"&&(F=new google.maps.Marker({position:{lat:a.lat,lng:a.lng},map:m,icon:"http://maps.google.com/mapfiles/ms/icons/purple-dot.png",title:a.name||"Pickup"})),typeof r.lat=="number"&&typeof r.lng=="number"&&(H=new google.maps.Marker({position:{lat:r.lat,lng:r.lng},map:m,icon:"http://maps.google.com/mapfiles/ms/icons/orange-dot.png",title:r.name||"Dropoff"}));const u=s.routePolyline||((y=s.landmarks)==null?void 0:y.overview_polyline),g=new google.maps.LatLngBounds;if(u&&((w=google.maps.geometry)!=null&&w.encoding)){const c=google.maps.geometry.encoding.decodePath(u);D=new google.maps.Polyline({path:c,map:m,strokeColor:"#2563eb",strokeOpacity:.9,strokeWeight:5}),c.forEach(k=>g.extend(k))}[e,l,a,r].forEach(c=>{typeof c.lat=="number"&&typeof c.lng=="number"&&g.extend(new google.maps.LatLng(c.lat,c.lng))}),g.isEmpty()||(m.fitBounds(g),setTimeout(()=>{google.maps.event.trigger(m,"resize"),m.fitBounds(g)},0))}async function W(){var s,e,l,a,r,u,g,y,w,c,k,B;T.value=!0,C.value="";try{const x=ce.params.id,S=me().public.apiBase,E=((s=Re("token"))==null?void 0:s.value)||localStorage.getItem("token"),v=await fetch(`${S}/bookings/admin/${x}`,{method:"GET",headers:{Accept:"application/json",...E?{Authorization:`Bearer ${E}`}:{}},credentials:"include"});let b;try{b=await v.json()}catch{const _=await v.text(),$=new Error(_||"Unexpected response from server");throw $.status=v.status,$}if(!v.ok){const _=new Error((b==null?void 0:b.message)||`Request failed with status ${v.status}`);throw _.status=v.status,_.payload=b,_}if(i.value=(b==null?void 0:b.data)||null,!i.value)throw new Error("Invalid response: missing data");const o=i.value.route||{};d.value={id:o.id,originName:((e=o.startLocation)==null?void 0:e.name)||(((l=o.startLocation)==null?void 0:l.lat)!=null?`(${o.startLocation.lat.toFixed(2)}, ${o.startLocation.lng.toFixed(2)})`:"-"),destinationName:((a=o.endLocation)==null?void 0:a.name)||(((r=o.endLocation)==null?void 0:r.lat)!=null?`(${o.endLocation.lat.toFixed(2)}, ${o.endLocation.lng.toFixed(2)})`:"-"),originAddress:(u=o.startLocation)!=null&&u.address?I(o.startLocation.address):null,destinationAddress:(g=o.endLocation)!=null&&g.address?I(o.endLocation.address):null,availableSeats:o.availableSeats,price:o.pricePerSeat,departureTime:o.departureTime?L(o.departureTime).format("HH:mm น."):"-",date:o.departureTime?L(o.departureTime).format("D MMMM BBBB"):"-",durationText:ve(o.duration,o.durationSeconds),distanceText:xe(o.distance,o.distanceMeters),polyline:o.routePolyline||((y=o.landmarks)==null?void 0:y.overview_polyline)||null,conditions:o.conditions,carDetails:o.vehicle?[`${o.vehicle.vehicleModel} (${o.vehicle.vehicleType})`,...o.vehicle.amenities||[]]:[],driver:{name:`${((w=o.driver)==null?void 0:w.firstName)||""} ${((c=o.driver)==null?void 0:c.lastName)||""}`.trim()||"ไม่ระบุชื่อ",isVerified:!!((k=o.driver)!=null&&k.isVerified)},createdAt:o.createdAt,updatedAt:o.updatedAt},(B=window.google)!=null&&B.maps&&M()}catch(x){console.error(x),C.value=(x==null?void 0:x.message)||"ไม่สามารถโหลดข้อมูลการจองได้",i.value=null}finally{T.value=!1}}function we(){window.__adminResizeHandler__=function(){const s=document.getElementById("sidebar"),e=document.getElementById("main-content"),l=document.getElementById("overlay");!s||!e||!l||(window.innerWidth>=1024?(s.classList.remove("mobile-open"),l.classList.add("hidden"),e.style.marginLeft=s.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0",m&&O.value&&(google.maps.event.trigger(m,"resize"),M()))},window.addEventListener("resize",window.__adminResizeHandler__)}function _e(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.__adminResizeHandler__}function ke(){const s=document.getElementById("sidebar"),e=document.getElementById("overlay");!s||!e||(s.classList.remove("mobile-open"),e.classList.add("hidden"))}return $e(T,async s=>{var e,l;s===!1&&(await Fe(),!m&&((e=window.google)!=null&&e.maps)&&V(),i.value&&((l=window.google)!=null&&l.maps)&&M())}),Ne(async()=>{var s;if(we(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),(s=window.google)!=null&&s.maps)V(),await W(),M();else{const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${fe.public.googleMapsApiKey}&libraries=places,geometry&callback=${j}`,e.async=!0,e.defer=!0,window[j]=()=>{try{delete window[j]}catch{}V(),W().then(()=>{M()})},document.head.appendChild(e)}}),Ae(()=>{_e(),U()}),(s,e)=>{var a,r,u,g,y,w,c,k,B,x,S,E,v,b,o,_,$,K,Q,X,Y,Z,ee,te,se,oe,ae,re,le,ne,ie,de,ue;const l=Me;return f(),p("div",null,[G(Ie),G(Se),t("main",Ve,[t("div",Ge,[G(l,{to:"/admin/bookings",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:Te(()=>e[0]||(e[0]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[0]})]),t("div",je,[e[30]||(e[30]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"รายละเอียดการจอง"),t("span",{class:"text-sm text-gray-500"},"ดูข้อมูลทั้งหมดของ Booking")])],-1)),t("div",Oe,[e[29]||(e[29]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลการจอง")],-1)),T.value?(f(),p("div",Je,"กำลังโหลดข้อมูล...")):C.value?(f(),p("div",qe,n(C.value),1)):(f(),p("div",Ue,[t("div",We,[t("section",null,[e[1]||(e[1]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"แผนที่เส้นทาง",-1)),t("div",Ke,[t("div",{ref_key:"mapEl",ref:P,class:"w-full",style:{height:"400px"}},null,512)]),e[2]||(e[2]=Ce('<p class="mt-2 text-xs text-gray-500"> หมุด <span class="font-medium">A</span> = ต้นทางเส้นทาง • หมุด <span class="font-medium">B</span> = ปลายทางเส้นทาง • หมุด <span class="font-medium">สีม่วง</span> = จุดรับผู้โดยสาร • หมุด <span class="font-medium">สีส้ม</span> = จุดส่งผู้โดยสาร </p>',1))]),t("section",null,[e[6]||(e[6]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"สรุปการจอง",-1)),t("div",Qe,[t("div",null,[e[3]||(e[3]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"Booking ID",-1)),t("div",Xe,n(((a=i.value)==null?void 0:a.id)||"-"),1)]),t("div",null,[e[4]||(e[4]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จำนวนที่นั่ง",-1)),t("div",Ye,n(((r=i.value)==null?void 0:r.numberOfSeats)??"-"),1)]),t("div",null,[e[5]||(e[5]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สถานะ",-1)),t("div",Ze,[t("span",{class:ge(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",ye((u=i.value)==null?void 0:u.status)])},[t("i",{class:ge(["mr-1 fa-solid",be((g=i.value)==null?void 0:g.status)])},null,2),A(" "+n(((y=i.value)==null?void 0:y.status)||"-"),1)],2)])])])]),t("section",null,[e[9]||(e[9]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"จุดรับ / จุดส่ง",-1)),t("div",et,[t("div",null,[e[7]||(e[7]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดรับผู้โดยสาร",-1)),t("div",tt,[A(n(q((w=i.value)==null?void 0:w.pickupLocation))+" ",1),(k=(c=i.value)==null?void 0:c.pickupLocation)!=null&&k.address?(f(),p("div",st,n(I(i.value.pickupLocation.address)),1)):N("",!0)])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดส่งผู้โดยสาร",-1)),t("div",ot,[A(n(q((B=i.value)==null?void 0:B.dropoffLocation))+" ",1),(S=(x=i.value)==null?void 0:x.dropoffLocation)!=null&&S.address?(f(),p("div",at,n(I(i.value.dropoffLocation.address)),1)):N("",!0)])])])]),t("section",null,[e[17]||(e[17]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดเส้นทาง",-1)),t("div",rt,[t("div",null,[e[10]||(e[10]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดเริ่มต้น",-1)),t("div",lt,[A(n(((E=d.value)==null?void 0:E.originName)||"-")+" ",1),(v=d.value)!=null&&v.originAddress?(f(),p("div",nt,n(d.value.originAddress),1)):N("",!0)])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดปลายทาง",-1)),t("div",it,[A(n(((b=d.value)==null?void 0:b.destinationName)||"-")+" ",1),(o=d.value)!=null&&o.destinationAddress?(f(),p("div",dt,n(d.value.destinationAddress),1)):N("",!0)])])]),t("div",ut,[t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วัน-เวลาออกเดินทาง",-1)),t("div",mt,[t("div",gt,n(((_=d.value)==null?void 0:_.date)||"-")+" "+n((($=d.value)==null?void 0:$.departureTime)||""),1)])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ราคา/ที่นั่ง",-1)),t("div",ct,n(((K=d.value)==null?void 0:K.price)!=null?`${d.value.price} บาท`:"-"),1)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ที่นั่งคงเหลือ",-1)),t("div",pt,n(((Q=d.value)==null?void 0:Q.availableSeats)??"-"),1)])]),t("div",ft,[t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะเวลาโดยประมาณ",-1)),t("div",yt,n(((X=d.value)==null?void 0:X.durationText)||"-"),1)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะทางโดยประมาณ",-1)),t("div",bt,n(((Y=d.value)==null?void 0:Y.distanceText)||"-"),1)])])]),t("section",null,[e[20]||(e[20]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ผู้ขับขี่",-1)),t("div",xt,[t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ขับ",-1)),t("div",vt,n(((ee=(Z=d.value)==null?void 0:Z.driver)==null?void 0:ee.name)||"-"),1)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"การยืนยันตัวตน",-1)),t("div",wt,n((se=(te=d.value)==null?void 0:te.driver)!=null&&se.isVerified?"ยืนยันแล้ว":"ยังไม่ยืนยัน"),1)])])]),t("section",null,[e[21]||(e[21]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดรถ",-1)),t("div",_t,[(ae=(oe=d.value)==null?void 0:oe.carDetails)!=null&&ae.length?(f(),p("ul",kt,[(f(!0),p(De,null,ze(d.value.carDetails,(he,Le)=>(f(),p("li",{key:Le},"• "+n(he),1))),128))])):(f(),p("div",ht,"— ไม่มีข้อมูลรถ —"))])]),(re=d.value)!=null&&re.conditions?(f(),p("section",Lt,[e[22]||(e[22]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เงื่อนไขการเดินทาง",-1)),t("div",Mt,n(d.value.conditions),1)])):N("",!0),t("section",null,[e[25]||(e[25]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ผู้โดยสาร",-1)),t("div",Bt,[t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อ-สกุล",-1)),t("div",Et,n(pe.value||"-"),1)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"การยืนยันตัวตน",-1)),t("div",$t,n((ne=(le=i.value)==null?void 0:le.passenger)!=null&&ne.isVerified?"ยืนยันแล้ว":"ยังไม่ยืนยัน"),1)])])]),t("section",null,[e[28]||(e[28]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ระบบ",-1)),t("div",Nt,[t("div",null,[e[26]||(e[26]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สร้างเมื่อ",-1)),t("div",At,n(J((ie=i.value)==null?void 0:ie.createdAt,!0)),1)]),t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ปรับปรุงล่าสุด",-1)),t("div",Tt,n(J(((de=i.value)==null?void 0:de.updatedAt)||((ue=d.value)==null?void 0:ue.updatedAt),!0)),1)])])])])]))])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:ke})])}}};export{Vt as default};
