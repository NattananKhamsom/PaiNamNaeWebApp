import{r as _,A as T,x as R,i as ne,H as ae,c as r,b as I,a as t,h,v as ie,I as le,z as C,e as $,t as i,g as B,F as P,q as O,y as S,J as z,s as re,C as M,o as d,d as U,n as H}from"./DPSIKoxe.js";import{u as de}from"./BaxiziUg.js";import{d as N}from"./B5yDJBm8.js";import{A as ce,_ as ue}from"./CaCOxDSn.js";import{C as pe}from"./CL2Ezi0q.js";import"./Cpj98o6Y.js";import"./Lcixqshc.js";import"./DOK8vhV6.js";const me={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},ge={class:"mx-auto max-w-8xl"},fe={class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},xe={class:"flex items-center gap-2"},ye={class:"mb-4 bg-white border border-gray-300 rounded-lg shadow-sm"},ve={class:"grid grid-cols-1 gap-3 px-4 py-4 sm:px-6 lg:grid-cols-[repeat(24,minmax(0,1fr))]"},be={class:"lg:col-span-4"},_e={class:"lg:col-span-6"},he={class:"lg:col-span-6"},we={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Ee={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 sm:px-6"},Le={class:"text-sm text-gray-600"},Ce={key:0,class:"p-8 text-center text-gray-500"},ke={key:1,class:"p-8 text-center text-red-600"},Ae={key:2,class:"overflow-x-auto"},Re={class:"min-w-full divide-y divide-gray-200"},Ie={class:"bg-white divide-y divide-gray-200"},Be={class:"px-4 py-3"},Pe={class:"flex items-center gap-3"},Me=["src"],Ne={class:"font-medium text-gray-900"},De={key:0,class:"text-xs text-gray-500"},Ve={class:"text-xs text-gray-500"},Te={key:0,class:"text-xs text-gray-400"},$e={class:"px-4 py-3 text-gray-700"},Oe={class:"px-4 py-3 text-gray-700"},Se={class:"px-4 py-3 text-gray-700"},ze={class:"inline-flex items-center px-2 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded-full"},Ue={class:"px-4 py-3"},He={class:"px-4 py-3 text-gray-700"},Ye={class:"text-sm"},qe={class:"text-xs text-gray-500"},je={class:"px-4 py-3"},Fe={class:"flex items-center gap-1"},Ge=["onClick"],Je=["onClick"],Ke=["onClick"],We={key:0},Qe={class:"flex flex-col gap-3 px-4 py-4 border-t border-gray-200 sm:px-6 sm:flex-row sm:items-center sm:justify-between"},Xe={class:"flex flex-wrap items-center gap-3 text-sm"},Ze={class:"flex items-center gap-2"},et={class:"flex items-center gap-1"},tt=["disabled"],st={key:0,class:"px-2 text-sm text-gray-500"},ot=["disabled","onClick"],nt=["disabled"],gt={__name:"index",setup(at){N.locale("th"),de({});const{toast:k}=re(),g=_(!0),y=_(""),v=_([]),n=T({page:1,limit:10,total:0,totalPages:1}),a=T({q:"",status:"",typeOnLicense:"",sort:"createdAt:desc"}),w=R(()=>Math.max(1,n.totalPages||Math.ceil((n.total||0)/(n.limit||10)))),Y=R(()=>{const o=w.value,e=n.page;if(!o||o<1)return[];if(o<=5)return Array.from({length:o},(l,m)=>m+1);const s=new Set([1,o,e]);e>2&&s.add(e-1),e<o-1&&s.add(e+1);const c=Array.from(s).sort((l,m)=>l-m),u=[];for(let l=0;l<c.length;l++)l>0&&c[l]-c[l-1]>1&&u.push("…"),u.push(c[l]);return u});function D(o,e=!1){return o?e?N(o).format("D MMMM YYYY HH:mm"):N(o).format("D MMMM YYYY"):"-"}function q(o){const[e,s]=(o||"").split(":");return!e||!["asc","desc"].includes(s)?{sortBy:"createdAt",sortOrder:"desc"}:{sortBy:e,sortOrder:s}}function j(o){return o==="APPROVED"?"bg-green-100 text-green-700":o==="REJECTED"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}function F(o){return o?{PRIVATE_CAR_TEMPORARY:"รถยนต์ส่วนบุคคลชั่วคราว (2 ปี)",PRIVATE_CAR:"รถยนต์ส่วนบุคคล (5 ปี)",PUBLIC_CAR:"รถยนต์สาธารณะ",LIFETIME:"ตลอดชีพ"}[o]||o:"-"}async function b(o=1){var e;g.value=!0,y.value="";try{const s=S(),c=z("token").value||localStorage.getItem("token"),{sortBy:u,sortOrder:l}=q(a.sort),m={page:o,limit:n.limit,q:a.q||void 0,status:a.status||void 0,typeOnLicense:a.typeOnLicense||void 0,sortBy:u,sortOrder:l},p=await $fetch("/driver-verifications/admin",{baseURL:s.public.apiBase,headers:{Accept:"application/json",...c?{Authorization:`Bearer ${c}`}:{}},query:m});v.value=(p==null?void 0:p.data)||[];const x=(p==null?void 0:p.pagination)||{};n.page=Number(x.page??o),n.limit=Number(x.limit??n.limit),n.total=Number(x.total??v.value.length),n.totalPages=Number(x.totalPages??Math.ceil(n.total/n.limit))}catch(s){console.error("Fetch DV (admin) error:",s),y.value=((e=s==null?void 0:s.data)==null?void 0:e.message)||"ไม่สามารถโหลดข้อมูลได้",k.error("เกิดข้อผิดพลาด",y.value),v.value=[]}finally{g.value=!1}}function A(o){o<1||o>w.value||b(o)}function E(){n.page=1,b(1)}function G(){a.q="",a.status="",a.typeOnLicense="",a.sort="createdAt:desc",n.page=1,b(1)}const L=_(!1),f=_(null),J=R(()=>{if(!f.value)return"";const o=f.value.user||{};return`ต้องการลบคำขอยืนยันของ ${`${o.firstName||""} ${o.lastName||""}`.trim()||o.email||f.value.licenseNumber||""} ใช่หรือไม่? การกระทำนี้ไม่สามารถย้อนกลับได้`});function K(o){f.value=o,L.value=!0}function W(){L.value=!1,f.value=null}async function Q(){var o;if(f.value)try{const e=S(),s=z("token").value||localStorage.getItem("token");await $fetch(`/driver-verifications/admin/${f.value.id}`,{baseURL:e.public.apiBase,method:"DELETE",headers:{Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{}}}),k.success("ลบสำเร็จ","รายการถูกลบออกแล้ว"),L.value=!1,b(n.page)}catch(e){console.error("Delete DV (admin) error:",e);const s=((o=e==null?void 0:e.data)==null?void 0:o.message)||"ไม่สามารถลบรายการได้";k.error("เกิดข้อผิดพลาด",s)}}function X(){M("/admin/driver-verifications/create").catch(()=>{})}function Z(o){M(`/admin/driver-verifications/${o.id}`).catch(()=>{})}function ee(o){M(`/admin/driver-verifications/${o.id}/edit`).catch(()=>{})}function te(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.remove("mobile-open"),e.classList.add("hidden"))}function se(){window.toggleSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),s=document.getElementById("toggle-icon");!o||!e||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(e.style.marginLeft="80px",s&&s.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",s&&s.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.toggleSubmenu=function(o){const e=document.getElementById(o),s=document.getElementById(o+"-icon");!e||!s||(e.classList.toggle("hidden"),e.classList.contains("hidden")?s.classList.replace("fa-chevron-up","fa-chevron-down"):s.classList.replace("fa-chevron-down","fa-chevron-up"))},window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),s=document.getElementById("overlay");!o||!e||!s||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),s.classList.add("hidden"),o.classList.contains("collapsed")?e.style.marginLeft="80px":e.style.marginLeft="280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function oe(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.toggleSubmenu,delete window.__adminResizeHandler__}return ne(()=>{se(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),b(1)}),ae(()=>{oe()}),(o,e)=>(d(),r("div",null,[I(ce),I(ue),t("main",me,[t("div",ge,[t("div",fe,[t("div",{class:"flex items-center gap-3"},[e[8]||(e[8]=t("h1",{class:"text-2xl font-semibold text-gray-800"},"Driver Verification Management",-1)),t("button",{onClick:X,class:"inline-flex items-center gap-2 px-3 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"},e[7]||(e[7]=[t("i",{class:"fa-solid fa-plus"},null,-1),t("span",{class:"hidden sm:inline"},"สร้างคำขอยืนยันตัวตน (แอดมิน)",-1)]))]),t("div",xe,[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.q=s),onKeyup:le(E,["enter"]),type:"text",placeholder:"ค้นหา: เลขใบขับขี่, ชื่อ, อีเมล, Username",class:"max-w-full px-3 py-2 border border-gray-300 rounded-md w-72 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[ie,a.q,void 0,{trim:!0}]]),t("button",{onClick:E,class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700"}," ค้นหา ")])]),t("div",ye,[t("div",ve,[t("div",be,[e[10]||(e[10]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สถานะคำขอ",-1)),h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[9]||(e[9]=[t("option",{value:""},"ทั้งหมด",-1),t("option",{value:"PENDING"},"PENDING",-1),t("option",{value:"APPROVED"},"APPROVED",-1),t("option",{value:"REJECTED"},"REJECTED",-1)]),512),[[C,a.status]])]),t("div",_e,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชนิดของใบขับขี่",-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.typeOnLicense=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[11]||(e[11]=[$('<option value="">ทั้งหมด</option><option value="PRIVATE_CAR_TEMPORARY">รถยนต์ส่วนบุคคลชั่วคราว (2 ปี)</option><option value="PRIVATE_CAR">รถยนต์ส่วนบุคคล (5 ปี)</option><option value="PUBLIC_CAR">รถยนต์สาธารณะ</option><option value="LIFETIME">ตลอดชีพ</option>',5)]),512),[[C,a.typeOnLicense]])]),t("div",he,[e[14]||(e[14]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เรียงตาม",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.sort=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[13]||(e[13]=[$('<option value="">(ค่าเริ่มต้น)</option><option value="createdAt:desc">สร้างล่าสุด</option><option value="createdAt:asc">สร้างเก่าสุด</option><option value="updatedAt:desc">อัปเดตล่าสุด</option><option value="updatedAt:asc">อัปเดตเก่าสุด</option>',5)]),512),[[C,a.sort]])]),t("div",{class:"flex items-end justify-end gap-2 mt-1 lg:col-span-8 lg:mt-0"},[t("button",{onClick:G,class:"px-3 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50"}," ล้างตัวกรอง "),t("button",{onClick:E,class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700"}," ใช้ตัวกรอง ")])])]),t("div",we,[t("div",Ee,[t("div",Le," หน้าที่ "+i(n.page)+" / "+i(w.value)+" • ทั้งหมด "+i(n.total)+" รายการ ",1)]),g.value?(d(),r("div",Ce,e[15]||(e[15]=[t("i",{class:"text-3xl fa-solid fa-spinner fa-spin"},null,-1),t("p",{class:"mt-2"},"กำลังโหลดข้อมูล...",-1)]))):y.value?(d(),r("div",ke,i(y.value),1)):(d(),r("div",Ae,[t("table",Re,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ผู้ใช้ (ชื่อ • อีเมล • Username)"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," เลขที่ใบขับขี่"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," ชื่อ-นามสกุลบนใบขับขี่"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," ชนิดใบขับขี่"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," สถานะคำขอ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"}," สร้างเมื่อ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"การกระทำ ")])],-1)),t("tbody",Ie,[(d(!0),r(P,null,O(v.value,s=>{var c,u,l,m,p,x;return d(),r("tr",{key:s.id,class:"transition-colors hover:bg-gray-50"},[t("td",Be,[t("div",Pe,[t("img",{src:((c=s.user)==null?void 0:c.profilePicture)||s.selfiePhotoUrl||"https://via.placeholder.com/80x80?text=Selfie",class:"object-cover w-12 h-12 rounded-full",alt:"avatar"},null,8,Me),t("div",null,[t("div",Ne,[U(i((u=s.user)==null?void 0:u.firstName)+" "+i((l=s.user)==null?void 0:l.lastName)+" ",1),(m=s.user)!=null&&m.username?(d(),r("span",De,"(@"+i(s.user.username)+")",1)):B("",!0)]),t("div",Ve,i((p=s.user)==null?void 0:p.email),1),(x=s.user)!=null&&x.phoneNumber?(d(),r("div",Te,"Tel: "+i(s.user.phoneNumber),1)):B("",!0)])])]),t("td",$e,i(s.licenseNumber||"-"),1),t("td",Oe,i((s.firstNameOnLicense||"-")+" "+(s.lastNameOnLicense||"")),1),t("td",Se,[t("span",ze,i(F(s.typeOnLicense)),1)]),t("td",Ue,[t("span",{class:H(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",j(s.status)])},[e[16]||(e[16]=t("i",{class:"mr-1 fa-solid fa-circle"},null,-1)),U(i(s.status),1)],2)]),t("td",He,[t("div",Ye,i(D(s.createdAt,!0)),1),t("div",qe,"อัปเดต "+i(D(s.updatedAt,!0)),1)]),t("td",je,[t("div",Fe,[t("button",{onClick:V=>Z(s),class:"p-2 text-gray-500 hover:text-emerald-600",title:"ดูรายละเอียด"},e[17]||(e[17]=[t("i",{class:"text-lg fa-regular fa-eye"},null,-1)]),8,Ge),t("button",{onClick:V=>ee(s),class:"p-2 text-gray-500 hover:text-blue-600",title:"แก้ไข"},e[18]||(e[18]=[t("i",{class:"text-lg fa-regular fa-pen-to-square"},null,-1)]),8,Je),t("button",{onClick:V=>K(s),class:"p-2 text-gray-500 hover:text-red-600",title:"ลบ"},e[19]||(e[19]=[t("i",{class:"text-lg fa-regular fa-trash-can"},null,-1)]),8,Ke)])])])}),128)),!g.value&&v.value.length===0?(d(),r("tr",We,e[20]||(e[20]=[t("td",{colspan:"7",class:"px-4 py-10 text-center text-gray-500"}," ไม่พบข้อมูลที่ตรงกับเงื่อนไข",-1)]))):B("",!0)])])])),t("div",Qe,[t("div",Xe,[t("div",Ze,[e[23]||(e[23]=t("span",{class:"text-xs text-gray-500"},"Limit:",-1)),h(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.limit=s),onChange:E,class:"px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500"},e[22]||(e[22]=[t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)]),544),[[C,n.limit,void 0,{number:!0}]])])]),t("nav",et,[t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:n.page<=1||g.value,onClick:e[5]||(e[5]=s=>A(n.page-1))}," Previous ",8,tt),(d(!0),r(P,null,O(Y.value,(s,c)=>(d(),r(P,{key:`p-${c}-${s}`},[s==="…"?(d(),r("span",st,"…")):(d(),r("button",{key:1,class:H(["px-3 py-2 text-sm border rounded-md",s===n.page?"bg-blue-50 text-blue-600 border-blue-200":"hover:bg-gray-50"]),disabled:g.value,onClick:u=>A(s)},i(s),11,ot))],64))),128)),t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:n.page>=w.value||g.value,onClick:e[6]||(e[6]=s=>A(n.page+1))}," Next ",8,nt)])])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:te}),I(pe,{show:L.value,title:"ยืนยันการลบ",message:J.value,confirmText:"ลบ",cancelText:"ยกเลิก",variant:"danger",onConfirm:Q,onCancel:W},null,8,["show","message"])]))}};export{gt as default};
