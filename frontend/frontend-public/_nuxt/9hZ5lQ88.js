import{_ as ue}from"./Lcixqshc.js";import{a5 as me,r as L,i as ce,y as Z,H as ge,c as g,b as j,a as t,w as pe,t as p,g as G,d as ee,F as O,q,J as ye,o as y}from"./DPSIKoxe.js";import{u as fe}from"./BaxiziUg.js";import{A as xe,_ as be}from"./CaCOxDSn.js";import{d as M}from"./B5yDJBm8.js";import{b as ve}from"./C5FTVxxA.js";import"./DOK8vhV6.js";import"./Cpj98o6Y.js";const we={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},_e={class:"mb-8"},he={class:"mx-auto max-w-8xl"},ke={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Me={key:0,class:"p-8 text-center text-gray-500"},$e={key:1,class:"p-8 text-center text-red-600"},Ae={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6 text-[15px]"},Be={class:"w-full max-w-[80rem] mx-auto space-y-6"},Le={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ee={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ce={key:0,class:"mt-1 text-xs text-gray-500"},Ne={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},ze={key:0,class:"mt-1 text-xs text-gray-500"},Re={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},Se={key:0,class:"space-y-1 text-gray-700"},Te={key:1,class:"text-gray-500"},He={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Fe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},De={class:"text-gray-900"},Ie={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ve={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Pe={class:"grid grid-cols-1 gap-4 mt-4 sm:grid-cols-2"},je={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ge={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Oe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},qe={key:0,class:"space-y-1 text-gray-700"},Ue={key:1,class:"text-gray-500"},We={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Je={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ke={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Qe={key:0},Xe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ye={class:"grid grid-cols-3 gap-2"},Ze=["src"],et={key:1,class:"col-span-3 p-4 text-center text-gray-500 border border-gray-300 rounded-md bg-gray-50"},tt={class:"overflow-hidden border border-gray-300 rounded-lg"},st={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},ot={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},lt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},U="__gmapsReadyAdminRoute__",pt={__name:"index_v1",setup(rt){M.locale("th"),M.extend(ve),fe({});const te=me(),D=L(!0),E=L(""),l=L(null),I=L(null);let w=null,C=null,N=null,z=null,R=[];L(!1);const se=Z();function V(s){return(s||"").replace(/,?\s*(Thailand|ไทย|ประเทศ)\s*$/i,"").replace(/\s{2,}/g," ").trim()}function W(s,e=!1){return s?e?M(s).format("D MMM BBBB HH:mm"):M(s).format("D MMM BBBB"):"-"}function J(){C&&(C.setMap(null),C=null),N&&(N.setMap(null),N=null),z&&(z.setMap(null),z=null),R.length&&(R.forEach(s=>s.setMap(null)),R=[])}function K(){!I.value||w||(w=new google.maps.Map(I.value,{center:{lat:13.7563,lng:100.5018},zoom:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0}),new google.maps.Geocoder,new google.maps.places.PlacesService(w))}function P(s){var n,a,i,d,o,f,b,x;if(!w||!s)return;J(),(n=s.start)!=null&&n.lat&&((a=s.start)!=null&&a.lng)&&(N=new google.maps.Marker({position:{lat:s.start.lat,lng:s.start.lng},map:w,label:"A"})),(i=s.end)!=null&&i.lat&&((d=s.end)!=null&&d.lng)&&(z=new google.maps.Marker({position:{lat:s.end.lat,lng:s.end.lng},map:w,label:"B"})),Array.isArray(s.stopsCoords)&&s.stopsCoords.length&&(R=s.stopsCoords.map((c,_)=>new google.maps.Marker({position:{lat:c.lat,lng:c.lng},map:w,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png",title:c.name||c.address||`จุดแวะ ${_+1}`})));const e=new google.maps.LatLngBounds;if(s.polyline&&((o=google.maps.geometry)!=null&&o.encoding)){const c=google.maps.geometry.encoding.decodePath(s.polyline);C=new google.maps.Polyline({path:c,map:w,strokeColor:"#2563eb",strokeOpacity:.9,strokeWeight:5}),c.forEach(_=>e.extend(_))}(f=s.start)!=null&&f.lat&&e.extend(new google.maps.LatLng(s.start.lat,s.start.lng)),(b=s.end)!=null&&b.lat&&e.extend(new google.maps.LatLng(s.end.lat,s.end.lng)),(x=s.stopsCoords)!=null&&x.length&&s.stopsCoords.forEach(c=>e.extend(new google.maps.LatLng(c.lat,c.lng))),e.isEmpty()||w.fitBounds(e)}async function oe(){var s,e,n,a,i,d,o,f,b;D.value=!0,E.value="";try{const x=te.params.id,c=Z().public.apiBase,_=((s=ye("token"))==null?void 0:s.value)||localStorage.getItem("token"),h=await fetch(`${c}/routes/admin/${x}`,{method:"GET",headers:{Accept:"application/json",..._?{Authorization:`Bearer ${_}`}:{}},credentials:"include"});let v;try{v=await h.json()}catch{const k=await h.text(),$=new Error(k||"Unexpected response from server");throw $.status=h.status,$}if(!h.ok){const k=new Error((v==null?void 0:v.message)||`Request failed with status ${h.status}`);throw k.status=h.status,k.payload=v,k}const r=v==null?void 0:v.data;if(!r)throw new Error("Invalid response: missing data");const{stops:S,stopsCoords:T}=de(r.waypoints),u=r.startLocation||{},m=r.endLocation||{},H=`${((e=r.driver)==null?void 0:e.firstName)||""} ${((n=r.driver)==null?void 0:n.lastName)||""}`.trim()||"ไม่ระบุชื่อ",F=((a=r.driver)==null?void 0:a.profilePicture)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((i=r.driver)==null?void 0:i.firstName)||"U")}&background=random&size=64`;l.value={id:r.id,start:u,end:m,originName:(u==null?void 0:u.name)||((u==null?void 0:u.lat)!=null&&(u==null?void 0:u.lng)!=null?`(${u.lat.toFixed(2)}, ${u.lng.toFixed(2)})`:"-"),destinationName:(m==null?void 0:m.name)||((m==null?void 0:m.lat)!=null&&(m==null?void 0:m.lng)!=null?`(${m.lat.toFixed(2)}, ${m.lng.toFixed(2)})`:"-"),originAddress:u!=null&&u.address?V(u.address):null,destinationAddress:m!=null&&m.address?V(m.address):null,availableSeats:r.availableSeats,price:r.pricePerSeat,departureTime:M(r.departureTime).format("HH:mm น."),date:M(r.departureTime).format("D MMMM BBBB"),durationText:ie(r.duration,r.durationSeconds),distanceText:ae(r.distance,r.distanceMeters),polyline:r.routePolyline||((d=r.landmarks)==null?void 0:d.overview_polyline)||null,stops:S,stopsCoords:T,conditions:r.conditions,photos:((o=r.vehicle)==null?void 0:o.photos)||[],carDetails:r.vehicle?[`${r.vehicle.vehicleModel} (${r.vehicle.vehicleType})`,...r.vehicle.amenities||[]]:["ไม่มีข้อมูลรถ"],driver:{name:H,image:F,isVerified:!!((f=r.driver)!=null&&f.isVerified)},createdAt:r.createdAt,updatedAt:r.updatedAt},(b=window.google)!=null&&b.maps&&P(l.value)}catch(x){console.error(x),E.value=(x==null?void 0:x.message)||"ไม่สามารถโหลดข้อมูลเส้นทางได้",l.value=null}finally{D.value=!1}}function le(){window.__adminResizeHandler__=function(){const s=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("overlay");!s||!e||!n||(window.innerWidth>=1024?(s.classList.remove("mobile-open"),n.classList.add("hidden"),e.style.marginLeft=s.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function re(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.__adminResizeHandler__}function ne(){const s=document.getElementById("sidebar"),e=document.getElementById("overlay");!s||!e||(s.classList.remove("mobile-open"),e.classList.add("hidden"))}function ae(s,e){if(typeof s=="string"&&s.includes("+")){const n=s.split("+");let a=0;for(const i of n){const d=parseFloat(i.replace(/[^\d.]/g,""));Number.isNaN(d)||(/กม/.test(i)?a+=d*1e3:(/เมตร|ม\./.test(i),a+=d))}if(a>=1e3){const i=Math.round(a/1e3*10)/10;return`${i%1===0?i.toFixed(0):i} กม.`}return`${Math.round(a)} ม.`}if(typeof e=="number"){if(e>=1e3){const n=Math.round(e/1e3*10)/10;return`${n%1===0?n.toFixed(0):n} กม.`}return`${Math.round(e)} ม.`}return s||"-"}function ie(s,e){if(typeof s=="string"&&s.includes("+")){const n=s.split("+");let a=0;for(const o of n){const f=parseFloat(o.replace(/[^\d.]/g,""));Number.isNaN(f)||(/ชม/.test(o)?a+=f*60:a+=f)}const i=Math.floor(a/60),d=Math.round(a%60);return i?d?`${i} ชม. ${d} นาที`:`${i} ชม.`:`${d} นาที`}if(typeof e=="number"){const n=Math.round(e/60),a=Math.floor(n/60),i=n%60;return a?i?`${a} ชม. ${i} นาที`:`${a} ชม.`:`${i} นาที`}return s||"-"}function de(s){const e=s||{},n=Array.isArray(e.used)&&e.used.length?e.used:Array.isArray(e.requested)?e.requested:[],a=Array.isArray(e.optimizedOrder)&&e.optimizedOrder.length===n.length?e.optimizedOrder.map(o=>n[o]):n,i=a.map(o=>{const f=(o==null?void 0:o.name)||"",b=V((o==null?void 0:o.address)||""),x=(o==null?void 0:o.lat)!=null&&(o==null?void 0:o.lng)!=null?`(${o.lat.toFixed(6)}, ${o.lng.toFixed(6)})`:"",c=f||x;return b?`${c} — ${b}`:c}).filter(Boolean),d=a.map(o=>o&&typeof o.lat=="number"&&typeof o.lng=="number"?{lat:o.lat,lng:o.lng,name:o.name||"",address:o.address||""}:null).filter(Boolean);return{stops:i,stopsCoords:d}}return ce(async()=>{var s,e;if(le(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),(s=window.google)!=null&&s.maps)K();else{const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${se.public.googleMapsApiKey}&libraries=places,geometry&callback=${U}`,n.async=!0,n.defer=!0,window[U]=()=>{try{delete window[U]}catch{}K(),l.value&&P(l.value)},document.head.appendChild(n)}await oe(),l.value&&((e=window.google)!=null&&e.maps)&&P(l.value)}),ge(()=>{re(),J()}),(s,e)=>{var a,i,d,o,f,b,x,c,_,h,v,r,S,T,u,m,H,F,k,$,Q,X,Y;const n=ue;return y(),g("div",null,[j(xe),j(be),t("main",we,[t("div",_e,[j(n,{to:"/admin/routes",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:pe(()=>e[0]||(e[0]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[0]})]),t("div",he,[e[23]||(e[23]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"รายละเอียดเส้นทาง"),t("span",{class:"text-sm text-gray-500"},"ดูข้อมูลทั้งหมดของ Route")])],-1)),t("div",ke,[e[22]||(e[22]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลเส้นทาง")],-1)),D.value?(y(),g("div",Me,"กำลังโหลดข้อมูล...")):E.value?(y(),g("div",$e,p(E.value),1)):(y(),g("div",Ae,[t("div",Be,[t("section",null,[e[3]||(e[3]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เส้นทาง",-1)),t("div",Le,[t("div",null,[e[1]||(e[1]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดเริ่มต้น",-1)),t("div",Ee,[ee(p(((a=l.value)==null?void 0:a.originName)||"-")+" ",1),(i=l.value)!=null&&i.originAddress?(y(),g("div",Ce,p(l.value.originAddress),1)):G("",!0)])]),t("div",null,[e[2]||(e[2]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดปลายทาง",-1)),t("div",Ne,[ee(p(((d=l.value)==null?void 0:d.destinationName)||"-")+" ",1),(o=l.value)!=null&&o.destinationAddress?(y(),g("div",ze,p(l.value.destinationAddress),1)):G("",!0)])])])]),t("section",null,[e[4]||(e[4]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"จุดแวะระหว่างทาง",-1)),t("div",Re,[(b=(f=l.value)==null?void 0:f.stops)!=null&&b.length?(y(),g("ul",Se,[(y(!0),g(O,null,q(l.value.stops,(A,B)=>(y(),g("li",{key:B},"• "+p(A),1))),128))])):(y(),g("div",Te,"— ไม่มีจุดแวะ —"))])]),t("section",null,[e[10]||(e[10]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เวลา ราคา และความพร้อมที่นั่ง",-1)),t("div",He,[t("div",null,[e[5]||(e[5]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วัน-เวลาออกเดินทาง",-1)),t("div",Fe,[t("div",De,p(((x=l.value)==null?void 0:x.date)||"-")+" "+p(((c=l.value)==null?void 0:c.departureTime)||""),1)])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ราคา/ที่นั่ง",-1)),t("div",Ie,p(((_=l.value)==null?void 0:_.price)!=null?`${l.value.price} บาท`:"-"),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ที่นั่งคงเหลือ",-1)),t("div",Ve,p(((h=l.value)==null?void 0:h.availableSeats)!=null?l.value.availableSeats:"-"),1)])]),t("div",Pe,[t("div",null,[e[8]||(e[8]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะเวลาโดยประมาณ",-1)),t("div",je,p(((v=l.value)==null?void 0:v.durationText)||"-"),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะทางโดยประมาณ",-1)),t("div",Ge,p(((r=l.value)==null?void 0:r.distanceText)||"-"),1)])])]),t("section",null,[e[11]||(e[11]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดรถ",-1)),t("div",Oe,[(T=(S=l.value)==null?void 0:S.carDetails)!=null&&T.length?(y(),g("ul",qe,[(y(!0),g(O,null,q(l.value.carDetails,(A,B)=>(y(),g("li",{key:B},"• "+p(A),1))),128))])):(y(),g("div",Ue,"— ไม่มีข้อมูลรถ —"))])]),t("section",null,[e[14]||(e[14]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ผู้ขับขี่",-1)),t("div",We,[t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ขับ",-1)),t("div",Je,p(((m=(u=l.value)==null?void 0:u.driver)==null?void 0:m.name)||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"การยืนยันตัวตน",-1)),t("div",Ke,p((F=(H=l.value)==null?void 0:H.driver)!=null&&F.isVerified?"ยืนยันแล้ว":"ยังไม่ยืนยัน"),1)])])]),(k=l.value)!=null&&k.conditions?(y(),g("section",Qe,[e[15]||(e[15]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เงื่อนไขการเดินทาง",-1)),t("div",Xe,p(l.value.conditions),1)])):G("",!0),t("section",null,[e[17]||(e[17]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รูปภาพรถยนต์",-1)),t("div",Ye,[(Q=($=l.value)==null?void 0:$.photos)!=null&&Q.length?(y(!0),g(O,{key:0},q(l.value.photos.slice(0,3),(A,B)=>(y(),g("div",{key:B},[t("img",{src:A,alt:"Vehicle",class:"object-cover w-full transition-opacity border border-gray-300 rounded-lg shadow-sm aspect-video hover:opacity-90"},null,8,Ze)]))),128)):(y(),g("div",et,e[16]||(e[16]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"ไม่มีรูป",-1)])))])]),t("section",null,[e[18]||(e[18]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"แผนที่เส้นทาง",-1)),t("div",tt,[t("div",{ref_key:"mapEl",ref:I,class:"w-full",style:{height:"400px"}},null,512)])]),t("section",null,[e[21]||(e[21]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ระบบ",-1)),t("div",st,[t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สร้างเมื่อ",-1)),t("div",ot,p(W((X=l.value)==null?void 0:X.createdAt,!0)),1)]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ปรับปรุงล่าสุด",-1)),t("div",lt,p(W((Y=l.value)==null?void 0:Y.updatedAt,!0)),1)])])])])]))])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:ne})])}}};export{pt as default};
