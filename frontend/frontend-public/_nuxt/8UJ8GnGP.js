import{_ as A}from"./Lcixqshc.js";import{a5 as N,A as G,r as p,i as q,H as J,y as V,J as D,s as W,c as u,b as C,a as t,w as K,t as U,h as f,v as P,z as O,e as Q,G as X,g as Y,d as Z,C as ee,o as c}from"./DPSIKoxe.js";import{u as te}from"./BaxiziUg.js";import{A as oe,_ as le}from"./CaCOxDSn.js";import"./DOK8vhV6.js";const se={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},ne={class:"mb-8"},ie={class:"mx-auto max-w-8xl"},ae={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},re={key:0,class:"p-8 text-center text-gray-500"},de={key:1,class:"p-8 text-center text-red-600"},ue={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6"},ce={class:"w-full max-w-[80rem] mx-auto space-y-6"},pe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},me={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-100 text-gray-600"},fe={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},ge=["src"],be={key:1,class:"text-gray-500"},ve=["src"],ye={key:1,class:"text-gray-500"},xe=["src"],he={key:1,class:"text-gray-500"},we={class:"flex items-center"},ke={class:"flex items-center justify-end gap-2 px-4 py-4 border-t border-gray-200 sm:px-6"},Pe=["disabled"],Be={key:0,class:"w-4 h-4 mr-1 -ml-1 animate-spin",viewBox:"0 0 24 24"},_e={__name:"edit",setup(Ie){const L=N(),{toast:v}=W(),o=G({vehicleType:"",vehicleModel:"",licensePlate:"",color:"",seatCapacity:1,isDefault:!1,photoFront:null,photoBack:null,licensePlatePhoto:null}),E=p(""),y=p(!0),g=p(""),x=p(!1),F=p(null),S=p(null),_=p(null),h=p(null),w=p(null),k=p(null);te({});function T(){const s=document.getElementById("sidebar"),e=document.getElementById("overlay");!s||!e||(s.classList.remove("mobile-open"),e.classList.add("hidden"))}function $(){window.toggleSidebar=function(){const s=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("toggle-icon");!s||!e||(s.classList.toggle("collapsed"),s.classList.contains("collapsed")?(e.style.marginLeft="80px",n&&n.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",n&&n.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const s=document.getElementById("sidebar"),e=document.getElementById("overlay");!s||!e||(s.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.__adminResizeHandler__=function(){const s=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("overlay");!s||!e||!n||(window.innerWidth>=1024?(s.classList.remove("mobile-open"),n.classList.add("hidden"),e.style.marginLeft=s.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function z(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.__adminResizeHandler__}q(async()=>{$(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),await R()}),J(()=>{z()});function B(s){var e,n,l;s==="photoFrontInput"&&((e=F.value)==null||e.click()),s==="photoBackInput"&&((n=S.value)==null||n.click()),s==="licensePlatePhotoInput"&&((l=_.value)==null||l.click())}function I(s,e){var i;const n=(i=s.target.files)==null?void 0:i[0];if(!n)return;const l=new FileReader;l.onload=r=>{var m;const a=(m=r.target)==null?void 0:m.result;e==="front"?(o.photoFront=n,h.value=a):e==="back"?(o.photoBack=n,w.value=a):e==="plate"&&(o.licensePlatePhoto=n,k.value=a)},l.readAsDataURL(n)}async function R(){var s,e,n,l;y.value=!0,g.value="";try{const i=L.params.id,r=V(),a=D("token").value||localStorage.getItem("token"),m=await $fetch(`/vehicles/admin/${i}`,{baseURL:r.public.apiBase,headers:{Accept:"application/json",...a?{Authorization:`Bearer ${a}`}:{}}}),d=m==null?void 0:m.data;if(!d)throw new Error("ไม่พบข้อมูลยานพาหนะ");o.vehicleType=d.vehicleType||"",o.vehicleModel=d.vehicleModel||"",o.licensePlate=d.licensePlate||"",o.color=d.color||"",o.seatCapacity=Number(d.seatCapacity??1),o.isDefault=!!d.isDefault;const b=d.user||{},M=[b.firstName,b.lastName].filter(Boolean).join(" ").trim();E.value=M?`${M}${b.email?` (${b.email})`:""}`:b.email||"-",h.value=((s=d.photos)==null?void 0:s[0])||null,w.value=((e=d.photos)==null?void 0:e[1])||null,k.value=((n=d.photos)==null?void 0:n[2])||null,o.photoFront=null,o.photoBack=null,o.licensePlatePhoto=null}catch(i){console.error("Fetch vehicle error:",i),g.value=((l=i==null?void 0:i.data)==null?void 0:l.message)||"ไม่สามารถโหลดข้อมูลยานพาหนะได้",v.error("เกิดข้อผิดพลาด",g.value)}finally{y.value=!1}}async function H(s,e,n){const l=await fetch(s,{method:"PUT",headers:{Accept:"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:e,credentials:"include"});let i;try{i=await l.json()}catch{const r=await l.text(),a=new Error(r||"Unexpected response");throw a.status=l.status,a}if(!l.ok){const r=(i==null?void 0:i.message)||"Request failed",a=new Error(r);throw a.status=l.status,a.payload=i,a}return i}async function j(){var s;if(!o.vehicleModel||!o.licensePlate||!o.vehicleType||!o.color||!o.seatCapacity){v.error("กรอกข้อมูลไม่ครบ","โปรดกรอกข้อมูลที่มี * ให้ครบถ้วน");return}x.value=!0;try{const e=L.params.id,n=V().public.apiBase,l=((s=D("token"))==null?void 0:s.value)||localStorage.getItem("token"),i=new FormData;i.append("vehicleType",o.vehicleType),i.append("vehicleModel",o.vehicleModel),i.append("licensePlate",o.licensePlate),i.append("color",o.color),i.append("seatCapacity",o.seatCapacity),i.append("isDefault",o.isDefault),o.photoFront instanceof File&&i.append("photos",o.photoFront),o.photoBack instanceof File&&i.append("photos",o.photoBack),o.licensePlatePhoto instanceof File&&i.append("photos",o.licensePlatePhoto);const r=await H(`${n}/vehicles/admin/${e}`,i,l);v.success("สำเร็จ",(r==null?void 0:r.message)||"อัปเดตยานพาหนะเรียบร้อย"),ee("/admin/vehicles")}catch(e){const n=(e==null?void 0:e.message)||"อัปเดตยานพาหนะไม่สำเร็จ";v.error("เกิดข้อผิดพลาด",n),console.error("Update vehicle error:",e)}finally{x.value=!1}}return(s,e)=>{const n=A;return c(),u("div",null,[C(oe),C(le),t("main",se,[t("div",ne,[C(n,{to:"/admin/vehicles",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:K(()=>e[12]||(e[12]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[12]})]),t("div",ie,[e[35]||(e[35]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"แก้ไขยานพาหนะ"),t("span",{class:"text-sm text-gray-500"},"ปรับข้อมูลแล้วกด “บันทึก”")])],-1)),t("div",ae,[e[34]||(e[34]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลยานพาหนะ")],-1)),y.value?(c(),u("div",re,e[13]||(e[13]=[t("i",{class:"text-3xl fa-solid fa-spinner fa-spin"},null,-1),t("p",{class:"mt-2"},"กำลังโหลดข้อมูล...",-1)]))):g.value?(c(),u("div",de,U(g.value),1)):(c(),u("div",ue,[t("div",ce,[t("div",null,[e[21]||(e[21]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดหลัก",-1)),t("div",pe,[t("div",null,[e[14]||(e[14]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เจ้าของยานพาหนะ",-1)),t("div",me,U(E.value),1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ป้ายทะเบียน *",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.licensePlate=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,o.licensePlate,void 0,{trim:!0}]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รุ่น / ยี่ห้อ *",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.vehicleModel=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,o.vehicleModel,void 0,{trim:!0}]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ประเภทยานพาหนะ *",-1)),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.vehicleType=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[17]||(e[17]=[Q('<option value="">-- เลือกประเภท --</option><option value="SEDAN">Sedan</option><option value="SUV">SUV</option><option value="Hatchback">Hatchback</option><option value="Van">Van</option><option value="Pickup">Pickup</option>',6)]),512),[[O,o.vehicleType]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สี *",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.color=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,o.color,void 0,{trim:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จำนวนที่นั่ง *",-1)),f(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.seatCapacity=l),type:"number",min:"1",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,o.seatCapacity,void 0,{number:!0}]])])])]),t("div",null,[e[28]||(e[28]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รูปภาพ",-1)),t("div",fe,[t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปด้านหน้า *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[5]||(e[5]=l=>B("photoFrontInput"))},[h.value?(c(),u("img",{key:0,src:h.value,class:"object-cover w-full h-32 rounded-md"},null,8,ge)):(c(),u("div",be,e[22]||(e[22]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"photoFrontInput",ref:F,type:"file",accept:"image/*",class:"hidden",onChange:e[6]||(e[6]=l=>I(l,"front"))},null,544)]),t("div",null,[e[25]||(e[25]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปด้านข้าง *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[7]||(e[7]=l=>B("photoBackInput"))},[w.value?(c(),u("img",{key:0,src:w.value,class:"object-cover w-full h-32 rounded-md"},null,8,ve)):(c(),u("div",ye,e[24]||(e[24]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"photoBackInput",ref:S,type:"file",accept:"image/*",class:"hidden",onChange:e[8]||(e[8]=l=>I(l,"back"))},null,544)]),t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปภายใน *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[9]||(e[9]=l=>B("licensePlatePhotoInput"))},[k.value?(c(),u("img",{key:0,src:k.value,class:"object-cover w-full h-32 rounded-md"},null,8,xe)):(c(),u("div",he,e[26]||(e[26]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"licensePlatePhotoInput",ref:_,type:"file",accept:"image/*",class:"hidden",onChange:e[10]||(e[10]=l=>I(l,"plate"))},null,544)])]),e[29]||(e[29]=t("p",{class:"mt-2 text-xs text-gray-500"},"* ไม่จำเป็นต้องอัปโหลดรูปใหม่ หากไม่ต้องการเปลี่ยนรูปเดิม",-1))]),t("div",null,[e[31]||(e[31]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ตัวเลือกเพิ่มเติม",-1)),t("div",we,[f(t("input",{id:"isDefault","onUpdate:modelValue":e[11]||(e[11]=l=>o.isDefault=l),type:"checkbox",class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[X,o.isDefault]]),e[30]||(e[30]=t("label",{for:"isDefault",class:"block ml-2 text-sm text-gray-900"},"ตั้งเป็นยานพาหนะเริ่มต้นสำหรับผู้ใช้นี้",-1))])])])])),t("div",ke,[t("button",{onClick:j,disabled:x.value||y.value,class:"inline-flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed"},[x.value?(c(),u("svg",Be,e[32]||(e[32]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{d:"M4 12a8 8 0 018-8",fill:"white",opacity:"0.75"},null,-1)]))):Y("",!0),e[33]||(e[33]=Z(" บันทึกการเปลี่ยนแปลง "))],8,Pe)])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:T})])}}};export{_e as default};
