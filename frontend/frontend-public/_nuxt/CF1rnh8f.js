import{_ as de}from"./Lcixqshc.js";import{A as ue,r as b,i as ce,H as me,c as m,b as W,a as t,w as pe,g as J,h as y,v as C,l as te,F as fe,q as be,d as K,t as M,z as ge,e as ve,G as ye,y as oe,J as ne,s as xe,C as he,o as p}from"./DPSIKoxe.js";import{u as ke}from"./BaxiziUg.js";import{A as we,_ as Ie}from"./CaCOxDSn.js";import{c as D,g as Pe}from"./Cpj98o6Y.js";import"./DOK8vhV6.js";var Q,le;function Ce(){if(le)return Q;le=1;var X="Expected a function",k=NaN,l="[object Symbol]",w=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,F=/^0b[01]+$/i,N=/^0o[0-7]+$/i,_=parseInt,B=typeof D=="object"&&D&&D.Object===Object&&D,S=typeof self=="object"&&self&&self.Object===Object&&self,L=B||S||Function("return this")(),x=Object.prototype,g=x.toString,h=Math.max,z=Math.min,T=function(){return L.Date.now()};function A(s,u,f){var n,e,r,o,i,c,d=0,E=!1,j=!1,H=!0;if(typeof s!="function")throw new TypeError(X);u=P(u)||0,V(f)&&(E=!!f.leading,j="maxWait"in f,r=j?h(P(f.maxWait)||0,u):r,H="trailing"in f?!!f.trailing:H);function q(a){var v=n,U=e;return n=e=void 0,d=a,o=s.apply(U,v),o}function se(a){return d=a,i=setTimeout($,u),E?q(a):o}function re(a){var v=a-c,U=a-d,ee=u-v;return j?z(ee,r-U):ee}function Y(a){var v=a-c,U=a-d;return c===void 0||v>=u||v<0||j&&U>=r}function $(){var a=T();if(Y(a))return Z(a);i=setTimeout($,re(a))}function Z(a){return i=void 0,H&&n?q(a):(n=e=void 0,o)}function ie(){i!==void 0&&clearTimeout(i),d=0,n=c=e=i=void 0}function ae(){return i===void 0?o:Z(T())}function G(){var a=T(),v=Y(a);if(n=arguments,e=this,c=a,v){if(i===void 0)return se(c);if(j)return i=setTimeout($,u),q(c)}return i===void 0&&(i=setTimeout($,u)),o}return G.cancel=ie,G.flush=ae,G}function V(s){var u=typeof s;return!!s&&(u=="object"||u=="function")}function R(s){return!!s&&typeof s=="object"}function O(s){return typeof s=="symbol"||R(s)&&g.call(s)==l}function P(s){if(typeof s=="number")return s;if(O(s))return k;if(V(s)){var u=typeof s.valueOf=="function"?s.valueOf():s;s=V(u)?u+"":u}if(typeof s!="string")return s===0?s:+s;s=s.replace(w,"");var f=F.test(s);return f||N.test(s)?_(s.slice(2),f?2:8):I.test(s)?k:+s}return Q=A,Q}var Be=Ce();const Se=Pe(Be),Le={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},Te={class:"mb-8"},Ee={class:"mx-auto max-w-8xl"},je={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Ue={class:"grid grid-cols-1 gap-6 p-4 sm:p-6"},Me={class:"w-full max-w-[80rem] mx-auto space-y-6"},Fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ne={class:"relative"},_e={key:0,class:"absolute z-10 w-full mt-1 overflow-auto bg-white border border-gray-300 rounded-md shadow-lg max-h-60"},Ve=["onClick"],Re={key:0,class:"mt-2 text-sm text-green-700"},$e={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},De=["src"],ze={key:1,class:"text-gray-500"},Ae=["src"],Oe={key:1,class:"text-gray-500"},He=["src"],qe={key:1,class:"text-gray-500"},Ge={class:"flex items-center"},We={class:"flex items-center justify-end gap-2 px-4 py-4 border-t border-gray-200 sm:px-6"},Je=["disabled"],Ke={key:0,class:"w-4 h-4 mr-1 -ml-1 animate-spin",viewBox:"0 0 24 24"},ot={__name:"create",setup(X){const{toast:k}=xe(),l=ue({userId:"",vehicleType:"",vehicleModel:"",licensePlate:"",color:"",seatCapacity:4,isDefault:!1,photoFront:null,photoBack:null,licensePlatePhoto:null}),w=b(!1),I=b(""),F=b(null),N=b(null),_=b(null),B=b(null),S=b(null),L=b(null),x=b(""),g=b([]),h=b(null);ke({});function z(){const n=document.getElementById("sidebar"),e=document.getElementById("overlay");!n||!e||(n.classList.remove("mobile-open"),e.classList.add("hidden"))}function T(){window.toggleSidebar=function(){const n=document.getElementById("sidebar"),e=document.getElementById("main-content"),r=document.getElementById("toggle-icon");!n||!e||(n.classList.toggle("collapsed"),n.classList.contains("collapsed")?(e.style.marginLeft="80px",r&&r.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",r&&r.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const n=document.getElementById("sidebar"),e=document.getElementById("overlay");!n||!e||(n.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.__adminResizeHandler__=function(){const n=document.getElementById("sidebar"),e=document.getElementById("main-content"),r=document.getElementById("overlay");!n||!e||!r||(window.innerWidth>=1024?(n.classList.remove("mobile-open"),r.classList.add("hidden"),e.style.marginLeft=n.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function A(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.__adminResizeHandler__}const R=Se(async()=>{if(x.value.length<2){g.value=[];return}try{const n=oe(),e=ne("token").value||localStorage.getItem("token"),r=await $fetch("/users/admin",{baseURL:n.public.apiBase,headers:{Authorization:`Bearer ${e}`},query:{q:x.value,limit:5}});g.value=(r==null?void 0:r.data)||[]}catch(n){console.error("User search failed:",n),g.value=[]}},300);function O(n){h.value=n,l.userId=n.id,x.value=`${n.firstName} ${n.lastName}`,g.value=[]}ce(()=>{T(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__()}),me(()=>{A()});function P(n){var e,r,o;n==="photoFrontInput"&&((e=F.value)==null||e.click()),n==="photoBackInput"&&((r=N.value)==null||r.click()),n==="licensePlatePhotoInput"&&((o=_.value)==null||o.click())}function s(n,e){var i;const r=(i=n.target.files)==null?void 0:i[0];if(!r)return;const o=new FileReader;o.onload=c=>{var E;const d=(E=c.target)==null?void 0:E.result;e==="front"?(l.photoFront=r,B.value=d):e==="back"?(l.photoBack=r,S.value=d):e==="plate"&&(l.licensePlatePhoto=r,L.value=d)},o.readAsDataURL(r)}async function u(n,e,r){const o=await fetch(n,{method:"POST",headers:{Accept:"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:e,credentials:"include"});let i;try{i=await o.json()}catch{const c=await o.text(),d=new Error(c||"Unexpected response from server");throw d.status=o.status,d}if(!o.ok){const c=(i==null?void 0:i.message)||`Request failed with status ${o.status}`,d=new Error(c);throw d.status=o.status,d.payload=i,d}return i}async function f(){var n;if(!l.userId||!l.vehicleModel||!l.licensePlate||!l.vehicleType||!l.color||!l.seatCapacity||!l.photoFront||!l.photoBack||!l.licensePlatePhoto){k.error("กรอกข้อมูลไม่ครบ","โปรดกรอกข้อมูลและอัปโหลดรูปภาพที่มี * ให้ครบถ้วน");return}w.value=!0;try{const e=new FormData;e.append("userId",l.userId),e.append("vehicleType",l.vehicleType),e.append("vehicleModel",l.vehicleModel),e.append("licensePlate",l.licensePlate),e.append("color",l.color),e.append("seatCapacity",l.seatCapacity),e.append("isDefault",l.isDefault);const r=I.value?I.value.split(",").map(d=>d.trim()).filter(Boolean):[];e.append("amenities",JSON.stringify(r)),e.append("photos",l.photoFront),e.append("photos",l.photoBack),e.append("photos",l.licensePlatePhoto);const o=((n=ne("token"))==null?void 0:n.value)||localStorage.getItem("token"),i=oe().public.apiBase||"http://localhost:3000/api",c=await u(`${i}/vehicles/admin`,e,o);k.success("สำเร็จ",(c==null?void 0:c.message)||"สร้างยานพาหนะเรียบร้อย"),he("/admin/vehicles")}catch(e){const r=(e==null?void 0:e.message)||"สร้างยานพาหนะไม่สำเร็จ";k.error("เกิดข้อผิดพลาด",r),console.error("Create vehicle error:",e)}finally{w.value=!1}}return(n,e)=>{const r=de;return p(),m("div",null,[W(we),W(Ie),t("main",Le,[t("div",Te,[W(r,{to:"/admin/vehicles",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:pe(()=>e[15]||(e[15]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[15]})]),t("div",Ee,[e[39]||(e[39]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"สร้างยานพาหนะใหม่"),t("span",{class:"text-sm text-gray-500"},"กรอกข้อมูลให้ครบถ้วน แล้วกด “บันทึก”")])],-1)),t("div",je,[e[38]||(e[38]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลยานพาหนะ")],-1)),t("div",Ue,[t("div",Me,[t("div",null,[e[24]||(e[24]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดหลัก",-1)),t("div",Fe,[t("div",null,[e[17]||(e[17]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เจ้าของยานพาหนะ *",-1)),t("div",Ne,[y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>x.value=o),onInput:e[1]||(e[1]=(...o)=>te(R)&&te(R)(...o)),type:"text",placeholder:"ค้นหาด้วยชื่อ, อีเมล...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,544),[[C,x.value,void 0,{trim:!0}]]),g.value.length>0&&!h.value?(p(),m("div",_e,[t("ul",null,[(p(!0),m(fe,null,be(g.value,o=>(p(),m("li",{key:o.id,onClick:i=>O(o),class:"px-3 py-2 cursor-pointer hover:bg-blue-50"},M(o.firstName)+" "+M(o.lastName)+" ("+M(o.email)+") ",9,Ve))),128))])])):J("",!0)]),h.value?(p(),m("div",Re,[e[16]||(e[16]=t("i",{class:"fa-solid fa-check-circle"},null,-1)),K(" เลือกแล้ว: "+M(h.value.firstName)+" "+M(h.value.lastName),1)])):J("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ประเภทยานพาหนะ *",-1)),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.vehicleType=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[18]||(e[18]=[ve('<option value="">-- เลือกประเภท --</option><option value="SEDAN">Sedan</option><option value="SUV">SUV</option><option value="Hatchback">Hatchback</option><option value="MINI-VAN">Mini-Van</option><option value="PICKUP">Pickup</option>',6)]),512),[[ge,l.vehicleType]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รุ่น / ยี่ห้อ *",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.vehicleModel=o),type:"text",placeholder:"Toyota Yaris",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,l.vehicleModel,void 0,{trim:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ป้ายทะเบียน *",-1)),y(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.licensePlate=o),type:"text",placeholder:"1กข 1234",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,l.licensePlate,void 0,{trim:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สี *",-1)),y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.color=o),type:"text",placeholder:"ขาว",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,l.color,void 0,{trim:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จำนวนที่นั่ง *",-1)),y(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.seatCapacity=o),type:"number",min:"1",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,l.seatCapacity,void 0,{number:!0}]])])])]),t("div",null,[e[25]||(e[25]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"สิ่งอำนวยความสะดวก (คั่นด้วย ,)",-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>I.value=o),type:"text",placeholder:"เช่น Air Conditioner, Music, Phone Charger",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,I.value,void 0,{trim:!0}]]),e[26]||(e[26]=t("p",{class:"mt-1 text-xs text-gray-500"},[K(" ตัวอย่าง: "),t("code",null,"airbag, abs, bluetooth")],-1))]),t("div",null,[e[33]||(e[33]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รูปภาพ",-1)),t("div",$e,[t("div",null,[e[28]||(e[28]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปด้านหน้า *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[8]||(e[8]=o=>P("photoFrontInput"))},[B.value?(p(),m("img",{key:0,src:B.value,class:"object-cover w-full h-32 rounded-md"},null,8,De)):(p(),m("div",ze,e[27]||(e[27]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"photoFrontInput",ref:F,type:"file",accept:"image/*",class:"hidden",onChange:e[9]||(e[9]=o=>s(o,"front"))},null,544)]),t("div",null,[e[30]||(e[30]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปด้านข้าง *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[10]||(e[10]=o=>P("photoBackInput"))},[S.value?(p(),m("img",{key:0,src:S.value,class:"object-cover w-full h-32 rounded-md"},null,8,Ae)):(p(),m("div",Oe,e[29]||(e[29]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"photoBackInput",ref:N,type:"file",accept:"image/*",class:"hidden",onChange:e[11]||(e[11]=o=>s(o,"back"))},null,544)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปภายใน *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[12]||(e[12]=o=>P("licensePlatePhotoInput"))},[L.value?(p(),m("img",{key:0,src:L.value,class:"object-cover w-full h-32 rounded-md"},null,8,He)):(p(),m("div",qe,e[31]||(e[31]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"licensePlatePhotoInput",ref:_,type:"file",accept:"image/*",class:"hidden",onChange:e[13]||(e[13]=o=>s(o,"plate"))},null,544)])])]),t("div",null,[e[35]||(e[35]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ตัวเลือกเพิ่มเติม",-1)),t("div",Ge,[y(t("input",{id:"isDefault","onUpdate:modelValue":e[14]||(e[14]=o=>l.isDefault=o),type:"checkbox",class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[ye,l.isDefault]]),e[34]||(e[34]=t("label",{for:"isDefault",class:"block ml-2 text-sm text-gray-900"}," ตั้งเป็นยานพาหนะเริ่มต้นสำหรับผู้ใช้นี้ ",-1))])])])]),t("div",We,[t("button",{onClick:f,disabled:w.value,class:"inline-flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed"},[w.value?(p(),m("svg",Ke,e[36]||(e[36]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{d:"M4 12a8 8 0 018-8",fill:"white",opacity:"0.75"},null,-1)]))):J("",!0),e[37]||(e[37]=K(" บันทึก "))],8,Je)])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:z})])}}};export{ot as default};
