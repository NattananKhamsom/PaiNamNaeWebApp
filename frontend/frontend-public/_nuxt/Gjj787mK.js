import{_ as M}from"./Lcixqshc.js";import{_ as H,a5 as T,r as p,A as B,i as q,H as G,y as F,J as U,c,b as N,a as t,w as J,t as Y,f as W,e as C,F as P,h as b,d as g,v as w,z as K,g as Q,o as u,s as X,C as Z}from"./DPSIKoxe.js";import{u as ee}from"./BaxiziUg.js";import{A as te,_ as se}from"./CaCOxDSn.js";import"./DOK8vhV6.js";const le={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6 min-h-screen"},ne={class:"max-w-6xl mx-auto"},ie={class:"mb-8"},ae={class:"flex w-full overflow-hidden bg-white border border-gray-300 rounded-lg shadow-lg"},oe={class:"flex-1 p-8"},re={key:0,class:"p-8 text-center text-gray-500"},de={key:1,class:"p-8 text-center text-red-600"},ce={class:"mb-2"},ue=["value"],me={class:"relative"},fe={class:"grid gap-6 mb-2 md:grid-cols-2"},ge={class:"space-y-4"},pe={class:"relative flex items-center justify-center h-40 p-4 border border-gray-300 rounded-lg upload-zone bg-gray-50"},be=["href"],ve=["src"],ye=["src"],xe={key:2,class:"text-sm text-gray-500"},we={class:"relative flex items-center justify-center h-40 p-8 border-2 border-gray-300 border-dashed rounded-lg upload-zone bg-gray-50 hover:bg-gray-100 hover:border-blue-400"},he={class:"relative"},_e={class:"grid gap-6 mb-2 md:grid-cols-2"},Le={class:"space-y-4"},ke={class:"relative flex items-center justify-center h-40 p-4 border border-gray-300 rounded-lg upload-zone bg-gray-50"},Ie=["href"],Ne=["src"],Ee=["src"],Se={key:2,class:"text-sm text-gray-500"},Oe={class:"relative flex items-center justify-center h-40 p-8 border-2 border-gray-300 border-dashed rounded-lg upload-zone bg-gray-50 hover:bg-gray-100 hover:border-blue-400"},De={class:"relative"},Be={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Fe={class:"flex justify-end gap-4 pt-6"},Ue=["disabled"],Ce=["disabled"],Pe={key:0,class:"w-5 h-5 mr-3 -ml-1 text-white animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Re={__name:"edit",setup(ze){ee({});const{toast:E}=X(),L=T().params.id,k=p(!0),h=p(""),a=p(null),s=B({licenseNumber:"",firstNameOnLicense:"",lastNameOnLicense:"",typeOnLicense:"",licenseIssueDate:"",licenseExpiryDate:""}),f=B({licenseFrontFile:null,licenseSelfieFile:null}),v=p(null),y=p(null),x=p(!1);q(async()=>{j(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),await R()}),G(()=>A());async function R(){var l,e,n,r,d,o,i;k.value=!0,h.value="";try{const m=F(),D=U("token").value||localStorage.getItem("token"),I=await $fetch(`/driver-verifications/admin/${L}`,{baseURL:m.public.apiBase,headers:{Accept:"application/json",...D?{Authorization:`Bearer ${D}`}:{}}});a.value=(I==null?void 0:I.data)||null,s.licenseNumber=((l=a.value)==null?void 0:l.licenseNumber)||"",s.firstNameOnLicense=((e=a.value)==null?void 0:e.firstNameOnLicense)||"",s.lastNameOnLicense=((n=a.value)==null?void 0:n.lastNameOnLicense)||"",s.typeOnLicense=((r=a.value)==null?void 0:r.typeOnLicense)||"",s.licenseIssueDate=(d=a.value)!=null&&d.licenseIssueDate?S(a.value.licenseIssueDate):"",s.licenseExpiryDate=(o=a.value)!=null&&o.licenseExpiryDate?S(a.value.licenseExpiryDate):""}catch(m){console.error("Fetch DV error:",m),h.value=((i=m==null?void 0:m.data)==null?void 0:i.message)||"ไม่สามารถโหลดข้อมูลได้"}finally{k.value=!1}}function S(l){const e=new Date(l),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${d}`}function O(l,e){var d;const n=(d=l.target.files)==null?void 0:d[0];if(!n)return;const r=new FileReader;r.onload=o=>{e==="front"?(v.value=o.target.result,f.licenseFrontFile=n):(y.value=o.target.result,f.licenseSelfieFile=n)},r.readAsDataURL(n)}function _(l){if(l==="front"){v.value=null,f.licenseFrontFile=null;const e=document.getElementById("license-front-input");e&&(e.value="")}else{y.value=null,f.licenseSelfieFile=null;const e=document.getElementById("license-selfie-input");e&&(e.value="")}}function z(){_("front"),_("selfie")}async function V(){var l,e,n,r,d;x.value=!0;try{const o=new FormData;s.licenseNumber!==((l=a.value)==null?void 0:l.licenseNumber)&&o.append("licenseNumber",s.licenseNumber),s.firstNameOnLicense!==((e=a.value)==null?void 0:e.firstNameOnLicense)&&o.append("firstNameOnLicense",s.firstNameOnLicense),s.lastNameOnLicense!==((n=a.value)==null?void 0:n.lastNameOnLicense)&&o.append("lastNameOnLicense",s.lastNameOnLicense),s.typeOnLicense&&s.typeOnLicense!==((r=a.value)==null?void 0:r.typeOnLicense)&&o.append("typeOnLicense",s.typeOnLicense),s.licenseIssueDate&&o.append("licenseIssueDate",new Date(s.licenseIssueDate).toISOString()),s.licenseExpiryDate&&o.append("licenseExpiryDate",new Date(s.licenseExpiryDate).toISOString()),f.licenseFrontFile&&o.append("licensePhotoUrl",f.licenseFrontFile),f.licenseSelfieFile&&o.append("selfiePhotoUrl",f.licenseSelfieFile);const i=F(),m=U("token").value||localStorage.getItem("token");await $fetch(`/driver-verifications/admin/${L}`,{baseURL:i.public.apiBase,method:"PUT",headers:{...m?{Authorization:`Bearer ${m}`}:{}},body:o}),E.success("บันทึกสำเร็จ","แก้ไขข้อมูลยืนยันตัวตนเรียบร้อย"),Z(`/admin/driver-verifications/${L}`).catch(()=>{})}catch(o){console.error("Update DV (admin) error:",o);const i=((d=o==null?void 0:o.data)==null?void 0:d.message)||"บันทึกการแก้ไขไม่สำเร็จ";E.error("เกิดข้อผิดพลาด",i)}finally{x.value=!1}}function $(){const l=document.getElementById("sidebar"),e=document.getElementById("overlay");!l||!e||(l.classList.remove("mobile-open"),e.classList.add("hidden"))}function j(){window.toggleSidebar=function(){const l=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("toggle-icon");!l||!e||(l.classList.toggle("collapsed"),l.classList.contains("collapsed")?(e.style.marginLeft="80px",n&&n.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",n&&n.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const l=document.getElementById("sidebar"),e=document.getElementById("overlay");!l||!e||(l.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.toggleSubmenu=function(l){const e=document.getElementById(l),n=document.getElementById(l+"-icon");!e||!n||(e.classList.toggle("hidden"),e.classList.contains("hidden")?n.classList.replace("fa-chevron-up","fa-chevron-down"):n.classList.replace("fa-chevron-down","fa-chevron-up"))},window.__adminResizeHandler__=function(){const l=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("overlay");!l||!e||!n||(window.innerWidth>=1024?(l.classList.remove("mobile-open"),n.classList.add("hidden"),l.classList.contains("collapsed")?e.style.marginLeft="80px":e.style.marginLeft="280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function A(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.toggleSubmenu,delete window.__adminResizeHandler__}return(l,e)=>{var r,d,o;const n=M;return u(),c("div",null,[N(te),N(se),t("main",le,[t("div",ne,[t("div",ie,[N(n,{to:"/admin/driver-verifications",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:J(()=>e[10]||(e[10]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[10]})]),e[28]||(e[28]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"แก้ไขคำขอยืนยันตัวตน (แอดมิน)"),t("span",{class:"text-sm text-gray-500"},"ปรับข้อมูล/อัปโหลดภาพ และอัปเดตสถานะคำขอนี้")])],-1)),t("div",ae,[t("main",oe,[k.value?(u(),c("div",re,"กำลังโหลดข้อมูล...")):h.value?(u(),c("div",de,Y(h.value),1)):(u(),c("form",{key:2,onSubmit:W(V,["prevent"]),novalidate:"",class:"space-y-8"},[t("div",ce,[e[11]||(e[11]=C('<div class="flex items-center mb-4" data-v-492ac3a4><div class="mr-4 step-indicator" data-v-492ac3a4>0</div><h2 class="text-xl font-semibold text-gray-800" data-v-492ac3a4> เจ้าของคำขอยืนยันตัวตน <span class="px-2 py-1 ml-2 text-xs text-gray-600 align-middle bg-gray-100 rounded-full" data-v-492ac3a4> ไม่สามารถแก้ไขเจ้าของคำขอได้ </span></h2></div><label class="block mb-2 text-sm font-medium text-gray-700" data-v-492ac3a4>ผู้ใช้</label>',2)),t("input",{value:(r=a.value)!=null&&r.user?`${a.value.user.firstName||""} ${a.value.user.lastName||""} (${a.value.user.email})`:"-",type:"text",class:"w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-lg bg-gray-50",disabled:""},null,8,ue)]),t("div",me,[e[14]||(e[14]=t("div",{class:"flex items-center mb-6"},[t("div",{class:"mr-4 step-indicator"},"1"),t("label",{class:"text-xl font-semibold text-gray-800"}," รูปบัตรขับขี่ประจำตัว (ด้านหน้า) ")],-1)),t("div",fe,[t("div",ge,[e[12]||(e[12]=t("h4",{class:"text-sm font-medium text-gray-700"},"ไฟล์ปัจจุบัน:",-1)),t("div",pe,[(d=a.value)!=null&&d.licensePhotoUrl&&!v.value?(u(),c("a",{key:0,href:a.value.licensePhotoUrl,target:"_blank",class:"block w-full h-full"},[t("img",{src:a.value.licensePhotoUrl,class:"object-contain w-full h-full rounded-md",alt:"license"},null,8,ve)],8,be)):v.value?(u(),c(P,{key:1},[t("img",{src:v.value,class:"object-contain w-full h-full rounded-md"},null,8,ye),t("button",{type:"button",onClick:e[0]||(e[0]=i=>_("front")),class:"absolute flex items-center justify-center w-8 h-8 text-white rounded-full top-2 right-2 bg-black/50"},"×")],64)):(u(),c("div",xe,"ไม่มีรูป"))])]),t("div",we,[e[13]||(e[13]=t("div",{class:"text-center pointer-events-none"},[t("i",{class:"mb-2 text-3xl text-gray-400 fa-solid fa-cloud-arrow-up"}),t("p",{class:"text-lg text-gray-600"},"คลิกเพื่ออัปโหลด"),t("p",{class:"text-sm text-gray-500"},"JPG, PNG (ไม่เกิน 10MB)")],-1)),t("input",{id:"license-front-input",type:"file",accept:"image/png, image/jpeg",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:e[1]||(e[1]=i=>O(i,"front"))},null,32)])])]),t("div",he,[e[17]||(e[17]=t("div",{class:"flex items-center mb-6"},[t("div",{class:"mr-4 step-indicator"},"2"),t("label",{class:"text-xl font-semibold text-gray-800"}," รูปถ่าย (Selfie) ")],-1)),t("div",_e,[t("div",Le,[e[15]||(e[15]=t("h4",{class:"text-sm font-medium text-gray-700"},"ไฟล์ปัจจุบัน:",-1)),t("div",ke,[(o=a.value)!=null&&o.selfiePhotoUrl&&!y.value?(u(),c("a",{key:0,href:a.value.selfiePhotoUrl,target:"_blank",class:"block w-full h-full"},[t("img",{src:a.value.selfiePhotoUrl,class:"object-contain w-full h-full rounded-md",alt:"selfie"},null,8,Ne)],8,Ie)):y.value?(u(),c(P,{key:1},[t("img",{src:y.value,class:"object-contain w-full h-full rounded-md"},null,8,Ee),t("button",{type:"button",onClick:e[2]||(e[2]=i=>_("selfie")),class:"absolute flex items-center justify-center w-8 h-8 text-white rounded-full top-2 right-2 bg-black/50"},"×")],64)):(u(),c("div",Se,"ไม่มีรูป"))])]),t("div",Oe,[e[16]||(e[16]=t("div",{class:"text-center pointer-events-none"},[t("i",{class:"mb-2 text-3xl text-gray-400 fa-solid fa-cloud-arrow-up"}),t("p",{class:"text-lg text-gray-600"},"คลิกเพื่ออัปโหลด"),t("p",{class:"text-sm text-gray-500"},"JPG, PNG (ไม่เกิน 10MB)")],-1)),t("input",{id:"license-selfie-input",type:"file",accept:"image/png, image/jpeg",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:e[3]||(e[3]=i=>O(i,"selfie"))},null,32)])])]),t("div",De,[e[25]||(e[25]=t("div",{class:"flex items-center mb-4"},[t("div",{class:"mr-4 step-indicator"},"3"),t("h2",{class:"text-xl font-semibold text-gray-800"},"ข้อมูลในบัตรขับขี่ประจำตัว")],-1)),t("div",Be,[t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("เลขที่ใบขับขี่ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>s.licenseNumber=i),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[w,s.licenseNumber,void 0,{trim:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("ชนิดของบัตรขับขี่ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>s.typeOnLicense=i),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},e[19]||(e[19]=[C('<option disabled value="" data-v-492ac3a4>กรุณาเลือกชนิดของบัตร</option><option value="PRIVATE_CAR_TEMPORARY" data-v-492ac3a4>รถยนต์ส่วนบุคคลชั่วคราว (2 ปี)</option><option value="PRIVATE_CAR" data-v-492ac3a4>รถยนต์ส่วนบุคคล (5 ปี)</option><option value="PUBLIC_CAR" data-v-492ac3a4>รถยนต์สาธารณะ</option><option value="LIFETIME" data-v-492ac3a4>ตลอดชีพ</option>',5)]),512),[[K,s.typeOnLicense]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("ชื่อ (บนบัตร) "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>s.firstNameOnLicense=i),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[w,s.firstNameOnLicense,void 0,{trim:!0}]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("นามสกุล (บนบัตร) "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>s.lastNameOnLicense=i),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[w,s.lastNameOnLicense,void 0,{trim:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("วันออกใบขับขี่ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.licenseIssueDate=i),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[w,s.licenseIssueDate]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},[g("วันหมดอายุใบขับขี่ "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>s.licenseExpiryDate=i),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[w,s.licenseExpiryDate]])])])]),t("div",Fe,[t("button",{type:"button",onClick:z,disabled:x.value,class:"px-6 py-3 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50"}," ล้างรูปที่อัปโหลด ",8,Ue),t("button",{type:"submit",disabled:x.value,class:"flex items-center px-6 py-3 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed"},[x.value?(u(),c("svg",Pe,e[26]||(e[26]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):Q("",!0),e[27]||(e[27]=g(" บันทึกการแก้ไข "))],8,Ce)])],32))])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:$})])}}},Te=H(Re,[["__scopeId","data-v-492ac3a4"]]);export{Te as default};
