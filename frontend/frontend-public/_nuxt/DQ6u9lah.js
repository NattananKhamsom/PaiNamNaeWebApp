import{_ as z}from"./Lcixqshc.js";import{a5 as _,A as T,r as c,i as F,H,y as S,J as L,s as j,c as u,b as w,a as t,w as G,t as O,h as i,v as p,z as C,g as q,d as J,C as W,o as m}from"./DPSIKoxe.js";import{u as Y}from"./BaxiziUg.js";import{A as Z,_ as K}from"./CaCOxDSn.js";import"./DOK8vhV6.js";const Q={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},X={class:"mb-8"},ee={class:"mx-auto max-w-8xl"},te={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},se={key:0,class:"p-8 text-center text-gray-500"},le={key:1,class:"p-8 text-center text-red-600"},oe={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6"},ne={class:"w-full max-w-[80rem] mx-auto space-y-6"},ae={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},re={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ie={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},de={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},ue={key:0,class:"flex items-center justify-center"},me=["src"],pe={key:1,class:"text-gray-500"},ce={key:0,class:"flex items-center justify-center"},fe=["src"],ge={key:1,class:"text-gray-500"},be={class:"flex items-center justify-end gap-2 px-4 py-4 border-t border-gray-200 sm:px-6"},xe=["disabled"],ye={key:0,class:"w-4 h-4 mr-1 -ml-1 animate-spin",viewBox:"0 0 24 24"},Ue={__name:"edit",setup(ve){const I=_(),{toast:f}=j(),s=T({email:"",username:"",password:"",firstName:"",lastName:"",phoneNumber:"",gender:"",role:"PASSENGER",nationalIdNumber:"",nationalIdExpiryDate:"",nationalIdPhotoUrl:null,selfiePhotoUrl:null}),b=c(!0),g=c(""),x=c(!1),y=c(null),v=c(null),k=c(null),N=c(null);Y({});function D(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.remove("mobile-open"),e.classList.add("hidden"))}function R(){window.toggleSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),a=document.getElementById("toggle-icon");!o||!e||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(e.style.marginLeft="80px",a&&a.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",a&&a.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),a=document.getElementById("overlay");!o||!e||!a||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),a.classList.add("hidden"),e.style.marginLeft=o.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function B(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.__adminResizeHandler__}F(async()=>{R(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),await V()}),H(()=>{B()});function E(o){var e,a;o==="idCardInput"&&((e=k.value)==null||e.click()),o==="selfieInput"&&((a=N.value)==null||a.click())}function U(o,e){var n;const a=(n=o.target.files)==null?void 0:n[0];if(!a)return;const l=new FileReader;l.onload=r=>{var d,h;e==="id"?(s.nationalIdPhotoUrl=a,y.value=(d=r.target)==null?void 0:d.result):(s.selfiePhotoUrl=a,v.value=(h=r.target)==null?void 0:h.result)},l.readAsDataURL(a)}function P(o){return o?new Date(`${o}T00:00:00.000Z`).toISOString():""}function A(o){if(!o)return"";const e=new Date(o),a=e.getUTCFullYear(),l=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0");return`${a}-${l}-${n}`}async function V(){var o;b.value=!0,g.value="";try{const e=I.params.id,a=S(),l=L("token").value||localStorage.getItem("token"),n=await $fetch(`/users/admin/${e}`,{baseURL:a.public.apiBase,headers:{Accept:"application/json",...l?{Authorization:`Bearer ${l}`}:{}}}),r=(n==null?void 0:n.data)||{};s.email=r.email||"",s.username=r.username||"",s.password="",s.firstName=r.firstName||"",s.lastName=r.lastName||"",s.phoneNumber=r.phoneNumber||"",s.gender=(r.gender||"").toUpperCase(),s.role=(r.role||"PASSENGER").toUpperCase(),s.nationalIdNumber=r.nationalIdNumber||"",s.nationalIdExpiryDate=A(r.nationalIdExpiryDate),y.value=r.nationalIdPhotoUrl||null,v.value=r.selfiePhotoUrl||null}catch(e){console.error(e),g.value=((o=e==null?void 0:e.data)==null?void 0:o.message)||"ไม่สามารถโหลดข้อมูลผู้ใช้ได้",f.error("เกิดข้อผิดพลาด",g.value)}finally{b.value=!1}}async function M(o,e,a){const l=await fetch(o,{method:"PUT",headers:{Accept:"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:e,credentials:"include"});let n;try{n=await l.json()}catch{const r=await l.text(),d=new Error(r||"Unexpected response from server");throw d.status=l.status,d}if(!l.ok){const r=(n==null?void 0:n.message)||`Request failed with status ${l.status}`,d=new Error(r);throw d.status=l.status,d.payload=n,d}return n}async function $(){var o;if(!s.email||!s.username||!s.firstName||!s.lastName||!s.phoneNumber||!s.gender||!s.nationalIdNumber||!s.nationalIdExpiryDate){f.error("กรอกข้อมูลไม่ครบ","โปรดกรอกข้อมูลที่มี * ให้ครบถ้วน");return}x.value=!0;try{const e=I.params.id,a=S().public.apiBase||"http://localhost:3000/api";let l="";try{l=((o=L("token"))==null?void 0:o.value)||""}catch{}l||(l=localStorage.getItem("token")||"");const n=new FormData;n.append("email",s.email),n.append("username",s.username),s.password&&n.append("password",s.password),n.append("firstName",s.firstName),n.append("lastName",s.lastName),n.append("phoneNumber",s.phoneNumber),n.append("gender",s.gender.toUpperCase()),n.append("nationalIdNumber",s.nationalIdNumber),n.append("nationalIdExpiryDate",P(s.nationalIdExpiryDate)),n.append("role",s.role),s.nationalIdPhotoUrl instanceof File&&n.append("nationalIdPhotoUrl",s.nationalIdPhotoUrl),s.selfiePhotoUrl instanceof File&&n.append("selfiePhotoUrl",s.selfiePhotoUrl);const r=await M(`${a}/users/admin/${e}`,n,l);f.success("สำเร็จ",(r==null?void 0:r.message)||"อัปเดตผู้ใช้เรียบร้อย"),W("/admin/users")}catch(e){const a=e==null?void 0:e.status,l=(e==null?void 0:e.message)||"อัปเดตผู้ใช้ไม่สำเร็จ";a===409?f.error("ข้อมูลซ้ำ",l):f.error("เกิดข้อผิดพลาด",l)}finally{x.value=!1}}return(o,e)=>{const a=z;return m(),u("div",null,[w(Z),w(K),t("main",Q,[t("div",X,[w(a,{to:"/admin/users",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:G(()=>e[14]||(e[14]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[14]})]),t("div",ee,[e[37]||(e[37]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"แก้ไขผู้ใช้"),t("span",{class:"text-sm text-gray-500"},"ปรับข้อมูลแล้วกด “บันทึก”")])],-1)),t("div",te,[e[36]||(e[36]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลผู้ใช้")],-1)),b.value?(m(),u("div",se,"กำลังโหลดข้อมูล...")):g.value?(m(),u("div",le,O(g.value),1)):(m(),u("div",oe,[t("div",ne,[t("div",null,[e[19]||(e[19]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัญชีผู้ใช้",-1)),t("div",ae,[t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"อีเมล *",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.email=l),type:"email",placeholder:"example@email.com",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.email,void 0,{trim:!0}]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ใช้ (username) *",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.username=l),type:"text",placeholder:"user_001",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.username,void 0,{trim:!0}]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รหัสผ่าน (เว้นว่างถ้าไม่เปลี่ยน)",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.password=l),type:"password",placeholder:"อย่างน้อย 8 ตัวอักษร",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.password]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เบอร์โทรศัพท์ *",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.phoneNumber=l),type:"tel",placeholder:"0891234567",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.phoneNumber,void 0,{trim:!0}]])])])]),t("div",null,[e[26]||(e[26]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ข้อมูลส่วนตัว",-1)),t("div",re,[t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อจริง *",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.firstName=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.firstName,void 0,{trim:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"นามสกุล *",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.lastName=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.lastName,void 0,{trim:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เพศ *",-1)),i(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.gender=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[22]||(e[22]=[t("option",{value:""},"-- เลือก --",-1),t("option",{value:"MALE"},"MALE",-1),t("option",{value:"FEMALE"},"FEMALE",-1)]),512),[[C,s.gender]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"บทบาท *",-1)),i(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.role=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[24]||(e[24]=[t("option",{value:"PASSENGER"},"PASSENGER",-1),t("option",{value:"DRIVER"},"DRIVER",-1),t("option",{value:"ADMIN"},"ADMIN",-1)]),512),[[C,s.role]])])])]),t("div",null,[e[29]||(e[29]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัตรประชาชน",-1)),t("div",ie,[t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เลขบัตรประชาชน *",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.nationalIdNumber=l),type:"text",placeholder:"13 หลัก",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.nationalIdNumber,void 0,{trim:!0}]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วันหมดอายุบัตร *",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.nationalIdExpiryDate=l),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[p,s.nationalIdExpiryDate]])])])]),t("div",de,[t("div",null,[e[31]||(e[31]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปบัตรประชาชน *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[10]||(e[10]=l=>E("idCardInput"))},[y.value?(m(),u("div",ue,[t("img",{src:y.value,class:"rounded max-h-82"},null,8,me)])):(m(),u("div",pe,e[30]||(e[30]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"idCardInput",ref:k,type:"file",accept:"image/*",class:"hidden",onChange:e[11]||(e[11]=l=>U(l,"id"))},null,544)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปถ่ายใบหน้า (Selfie) *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[12]||(e[12]=l=>E("selfieInput"))},[v.value?(m(),u("div",ce,[t("img",{src:v.value,class:"rounded max-h-82"},null,8,fe)])):(m(),u("div",ge,e[32]||(e[32]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"selfieInput",ref:N,type:"file",accept:"image/*",class:"hidden",onChange:e[13]||(e[13]=l=>U(l,"selfie"))},null,544)])])])])),t("div",be,[t("button",{onClick:$,disabled:x.value||b.value,class:"inline-flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed"},[x.value?(m(),u("svg",ye,e[34]||(e[34]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{d:"M4 12a8 8 0 018-8",fill:"white",opacity:"0.75"},null,-1)]))):q("",!0),e[35]||(e[35]=J(" บันทึก "))],8,xe)])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:D})])}}};export{Ue as default};
