import{_ as D,m as $,r as p,A as j,i as B,c as g,a as s,b as A,e as T,f as z,g as k,l as x,h as n,v as d,d as v,t as E,s as H,o as y}from"./DPSIKoxe.js";import{u as Y}from"./DOK8vhV6.js";import{_ as I}from"./BE2kpsnt.js";import{d as U}from"./B5yDJBm8.js";import"./Lcixqshc.js";import"./Cpj98o6Y.js";const L={class:"flex items-center justify-center min-h-screen py-8"},R={class:"flex w-full max-w-6xl mx-4 overflow-hidden bg-white border border-gray-300 rounded-lg shadow-lg"},S={class:"flex-1 p-8"},O={class:"text-center"},W=["src"],_=["value"],q={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},G={key:0,class:"-mt-2 text-center"},J={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},K={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Q=["value"],X=["value"],Z={class:"pt-6 border-t border-gray-200"},ee={class:"grid grid-cols-1 gap-6 mt-4 md:grid-cols-2"},se={class:"flex justify-end gap-4 pt-6"},te=["disabled"],re=["disabled"],oe={key:0,class:"w-5 h-5 mr-3 -ml-1 text-white animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},le={__name:"index",setup(ae){U.locale("th");const{$api:c}=$(),{user:V}=Y(),{toast:b}=H(),f=p(null),w=p(""),i=p(!1),u=p(!1),t=j({firstName:"",lastName:"",email:"",phoneNumber:"",profilePictureFile:null,currentPassword:"",newPassword:"",confirmNewPassword:""});let o=null;const F=async()=>{try{o={...await c("/users/me")},P()}catch(l){console.error("Failed to fetch user data:",l),b.error("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลผู้ใช้ได้")}},P=()=>{o&&(t.firstName=o.firstName||"",t.lastName=o.lastName||"",t.email=o.email||"",t.phoneNumber=o.phoneNumber||"",w.value=o.profilePicture||`https://ui-avatars.com/api/?name=${t.firstName||"U"}&background=random&size=128`,t.currentPassword="",t.newPassword="",t.confirmNewPassword="",t.profilePictureFile=null)},N=l=>l?U(l).format("D MMMM YYYY HH:mm"):"";B(()=>{F()});function C(l){var a;const e=(a=l.target.files)==null?void 0:a[0];e&&(t.profilePictureFile=e,w.value=URL.createObjectURL(e))}async function M(){var l;i.value=!0;try{const e=new FormData;e.append("firstName",t.firstName),e.append("lastName",t.lastName),e.append("email",t.email),e.append("phoneNumber",t.phoneNumber),t.profilePictureFile&&e.append("profilePicture",t.profilePictureFile);const a=await c("/users/me",{method:"PUT",body:e});V.value=a,o={...a};let m=!1;if(t.currentPassword||t.newPassword||t.confirmNewPassword){if(!t.currentPassword||!t.newPassword||!t.confirmNewPassword)throw new Error("หากต้องการเปลี่ยนรหัสผ่าน กรุณากรอกข้อมูลรหัสผ่านให้ครบทุกช่อง");if(t.newPassword!==t.confirmNewPassword)throw new Error("รหัสผ่านใหม่และการยืนยันรหัสผ่านไม่ตรงกัน");if(t.newPassword.length<6)throw new Error("รหัสผ่านใหม่ต้องมีอย่างน้อย 6 ตัวอักษร");await c("/auth/change-password",{method:"PUT",body:{currentPassword:t.currentPassword,newPassword:t.newPassword,confirmNewPassword:t.confirmNewPassword}}),m=!0,t.currentPassword="",t.newPassword="",t.confirmNewPassword=""}b.success("อัปเดตสำเร็จ!",m?"โปรไฟล์และรหัสผ่านของคุณถูกบันทึกแล้ว":"ข้อมูลโปรไฟล์ของคุณถูกบันทึกแล้ว")}catch(e){const a=((l=e.data)==null?void 0:l.message)||e.message||"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";b.error("เกิดข้อผิดพลาด",a)}finally{i.value=!1,f.value&&(f.value.value=""),t.profilePictureFile=null}}return(l,e)=>{var a,m,h;return y(),g("div",null,[s("div",L,[s("div",R,[A(I),s("main",S,[s("div",null,[e[25]||(e[25]=T('<div class="mb-8 text-center" data-v-9bfda024><div class="inline-flex items-center justify-center w-16 h-16 mb-4 bg-blue-600 rounded-full" data-v-9bfda024><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9bfda024><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-9bfda024></path></svg></div><h1 class="mb-2 text-3xl font-bold text-gray-800" data-v-9bfda024>โปรไฟล์ของฉัน</h1><p class="max-w-md mx-auto text-gray-600" data-v-9bfda024> จัดการข้อมูลส่วนตัวของคุณให้เป็นปัจจุบันอยู่เสมอ </p></div>',1)),s("form",{onSubmit:z(M,["prevent"]),class:"space-y-6",novalidate:""},[s("div",O,[s("img",{src:w.value,alt:"Profile Preview",class:"object-cover mx-auto mb-3 border-4 border-white rounded-full shadow-md w-36 h-36"},null,8,W),s("input",{type:"file",accept:"image/*",onChange:C,ref_key:"fileInput",ref:f,class:"hidden"},null,544),s("button",{type:"button",onClick:e[0]||(e[0]=r=>f.value.click()),class:"text-sm font-medium text-blue-600 hover:text-blue-800"},"เปลี่ยนรูปภาพ")]),s("div",null,[e[12]||(e[12]=s("label",{for:"username",class:"block mb-2 text-sm font-medium text-gray-700"},"ชื่อผู้ใช้",-1)),s("input",{id:"username",value:(a=x(o))==null?void 0:a.username,type:"text",disabled:"",class:"w-full px-4 py-3 text-gray-600 bg-gray-100 border border-gray-200 rounded-md"},null,8,_)]),s("div",q,[s("div",null,[e[13]||(e[13]=s("label",{for:"firstName",class:"block mb-2 text-sm font-medium text-gray-700"},"ชื่อจริง",-1)),n(s("input",{id:"firstName","onUpdate:modelValue":e[1]||(e[1]=r=>t.firstName=r),type:"text",placeholder:"กรอกชื่อจริง",onFocus:e[2]||(e[2]=r=>u.value=!0),onBlur:e[3]||(e[3]=r=>u.value=!1),class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[d,t.firstName]])]),s("div",null,[e[14]||(e[14]=s("label",{for:"lastName",class:"block mb-2 text-sm font-medium text-gray-700"},"นามสกุล",-1)),n(s("input",{id:"lastName","onUpdate:modelValue":e[4]||(e[4]=r=>t.lastName=r),type:"text",placeholder:"กรอกนามสกุล",onFocus:e[5]||(e[5]=r=>u.value=!0),onBlur:e[6]||(e[6]=r=>u.value=!1),class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[d,t.lastName]])])]),u.value?(y(),g("div",G,e[15]||(e[15]=[s("p",{class:"text-sm text-red-600"},[v(" หากมีการเปลี่ยนแปลงชื่อ-นามสกุล กรุณาตรวจสอบให้แน่ใจว่าตรงกับบัตรประชาชน "),s("br"),v("และอาจจำเป็นต้องยืนยันตัวตนสำหรับผู้ขับขี่ใหม่อีกครั้ง ")],-1)]))):k("",!0),s("div",J,[s("div",null,[e[16]||(e[16]=s("label",{for:"email",class:"block mb-2 text-sm font-medium text-gray-700"},"อีเมล",-1)),n(s("input",{id:"email","onUpdate:modelValue":e[7]||(e[7]=r=>t.email=r),type:"email",placeholder:"example@example.com",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,t.email]])]),s("div",null,[e[17]||(e[17]=s("label",{for:"phoneNumber",class:"block mb-2 text-sm font-medium text-gray-700"},"เบอร์โทรศัพท์",-1)),n(s("input",{id:"phoneNumber","onUpdate:modelValue":e[8]||(e[8]=r=>t.phoneNumber=r),type:"text",placeholder:"กรอกเบอร์โทรศัพท์",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,t.phoneNumber]])])]),s("div",K,[s("div",null,[e[18]||(e[18]=s("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"วันที่สร้างบัญชี",-1)),s("input",{type:"text",value:N((m=x(o))==null?void 0:m.createdAt),disabled:"",class:"w-full px-4 py-3 text-gray-600 bg-gray-100 border border-gray-200 rounded-md"},null,8,Q)]),s("div",null,[e[19]||(e[19]=s("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"วันที่แก้ไขล่าสุด",-1)),s("input",{type:"text",value:N((h=x(o))==null?void 0:h.updatedAt),disabled:"",class:"w-full px-4 py-3 text-gray-600 bg-gray-100 border border-gray-200 rounded-md"},null,8,X)])]),s("div",Z,[e[23]||(e[23]=s("h3",{class:"mb-4 text-lg font-semibold text-gray-800"},"เปลี่ยนรหัสผ่าน",-1)),s("div",null,[e[20]||(e[20]=s("label",{for:"currentPassword",class:"block mb-2 text-sm font-medium text-gray-700"},"รหัสผ่านเดิม",-1)),n(s("input",{type:"password",id:"currentPassword",placeholder:"กรอกรหัสผ่านเดิม","onUpdate:modelValue":e[9]||(e[9]=r=>t.currentPassword=r),class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,t.currentPassword]])]),s("div",ee,[s("div",null,[e[21]||(e[21]=s("label",{for:"newPassword",class:"block mb-2 text-sm font-medium text-gray-700"},"รหัสผ่านใหม่",-1)),n(s("input",{type:"password",id:"newPassword",minlength:"6","onUpdate:modelValue":e[10]||(e[10]=r=>t.newPassword=r),placeholder:"รหัสผ่านใหม่ (อย่างน้อย 6 ตัวอักษร)",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,t.newPassword]])]),s("div",null,[e[22]||(e[22]=s("label",{for:"confirmNewPassword",class:"block mb-2 text-sm font-medium text-gray-700"},"ยืนยันรหัสผ่านใหม่",-1)),n(s("input",{type:"password",id:"confirmNewPassword",minlength:"6","onUpdate:modelValue":e[11]||(e[11]=r=>t.confirmNewPassword=r),placeholder:"กรอกรหัสผ่านใหม่อีกครั้ง",class:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,t.confirmNewPassword]])])])]),s("div",se,[s("button",{type:"button",onClick:P,disabled:i.value,class:"px-6 py-3 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50"}," ยกเลิก ",8,te),s("button",{type:"submit",disabled:i.value,class:"flex items-center px-6 py-3 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed"},[i.value?(y(),g("svg",oe,e[24]||(e[24]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):k("",!0),v(" "+E(i.value?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"),1)],8,re)])],32)])])])])])}}},pe=D(le,[["__scopeId","data-v-9bfda024"]]);export{pe as default};
