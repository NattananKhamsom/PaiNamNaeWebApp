import{_ as Y,m as Z,r as v,x as q,i as ee,B as te,p as se,c as a,a as e,b as oe,F as x,q as b,g as u,t as i,s as ae,o as n,n as J,d as ne,f as _}from"./DPSIKoxe.js";import{d as $}from"./B5yDJBm8.js";import{b as le}from"./C5FTVxxA.js";import{C as ie}from"./CL2Ezi0q.js";import{u as re}from"./BaxiziUg.js";import{s as de}from"./x_rD_Ya3.js";import"./Cpj98o6Y.js";const ce={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ue={class:"bg-white border border-gray-300 rounded-lg shadow-md p-6 mb-8"},me={class:"flex flex-wrap gap-2"},ge=["onClick"],ve={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},pe={class:"lg:col-span-2"},fe={class:"bg-white border border-gray-300 rounded-lg shadow-md"},he={key:0,class:"p-12 text-center text-gray-500"},xe={key:1,class:"divide-y divide-gray-200"},ye={key:0,class:"p-12 text-center text-gray-500"},be=["onClick"],_e={class:"flex items-start justify-between mb-4"},ke={class:"flex-1"},we={class:"flex items-center justify-between"},Ce={class:"font-semibold text-gray-900 text-lg"},Te={key:0,class:"status-badge status-pending"},Me={key:1,class:"status-badge status-confirmed"},Le={key:2,class:"status-badge status-rejected"},$e={key:3,class:"status-badge status-cancelled"},je={class:"text-sm text-gray-600 mt-1"},Be={class:"text-sm text-gray-600"},Ve={class:"flex items-center space-x-4 mb-4"},Ae=["src","alt"],De={class:"flex-1"},Pe={class:"flex items-center"},Ne={class:"font-medium text-gray-900"},Ee={key:0,class:"relative group ml-1.5 flex items-center"},Fe={class:"flex"},He={key:0,class:"text-xs text-gray-500 mt-0.5"},ze=["href"],Oe=["onClick"],Ie={class:"flex items-center mt-1"},Se={class:"flex text-yellow-400 text-sm"},Re={class:"ml-2 text-sm text-gray-600"},qe={class:"text-right"},Je={class:"text-lg font-bold text-blue-600"},Ue={class:"text-sm text-gray-600"},Ge={key:0,class:"mt-4 mb-5 pt-4 border-t border-gray-300 animate-in slide-in-from-top duration-300"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={class:"text-sm text-gray-600 space-y-1"},We={class:"text-sm text-gray-600 space-y-1"},Xe={class:"mt-4 space-y-4"},Ye={key:0},Ze={class:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md border border-gray-300"},et={key:1},tt={class:"grid grid-cols-3 gap-2 mt-2"},st=["src"],ot=["onClick"],at=["onClick"],nt={key:1,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm"},lt=["onClick"],it={class:"lg:col-span-1"},rt={class:"bg-white border border-gray-300 rounded-lg shadow-md overflow-hidden sticky top-8"},dt={class:"p-3 border-gray-300"},ct={class:"text-sm text-gray-600 mt-1"},ut={__name:"index_v1",setup(mt){$.locale("th"),$.extend(le);const{$api:j}=Z(),{toast:p}=ae(),y=v("pending"),f=v(null),B=v(!1),V=v(null);let c=null,k=null,A=[];const m=v([]),U=[{status:"pending",label:"รอดำเนินการ"},{status:"confirmed",label:"ยืนยันแล้ว"},{status:"rejected",label:"ปฏิเสธ"},{status:"cancelled",label:"ยกเลิก"},{status:"all",label:"ทั้งหมด"}],w=q(()=>y.value==="all"?m.value:m.value.filter(o=>o.status===y.value)),D=q(()=>m.value.find(o=>o.id===f.value)||null);async function F(){var o,s,t,l,T,z,O,I,S;B.value=!0;try{const h=await j("/routes/me"),R=[];for(const r of h){const M=[];r.vehicle?(M.push(`${r.vehicle.vehicleModel} (${r.vehicle.vehicleType})`),Array.isArray(r.vehicle.amenities)&&r.vehicle.amenities.length>0&&M.push(...r.vehicle.amenities)):M.push("ไม่มีข้อมูลรถ");const X=[[r.startLocation.lat,r.startLocation.lng],[r.endLocation.lat,r.endLocation.lng]];for(const d of r.bookings||[])R.push({id:d.id,status:(d.status||"").toLowerCase(),origin:`จาก Lat: ${r.startLocation.lat.toFixed(2)}`,destination:`ถึง Lat: ${r.endLocation.lat.toFixed(2)}`,pickupPoint:((o=d.pickupLocation)==null?void 0:o.name)||"-",date:$(r.departureTime).format("D MMMM BBBB"),time:$(r.departureTime).format("HH:mm น."),price:(r.pricePerSeat||0)*(d.numberOfSeats||0),seats:d.numberOfSeats||0,passenger:{name:`${((s=d.passenger)==null?void 0:s.firstName)||""} ${((t=d.passenger)==null?void 0:t.lastName)||""}`.trim()||"ผู้โดยสาร",image:((l=d.passenger)==null?void 0:l.profilePicture)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((T=d.passenger)==null?void 0:T.firstName)||"P")}&background=random&size=64`,email:((z=d.passenger)==null?void 0:z.email)||"",isVerified:!!((O=d.passenger)!=null&&O.isVerified),rating:4.5,reviews:Math.floor(Math.random()*50)+5},coords:X,stops:["ไม่มีข้อมูลจุดแวะพัก"],carDetails:M,conditions:r.conditions,photos:((I=r.vehicle)==null?void 0:I.photos)||[]})}m.value=R}catch(h){console.error("Failed to fetch routes:",h),m.value=[],p.error("เกิดข้อผิดพลาด",((S=h==null?void 0:h.data)==null?void 0:S.message)||"ไม่สามารถโหลดข้อมูลได้")}finally{B.value=!1}}const G=o=>o==="all"?m.value.length:m.value.filter(s=>s.status===o).length,K=o=>{const s=m.value.find(t=>t.id===o);s&&H(s),f.value=f.value===o?null:o},H=o=>{if(!c||!o)return;k&&c.removeLayer(k),A.forEach(l=>c.removeLayer(l)),A=[],k=L.polyline(o.coords,{color:"#3b82f6",weight:4}).addTo(c);const s=L.marker(o.coords[0]).bindPopup("จุดเริ่มต้น").addTo(c),t=L.marker(o.coords[o.coords.length-1]).bindPopup("จุดปลายทาง").addTo(c);A.push(s,t),c.fitBounds(k.getBounds(),{padding:[40,40]})},P=v(!1),C=v(null),g=v({title:"",message:"",confirmText:"",action:null,variant:"danger"}),N=(o,s)=>{C.value=o,s==="confirm"?g.value={title:"ยืนยันคำขอจอง",message:`ยืนยันคำขอของผู้โดยสาร "${o.passenger.name}" ใช่หรือไม่?`,confirmText:"ยืนยันคำขอ",action:"confirm",variant:"primary"}:s==="reject"?g.value={title:"ปฏิเสธคำขอจอง",message:`ต้องการปฏิเสธคำขอของ "${o.passenger.name}" ใช่หรือไม่?`,confirmText:"ปฏิเสธ",action:"reject",variant:"danger"}:s==="delete"&&(g.value={title:"ยืนยันการลบรายการ",message:"ต้องการลบคำขอนี้ออกจากรายการใช่หรือไม่?",confirmText:"ลบรายการ",action:"delete",variant:"danger"}),P.value=!0},E=()=>{P.value=!1,C.value=null},Q=async()=>{var t;if(!C.value)return;const o=g.value.action,s=C.value.id;try{o==="confirm"?(await j(`/bookings/${s}/status`,{method:"PATCH",body:{status:"CONFIRMED"}}),p.success("สำเร็จ","ยืนยันคำขอแล้ว")):o==="reject"?(await j(`/bookings/${s}/status`,{method:"PATCH",body:{status:"REJECTED"}}),p.success("สำเร็จ","ปฏิเสธคำขอแล้ว")):o==="delete"&&console.log(`Delete booking ${s} (TODO)`),E(),await F()}catch(l){console.error(`Failed to ${o} booking:`,l),p.error("เกิดข้อผิดพลาด",((t=l==null?void 0:l.data)==null?void 0:t.message)||"ไม่สามารถดำเนินการได้"),E()}},W=async o=>{try{await navigator.clipboard.writeText(o),p.success("คัดลอกแล้ว",o)}catch{p.error("คัดลอกไม่สำเร็จ","ลองใหม่อีกครั้ง")}};return re({}),ee(()=>{F();const o=de(()=>{typeof L<"u"&&(clearInterval(o),te(()=>{V.value&&!c&&(c=L.map(V.value).setView([13.7563,100.5018],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(c))}))},100)}),se(y,()=>{f.value=null,w.value.length>0&&H(w.value[0])}),(o,s)=>(n(),a("div",null,[e("div",ce,[s[12]||(s[12]=e("div",{class:"mb-8"},[e("h2",{class:"text-2xl font-bold text-gray-900"},"คำขอจองเส้นทางของฉัน"),e("p",{class:"mt-2 text-gray-600"},"ดูและจัดการคำขอจองจากผู้โดยสารในเส้นทางที่คุณสร้าง")],-1)),e("div",ue,[e("div",me,[(n(),a(x,null,b(U,t=>e("button",{key:t.status,onClick:l=>y.value=t.status,class:J(["tab-button px-4 py-2 rounded-md font-medium",{active:y.value===t.status}])},i(t.label)+" ("+i(G(t.status))+") ",11,ge)),64))])]),e("div",ve,[e("div",pe,[e("div",fe,[s[10]||(s[10]=e("div",{class:"p-6 border-b border-gray-300"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"รายการคำขอจอง")],-1)),B.value?(n(),a("div",he,s[1]||(s[1]=[e("p",null,"กำลังโหลดข้อมูล...",-1)]))):(n(),a("div",xe,[w.value.length===0?(n(),a("div",ye,s[2]||(s[2]=[e("p",null,"ไม่พบรายการในหมวดหมู่นี้",-1)]))):u("",!0),(n(!0),a(x,null,b(w.value,t=>(n(),a("div",{key:t.id,class:"trip-card p-6 cursor-pointer transition-colors duration-200 hover:bg-gray-50",onClick:l=>K(t.id)},[e("div",_e,[e("div",ke,[e("div",we,[e("h4",Ce,i(t.origin)+" → "+i(t.destination),1),t.status==="pending"?(n(),a("span",Te,"รอดำเนินการ")):t.status==="confirmed"?(n(),a("span",Me,"ยืนยันแล้ว")):t.status==="rejected"?(n(),a("span",Le,"ปฏิเสธ")):t.status==="cancelled"?(n(),a("span",$e,"ยกเลิก")):u("",!0)]),e("p",je,"จุดนัดพบ: "+i(t.pickupPoint),1),e("p",Be,"วันที่: "+i(t.date)+" เวลา: "+i(t.time),1)])]),e("div",Ve,[e("img",{src:t.passenger.image,alt:t.passenger.name,class:"w-15 h-15 rounded-full object-cover"},null,8,Ae),e("div",De,[e("div",Pe,[e("h5",Ne,i(t.passenger.name),1),t.passenger.isVerified?(n(),a("div",Ee,s[3]||(s[3]=[e("svg",{class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.603 3.799A4.49 4.49 0 0112 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 013.498 1.307 4.491 4.491 0 011.307 3.497A4.49 4.49 0 0121.75 12c0 1.357-.6 2.573-1.549 3.397a4.49 4.49 0 01-1.307 3.498 4.491 4.491 0 01-3.497 1.307A4.49 4.49 0 0112 21.75a4.49 4.49 0 01-3.397-1.549 4.49 4.49 0 01-3.498-1.306 4.491 4.491 0 01-1.307-3.498A4.49 4.49 0 012.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 011.307-3.497 4.49 4.49 0 013.497-1.307zm7.007 6.387a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.07-.01l3.5-4.875z","clip-rule":"evenodd"})],-1),e("span",{class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max px-2 py-1 bg-gray-800 text-white text-xs rounded-md opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}," ผู้โดยสารยืนยันตัวตนแล้ว ",-1)]))):u("",!0)]),e("div",Fe,[t.passenger.email?(n(),a("p",He,[s[4]||(s[4]=ne(" อีเมล: ")),e("a",{href:`mailto:${t.passenger.email}`,class:"text-blue-600 hover:underline",onClick:s[0]||(s[0]=_(()=>{},["stop"]))},i(t.passenger.email),9,ze)])):u("",!0),t.passenger.email?(n(),a("button",{key:1,class:"ml-1 inline-flex items-center rounded text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",title:"คัดลอกอีเมล","aria-label":"คัดลอกอีเมล",onClick:_(l=>W(t.passenger.email),["stop"])},s[5]||(s[5]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V9a2 2 0 012-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7V5a2 2 0 00-2-2H8a2 2 0 00-2 2v2"})],-1)]),8,Oe)):u("",!0)]),e("div",Ie,[e("div",Se,[e("span",null,i("★".repeat(Math.round(t.passenger.rating)))+i("☆".repeat(5-Math.round(t.passenger.rating))),1)]),e("span",Re,i(t.passenger.rating)+" ("+i(t.passenger.reviews)+" รีวิว) ",1)])]),e("div",qe,[e("div",Je,i(t.price)+" บาท",1),e("div",Ue,"จำนวน "+i(t.seats)+" ที่นั่ง",1)])]),f.value===t.id?(n(),a("div",Ge,[e("div",Ke,[e("div",null,[s[6]||(s[6]=e("h5",{class:"font-medium text-gray-900 mb-2"},"รายละเอียดเส้นทาง",-1)),e("ul",Qe,[(n(!0),a(x,null,b(t.stops,l=>(n(),a("li",{key:l},"• "+i(l),1))),128))])]),e("div",null,[s[7]||(s[7]=e("h5",{class:"font-medium text-gray-900 mb-2"},"รายละเอียดรถ",-1)),e("ul",We,[(n(!0),a(x,null,b(t.carDetails,l=>(n(),a("li",{key:l},"• "+i(l),1))),128))])])]),e("div",Xe,[t.conditions?(n(),a("div",Ye,[s[8]||(s[8]=e("h5",{class:"text-gray-900 font-medium mb-2"},"เงื่อนไขการเดินทาง",-1)),e("p",Ze,i(t.conditions),1)])):u("",!0),t.photos&&t.photos.length>0?(n(),a("div",et,[s[9]||(s[9]=e("h5",{class:"text-gray-900 font-medium mb-2"},"รูปภาพรถยนต์",-1)),e("div",tt,[(n(!0),a(x,null,b(t.photos.slice(0,3),(l,T)=>(n(),a("div",{key:T},[e("img",{src:l,alt:"Vehicle photo",class:"w-full aspect-video object-cover rounded-lg shadow-sm cursor-pointer hover:opacity-90 transition-opacity"},null,8,st)]))),128))])])):u("",!0)])])):u("",!0),e("div",{class:J(["flex justify-end space-x-3",{"mt-4":f.value!==t.id}])},[t.status==="pending"?(n(),a(x,{key:0},[e("button",{onClick:_(l=>N(t,"confirm"),["stop"]),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm"}," ยืนยันคำขอ ",8,ot),e("button",{onClick:_(l=>N(t,"reject"),["stop"]),class:"px-4 py-2 border border-red-300 text-red-600 rounded-md hover:bg-red-50 transition duration-200 text-sm"}," ปฏิเสธ ",8,at)],64)):t.status==="confirmed"?(n(),a("button",nt," แชทกับผู้โดยสาร ")):["rejected","cancelled"].includes(t.status)?(n(),a("button",{key:2,onClick:_(l=>N(t,"delete"),["stop"]),class:"px-4 py-2 border border-gray-300 text-gray-600 rounded-md hover:bg-gray-50 transition duration-200 text-sm"}," ลบรายการ ",8,lt)):u("",!0)],2)],8,be))),128))]))])]),e("div",it,[e("div",rt,[e("div",dt,[s[11]||(s[11]=e("h3",{class:"text-lg font-semibold text-gray-900"},"แผนที่เส้นทาง",-1)),e("p",ct,i(D.value?D.value.origin+" → "+D.value.destination:"คลิกที่รายการเพื่อดูเส้นทาง"),1)]),e("div",{ref_key:"mapContainer",ref:V,id:"map"},null,512)])])])]),oe(ie,{show:P.value,title:g.value.title,message:g.value.message,confirmText:g.value.confirmText,variant:g.value.variant,onConfirm:Q,onCancel:E},null,8,["show","title","message","confirmText","variant"])]))}},bt=Y(ut,[["__scopeId","data-v-bddb3cc2"]]);export{bt as default};
