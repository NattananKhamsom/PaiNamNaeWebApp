import{r as w,A as I,x as N,i as Z,H as ee,c as d,b as E,a as t,h as x,v as T,I as te,z as C,e as se,t as r,g as z,F as D,q as H,y as P,J as U,s as oe,C as M,o as c,n as q,d as le}from"./DPSIKoxe.js";import{u as ne}from"./BaxiziUg.js";import{d as S}from"./B5yDJBm8.js";import{A as ae,_ as ie}from"./CaCOxDSn.js";import{C as re}from"./CL2Ezi0q.js";import"./Cpj98o6Y.js";import"./Lcixqshc.js";import"./DOK8vhV6.js";const de={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},ce={class:"mx-auto max-w-8xl"},ue={class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},pe={class:"flex items-center gap-2"},me={class:"mb-4 bg-white border border-gray-300 rounded-lg shadow-sm"},ge={class:"grid grid-cols-1 gap-3 px-4 py-4 sm:px-6 lg:grid-cols-[repeat(24,minmax(0,1fr))]"},fe={class:"lg:col-span-4"},xe={class:"lg:col-span-4"},ye={class:"lg:col-span-4"},be={class:"lg:col-span-4"},ve={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},he={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 sm:px-6"},_e={class:"text-sm text-gray-600"},we={key:0,class:"p-8 text-center text-gray-500"},ke={key:1,class:"p-8 text-center text-red-600"},Ce={key:2,class:"overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},Ve={class:"bg-white divide-y divide-gray-200"},Be={class:"px-4 py-3"},Ee={class:"flex items-center gap-3"},De=["src"],Me={class:"font-medium text-gray-900"},Se={class:"text-xs text-gray-500"},Ae={class:"px-4 py-3 text-gray-700"},$e={class:"px-4 py-3 text-gray-700"},Ie={class:"text-xs text-gray-500"},Ne={class:"px-4 py-3"},Te={key:0,class:"mr-1 fa-solid fa-circle-check"},ze={class:"px-4 py-3 text-gray-700"},He={class:"text-sm"},Pe={class:"text-xs text-gray-500"},Ue={class:"px-4 py-3"},qe=["onClick"],Re=["onClick"],je=["onClick"],Ye={key:0},Fe={class:"flex flex-col gap-3 px-4 py-4 border-t border-gray-200 sm:px-6 sm:flex-row sm:items-center sm:justify-between"},Oe={class:"flex flex-wrap items-center gap-3 text-sm"},Ge={class:"flex items-center gap-2"},Ke={class:"flex items-center gap-1"},Je=["disabled"],We={key:0,class:"px-2 text-sm text-gray-500"},Qe=["disabled","onClick"],Xe=["disabled"],rt={__name:"index",setup(Ze){S.locale("th"),ne({});const{toast:L}=oe(),g=w(!0),y=w(""),b=w([]),n=I({page:1,limit:10,total:0,totalPages:1}),a=I({q:"",vehicleType:"",color:"",isDefault:"",sort:"createdAt:desc"}),v=N(()=>Math.max(1,n.totalPages||Math.ceil((n.total||0)/(n.limit||10)))),R=N(()=>{const o=v.value,e=n.page;if(!o||o<1)return[];if(o<=5)return Array.from({length:o},(i,p)=>p+1);const l=new Set([1,o,e]);e>2&&l.add(e-1),e<o-1&&l.add(e+1);const s=Array.from(l).sort((i,p)=>i-p),u=[];for(let i=0;i<s.length;i++)i>0&&s[i]-s[i-1]>1&&u.push("…"),u.push(s[i]);return u});function A(o,e=!1){return o?e?S(o).format("D MMMM YYYY HH:mm"):S(o).format("D MMMM YYYY"):"-"}function j(o){const[e,l]=(o||"").split(":");return!e||!["asc","desc"].includes(l)?{sortBy:"createdAt",sortOrder:"desc"}:{sortBy:e,sortOrder:l}}async function h(o=1){var e;g.value=!0,y.value="";try{const l=P(),s=U("token").value||localStorage.getItem("token"),{sortBy:u,sortOrder:i}=j(a.sort),p={page:o,limit:n.limit,q:a.q||void 0,vehicleType:a.vehicleType||void 0,color:a.color||void 0,sortBy:u,sortOrder:i};a.isDefault!==""&&(p.isDefault=a.isDefault);const m=await $fetch("/vehicles/admin",{baseURL:l.public.apiBase,headers:{Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{}},query:p});b.value=(m==null?void 0:m.data)||[];const f=(m==null?void 0:m.pagination)||{};n.page=Number(f.page??o),n.limit=Number(f.limit??n.limit),n.total=Number(f.total??b.value.length),n.totalPages=Number(f.totalPages??Math.ceil(n.total/n.limit))}catch(l){console.error("Fetch Vehicles Error:",l),y.value=((e=l==null?void 0:l.data)==null?void 0:e.message)||"ไม่สามารถโหลดข้อมูลยานพาหนะได้",L.error("เกิดข้อผิดพลาด",y.value),b.value=[]}finally{g.value=!1}}function V(o){o<1||o>v.value||h(o)}function k(){n.page=1,h(1)}function Y(){a.q="",a.vehicleType="",a.color="",a.isDefault="",a.sort="createdAt:desc",n.page=1,h(1)}const B=w(!1),_=w(null);function F(o){_.value=o,B.value=!0}function $(){B.value=!1,_.value=null}async function O(){var e;if(!_.value)return;const o=_.value;try{const l=P(),s=U("token").value||localStorage.getItem("token");await $fetch(`/vehicles/admin/${o.id}`,{baseURL:l.public.apiBase,method:"DELETE",headers:{Accept:"application/json",...s?{Authorization:`Bearer ${s}`}:{}}}),L.success("ลบยานพาหนะเรียบร้อย",`ยานพาหนะ "${o.licensePlate}" ถูกลบถาวรแล้ว`),$(),h(Math.min(n.page,v.value))}catch(l){console.error("Delete Vehicle Error:",l);const s=((e=l==null?void 0:l.data)==null?void 0:e.message)||"ลบยานพาหนะไม่สำเร็จ";L.error("ลบไม่สำเร็จ",s)}}function G(){M("/admin/vehicles/create").catch(()=>{})}function K(o){M(`/admin/vehicles/${o.id}`).catch(()=>{})}function J(o){M(`/admin/vehicles/${o.id}/edit`).catch(()=>{})}function W(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.remove("mobile-open"),e.classList.add("hidden"))}function Q(){window.toggleSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),l=document.getElementById("toggle-icon");!o||!e||!l||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(e.style.marginLeft="80px",l.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",l.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.toggleSubmenu=function(o){const e=document.getElementById(o),l=document.getElementById(o+"-icon");!e||!l||(e.classList.toggle("hidden"),e.classList.contains("hidden")?l.classList.replace("fa-chevron-up","fa-chevron-down"):l.classList.replace("fa-chevron-down","fa-chevron-up"))},window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),l=document.getElementById("overlay");!o||!e||!l||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),l.classList.add("hidden"),o.classList.contains("collapsed")?e.style.marginLeft="80px":e.style.marginLeft="280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function X(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.toggleSubmenu,delete window.__adminResizeHandler__}return Z(()=>{Q(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),h(1)}),ee(()=>{X()}),(o,e)=>{var l;return c(),d("div",null,[E(ae),E(ie),t("main",de,[t("div",ce,[t("div",ue,[t("div",{class:"flex items-center gap-3"},[e[9]||(e[9]=t("h1",{class:"text-2xl font-semibold text-gray-800"},"Vehicle Management",-1)),t("button",{onClick:G,class:"inline-flex items-center gap-2 px-3 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"},e[8]||(e[8]=[t("i",{class:"fa-solid fa-plus"},null,-1),t("span",{class:"hidden sm:inline"},"สร้างยานพาหนะใหม่",-1)]))]),t("div",pe,[x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.q=s),onKeyup:te(k,["enter"]),type:"text",placeholder:"ค้นหา : รุ่น, ป้ายทะเบียน, เจ้าของ...",class:"max-w-full px-3 py-2 border border-gray-300 rounded-md w-72 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[T,a.q,void 0,{trim:!0}]]),t("button",{onClick:k,class:"px-4 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"}," ค้นหา ")])]),t("div",me,[t("div",ge,[t("div",fe,[e[11]||(e[11]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ประเภทยานพาหนะ",-1)),x(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.vehicleType=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[10]||(e[10]=[se('<option value="">ทั้งหมด</option><option value="SEDAN">Sedan</option><option value="SUV">SUV</option><option value="Hatchback">Hatchback</option><option value="VAN">Van</option><option value="Pickup">Pickup</option>',6)]),512),[[C,a.vehicleType]])]),t("div",xe,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สี",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.color=s),type:"text",placeholder:"เช่น ขาว, ดำ",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},null,512),[[T,a.color,void 0,{trim:!0}]])]),t("div",ye,[e[14]||(e[14]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ค่าเริ่มต้น",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.isDefault=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[13]||(e[13]=[t("option",{value:""},"ทั้งหมด",-1),t("option",{value:"true"},"ใช่",-1),t("option",{value:"false"},"ไม่ใช่",-1)]),512),[[C,a.isDefault]])]),t("div",be,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เรียงตาม",-1)),x(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.sort=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500"},e[15]||(e[15]=[t("option",{value:""},"(ค่าเริ่มต้น)",-1),t("option",{value:"createdAt:desc"},"สร้างล่าสุด",-1),t("option",{value:"createdAt:asc"},"สร้างเก่าสุด",-1)]),512),[[C,a.sort]])]),t("div",{class:"flex items-end justify-end gap-2 mt-1 lg:col-span-8 lg:mt-0"},[t("button",{onClick:Y,class:"px-3 py-2 text-gray-700 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50"}," ล้างตัวกรอง "),t("button",{onClick:k,class:"px-4 py-2 text-white bg-blue-600 rounded-md cursor-pointer hover:bg-blue-700"}," ใช้ตัวกรอง ")])])]),t("div",ve,[t("div",he,[t("div",_e," หน้าที่ "+r(n.page)+" / "+r(v.value)+" • ทั้งหมด "+r(n.total)+" คัน ",1)]),g.value?(c(),d("div",we,e[17]||(e[17]=[t("i",{class:"text-3xl fa-solid fa-spinner fa-spin"},null,-1),t("p",{class:"mt-2"},"กำลังโหลดข้อมูล...",-1)]))):y.value?(c(),d("div",ke,r(y.value),1)):(c(),d("div",Ce,[t("table",Le,[e[22]||(e[22]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ยานพาหนะ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ป้ายทะเบียน"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"เจ้าของ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"ค่าเริ่มต้น"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"สร้างเมื่อ"),t("th",{class:"px-4 py-3 text-xs font-medium text-left text-gray-500 uppercase"},"การกระทำ")])],-1)),t("tbody",Ve,[(c(!0),d(D,null,H(b.value,s=>{var u,i,p,m;return c(),d("tr",{key:s.id,class:"transition-colors hover:bg-gray-50"},[t("td",Be,[t("div",Ee,[t("img",{src:((u=s.photos)==null?void 0:u[0])||"https://via.placeholder.com/150x100?text=No+Image",class:"object-cover w-20 h-12 rounded-md",alt:"Vehicle Photo"},null,8,De),t("div",null,[t("div",Me,r(s.vehicleModel),1),t("div",Se,r(s.vehicleType)+" • "+r(s.color),1)])])]),t("td",Ae,r(s.licensePlate),1),t("td",$e,[t("div",null,r((i=s.user)==null?void 0:i.firstName)+" "+r((p=s.user)==null?void 0:p.lastName),1),t("div",Ie,r((m=s.user)==null?void 0:m.email),1)]),t("td",Ne,[t("span",{class:q(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-full",s.isDefault?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"])},[s.isDefault?(c(),d("i",Te)):z("",!0),le(" "+r(s.isDefault?"ใช่":"ไม่ใช่"),1)],2)]),t("td",ze,[t("div",He,r(A(s.createdAt,!0)),1),t("div",Pe,"อัปเดต "+r(A(s.updatedAt,!0)),1)]),t("td",Ue,[t("button",{onClick:f=>K(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-emerald-600",title:"ดูรายละเอียด"},e[18]||(e[18]=[t("i",{class:"text-lg fa-regular fa-eye"},null,-1)]),8,qe),t("button",{onClick:f=>J(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-blue-600",title:"แก้ไข"},e[19]||(e[19]=[t("i",{class:"text-lg fa-regular fa-pen-to-square"},null,-1)]),8,Re),t("button",{onClick:f=>F(s),class:"p-2 text-gray-500 transition-colors cursor-pointer hover:text-red-600",title:"ลบ"},e[20]||(e[20]=[t("i",{class:"text-lg fa-regular fa-trash-can"},null,-1)]),8,je)])])}),128)),!g.value&&b.value.length===0?(c(),d("tr",Ye,e[21]||(e[21]=[t("td",{colspan:"6",class:"px-4 py-10 text-center text-gray-500"},"ไม่พบข้อมูลยานพาหนะที่ตรงกับเงื่อนไข",-1)]))):z("",!0)])])])),t("div",Fe,[t("div",Oe,[t("div",Ge,[e[24]||(e[24]=t("span",{class:"text-xs text-gray-500"},"Limit:",-1)),x(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.limit=s),onChange:k,class:"px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500"},e[23]||(e[23]=[t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:50},"50",-1)]),544),[[C,n.limit,void 0,{number:!0}]])])]),t("nav",Ke,[t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:n.page<=1||g.value,onClick:e[6]||(e[6]=s=>V(n.page-1))}," Previous ",8,Je),(c(!0),d(D,null,H(R.value,(s,u)=>(c(),d(D,{key:`p-${u}-${s}`},[s==="…"?(c(),d("span",We,"…")):(c(),d("button",{key:1,class:q(["px-3 py-2 text-sm border rounded-md",s===n.page?"bg-blue-50 text-blue-600 border-blue-200":"hover:bg-gray-50"]),disabled:g.value,onClick:i=>V(s)},r(s),11,Qe))],64))),128)),t("button",{class:"px-3 py-2 text-sm border rounded-md disabled:opacity-50",disabled:n.page>=v.value||g.value,onClick:e[7]||(e[7]=s=>V(n.page+1))}," Next ",8,Xe)])])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:W}),E(re,{show:B.value,title:`ลบยานพาหนะ : ${((l=_.value)==null?void 0:l.licensePlate)||""}`,message:"การลบนี้เป็นการลบถาวร ข้อมูลทั้งหมดจะถูกลบและไม่สามารถกู้คืนได้ คุณต้องการดำเนินการต่อหรือไม่?",confirmText:"ลบถาวร",cancelText:"ยกเลิก",variant:"danger",onConfirm:O,onCancel:$},null,8,["show","title"])])}}};export{rt as default};
