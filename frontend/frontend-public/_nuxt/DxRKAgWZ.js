import{_ as ce}from"./Lcixqshc.js";import{a5 as ge,r as E,p as pe,i as fe,y as te,H as ye,c as g,b as O,a as t,w as xe,t as p,g as q,d as se,F as U,q as W,J as ve,o as f,B as be}from"./DPSIKoxe.js";import{u as we}from"./BaxiziUg.js";import{A as _e,_ as he}from"./CaCOxDSn.js";import{d as M}from"./B5yDJBm8.js";import{b as ke}from"./C5FTVxxA.js";import{s as Me}from"./x_rD_Ya3.js";import"./DOK8vhV6.js";import"./Cpj98o6Y.js";const $e={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},Be={class:"mb-8"},Ae={class:"mx-auto max-w-8xl"},Le={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Ee={key:0,class:"p-8 text-center text-gray-500"},Ce={key:1,class:"p-8 text-center text-red-600"},ze={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6 text-[15px]"},Ne={class:"w-full max-w-[80rem] mx-auto space-y-6"},Re={class:"overflow-hidden border border-gray-300 rounded-lg"},Te={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Se={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},He={key:0,class:"mt-1 text-xs text-gray-500"},Fe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},De={key:0,class:"mt-1 text-xs text-gray-500"},Ie={class:"grid grid-cols-1 gap-4 mt-4 sm:grid-cols-2"},Pe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ve={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},je={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},Ge={key:0,class:"space-y-1 text-gray-700"},Oe={key:1,class:"text-gray-500"},qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Ue={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},We={class:"text-gray-900"},Je={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ke={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Xe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ye={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ze={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50"},et={key:0,class:"space-y-1 text-gray-700"},tt={key:1,class:"text-gray-500"},st={key:0},ot={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},lt={class:"grid grid-cols-3 gap-2"},rt=["src"],at={key:1,class:"col-span-3 p-4 text-center text-gray-500 border border-gray-300 rounded-md bg-gray-50"},nt={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},it={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},dt={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},J="__gmapsReadyAdminRoute__",wt={__name:"index",setup(ut){M.locale("th"),M.extend(ke),we({});const oe=ge(),C=E(!0),z=E(""),o=E(null),V=E(null);let y=null,N=null,R=null,T=null,S=[];const H=E(!1),le=te();function j(s){return(s||"").replace(/,?\s*(Thailand|ไทย|ประเทศ)\s*$/i,"").replace(/\s{2,}/g," ").trim()}function K(s,e=!1){return s?e?M(s).format("D MMM BBBB HH:mm"):M(s).format("D MMM BBBB"):"-"}function re(){return new Promise(s=>{if(H.value)return s(!0);const e=Me(()=>{H.value&&(clearInterval(e),s(!0))},50)})}function Q(){N&&(N.setMap(null),N=null),R&&(R.setMap(null),R=null),T&&(T.setMap(null),T=null),S.length&&(S.forEach(s=>s.setMap(null)),S=[])}function G(){!V.value||y||(y=new google.maps.Map(V.value,{center:{lat:13.7563,lng:100.5018},zoom:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0}),new google.maps.Geocoder,new google.maps.places.PlacesService(y),H.value=!0,setTimeout(()=>{google.maps.event.trigger(y,"resize")},0))}async function $(s){var a,n,i,d,l,x,b,v;if(!s||(await re(),!y))return;Q(),(a=s.start)!=null&&a.lat&&((n=s.start)!=null&&n.lng)&&(R=new google.maps.Marker({position:{lat:s.start.lat,lng:s.start.lng},map:y,label:"A"})),(i=s.end)!=null&&i.lat&&((d=s.end)!=null&&d.lng)&&(T=new google.maps.Marker({position:{lat:s.end.lat,lng:s.end.lng},map:y,label:"B"})),Array.isArray(s.stopsCoords)&&s.stopsCoords.length&&(S=s.stopsCoords.map((c,_)=>new google.maps.Marker({position:{lat:c.lat,lng:c.lng},map:y,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png",title:c.name||c.address||`จุดแวะ ${_+1}`})));const e=new google.maps.LatLngBounds;if((l=s.start)!=null&&l.lat&&e.extend(new google.maps.LatLng(s.start.lat,s.start.lng)),(x=s.end)!=null&&x.lat&&e.extend(new google.maps.LatLng(s.end.lat,s.end.lng)),(b=s.stopsCoords)!=null&&b.length&&s.stopsCoords.forEach(c=>e.extend(new google.maps.LatLng(c.lat,c.lng))),s.polyline&&((v=google.maps.geometry)!=null&&v.encoding)){const c=google.maps.geometry.encoding.decodePath(s.polyline);N=new google.maps.Polyline({path:c,map:y,strokeColor:"#2563eb",strokeOpacity:.9,strokeWeight:5}),c.forEach(_=>e.extend(_))}e.isEmpty()||(y.fitBounds(e),setTimeout(()=>{google.maps.event.trigger(y,"resize"),y.fitBounds(e)},0))}async function X(){var s,e,a,n,i,d,l,x,b;C.value=!0,z.value="";try{const v=oe.params.id,c=te().public.apiBase,_=((s=ve("token"))==null?void 0:s.value)||localStorage.getItem("token"),h=await fetch(`${c}/routes/admin/${v}`,{method:"GET",headers:{Accept:"application/json",..._?{Authorization:`Bearer ${_}`}:{}},credentials:"include"});let w;try{w=await h.json()}catch{const k=await h.text(),B=new Error(k||"Unexpected response from server");throw B.status=h.status,B}if(!h.ok){const k=new Error((w==null?void 0:w.message)||`Request failed with status ${h.status}`);throw k.status=h.status,k.payload=w,k}const r=w==null?void 0:w.data;if(!r)throw new Error("Invalid response: missing data");const{stops:F,stopsCoords:D}=me(r.waypoints),u=r.startLocation||{},m=r.endLocation||{},I=`${((e=r.driver)==null?void 0:e.firstName)||""} ${((a=r.driver)==null?void 0:a.lastName)||""}`.trim()||"ไม่ระบุชื่อ",P=((n=r.driver)==null?void 0:n.profilePicture)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((i=r.driver)==null?void 0:i.firstName)||"U")}&background=random&size=64`;o.value={id:r.id,start:u,end:m,originName:(u==null?void 0:u.name)||((u==null?void 0:u.lat)!=null&&(u==null?void 0:u.lng)!=null?`(${u.lat.toFixed(2)}, ${u.lng.toFixed(2)})`:"-"),destinationName:(m==null?void 0:m.name)||((m==null?void 0:m.lat)!=null&&(m==null?void 0:m.lng)!=null?`(${m.lat.toFixed(2)}, ${m.lng.toFixed(2)})`:"-"),originAddress:u!=null&&u.address?j(u.address):null,destinationAddress:m!=null&&m.address?j(m.address):null,availableSeats:r.availableSeats,price:r.pricePerSeat,departureTime:M(r.departureTime).format("HH:mm น."),date:M(r.departureTime).format("D MMMM BBBB"),durationText:ue(r.duration,r.durationSeconds),distanceText:de(r.distance,r.distanceMeters),polyline:r.routePolyline||((d=r.landmarks)==null?void 0:d.overview_polyline)||null,stops:F,stopsCoords:D,conditions:r.conditions,photos:((l=r.vehicle)==null?void 0:l.photos)||[],carDetails:r.vehicle?[`${r.vehicle.vehicleModel} (${r.vehicle.vehicleType})`,...r.vehicle.amenities||[]]:["ไม่มีข้อมูลรถ"],driver:{name:I,image:P,isVerified:!!((x=r.driver)!=null&&x.isVerified)},createdAt:r.createdAt,updatedAt:r.updatedAt},(b=window.google)!=null&&b.maps&&$(o.value)}catch(v){console.error(v),z.value=(v==null?void 0:v.message)||"ไม่สามารถโหลดข้อมูลเส้นทางได้",o.value=null}finally{C.value=!1}}function ae(){window.__adminResizeHandler__=function(){const s=document.getElementById("sidebar"),e=document.getElementById("main-content"),a=document.getElementById("overlay");!s||!e||!a||(window.innerWidth>=1024?(s.classList.remove("mobile-open"),a.classList.add("hidden"),e.style.marginLeft=s.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0",y&&H.value&&(google.maps.event.trigger(y,"resize"),o.value&&$(o.value)))},window.addEventListener("resize",window.__adminResizeHandler__)}function ne(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.__adminResizeHandler__}function ie(){const s=document.getElementById("sidebar"),e=document.getElementById("overlay");!s||!e||(s.classList.remove("mobile-open"),e.classList.add("hidden"))}function de(s,e){if(typeof s=="string"&&s.includes("+")){const a=s.split("+");let n=0;for(const i of a){const d=parseFloat(i.replace(/[^\d.]/g,""));Number.isNaN(d)||(/กม/.test(i)?n+=d*1e3:(/เมตร|ม\./.test(i),n+=d))}if(n>=1e3){const i=Math.round(n/1e3*10)/10;return`${i%1===0?i.toFixed(0):i} กม.`}return`${Math.round(n)} ม.`}if(typeof e=="number"){if(e>=1e3){const a=Math.round(e/1e3*10)/10;return`${a%1===0?a.toFixed(0):a} กม.`}return`${Math.round(e)} ม.`}return s||"-"}function ue(s,e){if(typeof s=="string"&&s.includes("+")){const a=s.split("+");let n=0;for(const l of a){const x=parseFloat(l.replace(/[^\d.]/g,""));Number.isNaN(x)||(/ชม/.test(l)?n+=x*60:n+=x)}const i=Math.floor(n/60),d=Math.round(n%60);return i?d?`${i} ชม. ${d} นาที`:`${i} ชม.`:`${d} นาที`}if(typeof e=="number"){const a=Math.round(e/60),n=Math.floor(a/60),i=a%60;return n?i?`${n} ชม. ${i} นาที`:`${n} ชม.`:`${i} นาที`}return s||"-"}function me(s){const e=s||{},a=Array.isArray(e.used)&&e.used.length?e.used:Array.isArray(e.requested)?e.requested:[],n=Array.isArray(e.optimizedOrder)&&e.optimizedOrder.length===a.length?e.optimizedOrder.map(l=>a[l]):a,i=n.map(l=>{const x=(l==null?void 0:l.name)||"",b=j((l==null?void 0:l.address)||""),v=(l==null?void 0:l.lat)!=null&&(l==null?void 0:l.lng)!=null?`(${l.lat.toFixed(6)}, ${l.lng.toFixed(6)})`:"",c=x||v;return b?`${c} — ${b}`:c}).filter(Boolean),d=n.map(l=>l&&typeof l.lat=="number"&&typeof l.lng=="number"?{lat:l.lat,lng:l.lng,name:l.name||"",address:l.address||""}:null).filter(Boolean);return{stops:i,stopsCoords:d}}return pe(C,async s=>{var e,a;s===!1&&(await be(),!y&&((e=window.google)!=null&&e.maps)&&G(),o.value&&((a=window.google)!=null&&a.maps)&&$(o.value))}),fe(async()=>{var s;if(ae(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),(s=window.google)!=null&&s.maps)G(),await X(),o.value&&$(o.value);else{const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${le.public.googleMapsApiKey}&libraries=places,geometry&callback=${J}`,e.async=!0,e.defer=!0,window[J]=()=>{try{delete window[J]}catch{}G(),X().then(()=>{o.value&&$(o.value)})},document.head.appendChild(e)}}),ye(()=>{ne(),Q()}),(s,e)=>{var n,i,d,l,x,b,v,c,_,h,w,r,F,D,u,m,I,P,k,B,Y,Z,ee;const a=ce;return f(),g("div",null,[O(_e),O(he),t("main",$e,[t("div",Be,[O(a,{to:"/admin/routes",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:xe(()=>e[0]||(e[0]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[0]})]),t("div",Ae,[e[23]||(e[23]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"รายละเอียดเส้นทาง"),t("span",{class:"text-sm text-gray-500"},"ดูข้อมูลทั้งหมดของ Route")])],-1)),t("div",Le,[e[22]||(e[22]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลเส้นทาง")],-1)),C.value?(f(),g("div",Ee,"กำลังโหลดข้อมูล...")):z.value?(f(),g("div",Ce,p(z.value),1)):(f(),g("div",ze,[t("div",Ne,[t("section",null,[e[1]||(e[1]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"แผนที่เส้นทาง",-1)),t("div",Re,[t("div",{ref_key:"mapEl",ref:V,class:"w-full",style:{height:"400px"}},null,512)])]),t("section",null,[e[6]||(e[6]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เส้นทาง",-1)),t("div",Te,[t("div",null,[e[2]||(e[2]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดเริ่มต้น",-1)),t("div",Se,[se(p(((n=o.value)==null?void 0:n.originName)||"-")+" ",1),(i=o.value)!=null&&i.originAddress?(f(),g("div",He,p(o.value.originAddress),1)):q("",!0)])]),t("div",null,[e[3]||(e[3]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"จุดปลายทาง",-1)),t("div",Fe,[se(p(((d=o.value)==null?void 0:d.destinationName)||"-")+" ",1),(l=o.value)!=null&&l.destinationAddress?(f(),g("div",De,p(o.value.destinationAddress),1)):q("",!0)])])]),t("div",Ie,[t("div",null,[e[4]||(e[4]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะเวลาโดยประมาณ",-1)),t("div",Pe,p(((x=o.value)==null?void 0:x.durationText)||"-"),1)]),t("div",null,[e[5]||(e[5]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ระยะทางโดยประมาณ",-1)),t("div",Ve,p(((b=o.value)==null?void 0:b.distanceText)||"-"),1)])])]),t("section",null,[e[7]||(e[7]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"จุดแวะระหว่างทาง",-1)),t("div",je,[(c=(v=o.value)==null?void 0:v.stops)!=null&&c.length?(f(),g("ul",Ge,[(f(!0),g(U,null,W(o.value.stops,(A,L)=>(f(),g("li",{key:L},"• "+p(A),1))),128))])):(f(),g("div",Oe,"— ไม่มีจุดแวะ —"))])]),t("section",null,[e[11]||(e[11]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เวลา ราคา และความพร้อมที่นั่ง",-1)),t("div",qe,[t("div",null,[e[8]||(e[8]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วัน-เวลาออกเดินทาง",-1)),t("div",Ue,[t("div",We,p(((_=o.value)==null?void 0:_.date)||"-")+" "+p(((h=o.value)==null?void 0:h.departureTime)||""),1)])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ราคา/ที่นั่ง",-1)),t("div",Je,p(((w=o.value)==null?void 0:w.price)!=null?`${o.value.price} บาท`:"-"),1)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ที่นั่งคงเหลือ",-1)),t("div",Ke,p(((r=o.value)==null?void 0:r.availableSeats)!=null?o.value.availableSeats:"-"),1)])])]),t("section",null,[e[14]||(e[14]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ผู้ขับขี่",-1)),t("div",Qe,[t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ขับ",-1)),t("div",Xe,p(((D=(F=o.value)==null?void 0:F.driver)==null?void 0:D.name)||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"การยืนยันตัวตน",-1)),t("div",Ye,p((m=(u=o.value)==null?void 0:u.driver)!=null&&m.isVerified?"ยืนยันแล้ว":"ยังไม่ยืนยัน"),1)])])]),t("section",null,[e[15]||(e[15]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รายละเอียดรถ",-1)),t("div",Ze,[(P=(I=o.value)==null?void 0:I.carDetails)!=null&&P.length?(f(),g("ul",et,[(f(!0),g(U,null,W(o.value.carDetails,(A,L)=>(f(),g("li",{key:L},"• "+p(A),1))),128))])):(f(),g("div",tt,"— ไม่มีข้อมูลรถ —"))])]),(k=o.value)!=null&&k.conditions?(f(),g("section",st,[e[16]||(e[16]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"เงื่อนไขการเดินทาง",-1)),t("div",ot,p(o.value.conditions),1)])):q("",!0),t("section",null,[e[18]||(e[18]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"รูปภาพรถยนต์",-1)),t("div",lt,[(Y=(B=o.value)==null?void 0:B.photos)!=null&&Y.length?(f(!0),g(U,{key:0},W(o.value.photos.slice(0,3),(A,L)=>(f(),g("div",{key:L},[t("img",{src:A,alt:"Vehicle",class:"object-cover w-full transition-opacity border border-gray-300 rounded-lg shadow-sm aspect-video hover:opacity-90"},null,8,rt)]))),128)):(f(),g("div",at,e[17]||(e[17]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"ไม่มีรูป",-1)])))])]),t("section",null,[e[21]||(e[21]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ระบบ",-1)),t("div",nt,[t("div",null,[e[19]||(e[19]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สร้างเมื่อ",-1)),t("div",it,p(K((Z=o.value)==null?void 0:Z.createdAt,!0)),1)]),t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ปรับปรุงล่าสุด",-1)),t("div",dt,p(K((ee=o.value)==null?void 0:ee.updatedAt,!0)),1)])])])])]))])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:ie})])}}};export{wt as default};
