import{_ as S}from"./Lcixqshc.js";import{_ as q,r as b,x as F,i as O,H as J,c as u,o as f,a as e,b as p,g as y,w as x,f as k,F as K,q as G,n as Q,t as w,d as A,T as W,l as $,y as C,J as B}from"./DPSIKoxe.js";import{u as j}from"./DOK8vhV6.js";const X={class:"fixed top-0 left-0 right-0 z-50 h-16 bg-white border border-gray-300 shadow-sm"},Y={class:"flex items-center justify-between h-full px-4"},Z={class:"flex items-center gap-4"},ee={class:"relative"},te=["aria-expanded"],se={key:0,class:"absolute w-2 h-2 bg-red-500 rounded-full -top-1 -right-1"},ae={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},le={class:"max-h-[56vh] overflow-y-auto"},ne={key:0,class:"px-4 py-8 text-sm text-center text-gray-500"},oe={key:1,class:"px-4 py-4 text-sm text-gray-500"},ie={class:"px-4 py-3 hover:bg-gray-50"},re={class:"flex items-start gap-3"},de={class:"flex-1 min-w-0"},ce={class:"text-sm font-medium text-gray-900 truncate"},ue={class:"text-sm text-gray-600 line-clamp-2"},fe={class:"mt-1 text-xs text-gray-400"},ge={class:"relative shrink-0"},me=["onClick","aria-expanded"],pe=["onClick"],xe=["onClick"],ve={key:0,class:"mx-4 border-t border-gray-200"},be={class:"px-4 py-3 bg-white border-t border-gray-200"},ye={class:"flex items-center gap-3"},he={class:"hidden text-sm text-gray-700 md:block"},we={__name:"AdminHeader",setup(D){const{token:r,user:c}=j();function _(){const l=document.getElementById("sidebar"),t=document.getElementById("overlay");!l||!t||(l.classList.toggle("mobile-open"),t.classList.toggle("hidden"))}const o=b(!1),s=b(null),n=b(!1),h=b(null),L=b(null),d=b([]),R=F(()=>d.value.filter(l=>!l.adminReviewedAt).length);function z(){o.value=!o.value,o.value||(s.value=null)}async function V(){z(),o.value&&d.value.length===0&&await I()}async function I(){var l;try{if(!(c!=null&&c.value)||String(c.value.role).toUpperCase()!=="ADMIN")return;n.value=!0;const t=C().public.apiBase||"http://localhost:3000/api",i=((l=B("token"))==null?void 0:l.value)||(r==null?void 0:r.value)||localStorage.getItem("token"),a=await $fetch("/notifications/admin",{baseURL:t,headers:{Accept:"application/json",...i?{Authorization:`Bearer ${i}`}:{}},query:{page:1,limit:20}}),v=(Array.isArray(a==null?void 0:a.data)?a.data:[]).filter(m=>{var M;return(((M=m==null?void 0:m.metadata)==null?void 0:M.initiatedBy)||"").toLowerCase()==="user"});d.value=v.map(m=>({id:m.id,title:m.title||"-",body:m.body||"",createdAt:m.createdAt||Date.now(),adminReviewedAt:m.adminReviewedAt||null}))}catch(t){console.error(t),d.value=[]}finally{n.value=!1}}function T(l){s.value=s.value===l?null:l}async function H(l){var t;try{const i=C().public.apiBase||"http://localhost:3000/api",a=((t=B("token"))==null?void 0:t.value)||(r==null?void 0:r.value)||localStorage.getItem("token");await fetch(`${i}/notifications/admin/${l.id}/read`,{method:"PATCH",headers:{Accept:"application/json",...a?{Authorization:`Bearer ${a}`}:{}},credentials:"include"}).catch(()=>{});const g=d.value.findIndex(v=>v.id===l.id);g>-1&&(d.value[g].adminReviewedAt=new Date().toISOString())}finally{s.value=null}}async function U(l){var t;try{const i=C().public.apiBase||"http://localhost:3000/api",a=((t=B("token"))==null?void 0:t.value)||(r==null?void 0:r.value)||localStorage.getItem("token");await fetch(`${i}/notifications/admin/${l.id}`,{method:"DELETE",headers:{Accept:"application/json",...a?{Authorization:`Bearer ${a}`}:{}},credentials:"include"}).catch(()=>{}),d.value=d.value.filter(g=>g.id!==l.id)}finally{s.value=null}}function N(l){var i,a;if(!o.value)return;const t=l.target;(i=L.value)!=null&&i.contains(t)||(a=h.value)!=null&&a.contains(t)||(o.value=!1,s.value=null)}function E(l){l.key==="Escape"&&(o.value=!1,s.value=null)}O(()=>{var l;document.addEventListener("click",N),document.addEventListener("keydown",E),String(((l=c==null?void 0:c.value)==null?void 0:l.role)||"").toUpperCase()==="ADMIN"&&I()}),J(()=>{document.removeEventListener("click",N),document.removeEventListener("keydown",E)});function P(l){const t=Date.now()-new Date(l).getTime(),i=Math.floor(t/6e4);if(i<1)return"just now";if(i<60)return`${i} min ago`;const a=Math.floor(i/60);return a<24?`${a} hr ago`:`${Math.floor(a/24)} d ago`}return(l,t)=>{const i=S;return f(),u("header",X,[e("div",Y,[e("div",{class:"flex items-center gap-4"},[e("button",{onClick:_,class:"text-gray-600 lg:hidden hover:text-blue-600"},t[4]||(t[4]=[e("i",{class:"text-xl fas fa-bars"},null,-1)])),t[5]||(t[5]=e("div",{class:"flex items-center gap-2"},[e("div",{class:"flex items-center justify-center w-8 h-8 bg-blue-600 rounded"},[e("i",{class:"text-white fas fa-chart-line"})]),e("span",{class:"text-xl font-semibold text-gray-800"},"PNNAdmin")],-1))]),e("div",Z,[e("div",ee,[e("button",{ref_key:"bellBtn",ref:h,class:"relative text-gray-600 hover:text-blue-600",onClick:V,"aria-haspopup":"true","aria-expanded":o.value?"true":"false"},[t[6]||(t[6]=e("i",{class:"text-xl fas fa-bell"},null,-1)),R.value>0?(f(),u("span",se)):y("",!0)],8,te),p(W,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-100 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:x(()=>[o.value?(f(),u("div",{key:0,ref_key:"notifPanel",ref:L,class:"absolute top-full right-0 mt-3 w-[360px] max-w-[90vw] max-h-[70vh] bg-white border border-gray-200 rounded-2xl shadow-xl overflow-hidden z-[60] origin-top",onClick:t[3]||(t[3]=k(()=>{},["stop"]))},[e("div",ae,[t[8]||(t[8]=e("h3",{class:"text-lg font-semibold text-gray-800"},"Notification",-1)),e("button",{class:"p-1 text-gray-500 hover:text-gray-700",onClick:t[0]||(t[0]=a=>o.value=!1)},t[7]||(t[7]=[e("i",{class:"fa-solid fa-xmark"},null,-1)]))]),e("div",le,[d.value.length===0&&!n.value?(f(),u("div",ne," ไม่มีการแจ้งเตือน ")):y("",!0),n.value?(f(),u("div",oe,"กำลังโหลด…")):y("",!0),(f(!0),u(K,null,G(d.value,(a,g)=>(f(),u("div",{key:a.id||g,class:"relative"},[e("div",ie,[e("div",re,[e("span",{class:Q(["inline-block w-2 h-2 mt-1 rounded-full",a.adminReviewedAt?"bg-gray-300":"bg-emerald-500"])},null,2),e("div",de,[e("p",ce,w(a.title),1),e("p",ue,w(a.body),1),e("p",fe,w(P(a.createdAt)),1)]),e("div",ge,[e("button",{class:"p-1.5 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100",onClick:k(v=>T(a.id),["stop"]),"aria-haspopup":"true","aria-expanded":s.value===a.id?"true":"false"},t[9]||(t[9]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)]),8,me),s.value===a.id?(f(),u("div",{key:0,class:"absolute right-0 top-8 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-[70]",onClick:t[1]||(t[1]=k(()=>{},["stop"]))},[e("button",{class:"flex items-center w-full gap-2 px-3 py-2 text-sm hover:bg-gray-50",onClick:v=>H(a)},t[10]||(t[10]=[e("i",{class:"fa-regular fa-circle-check"},null,-1),A(" ทำเครื่องหมายอ่านแล้ว ")]),8,pe),e("button",{class:"flex items-center w-full gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50",onClick:v=>U(a)},t[11]||(t[11]=[e("i",{class:"fa-regular fa-trash-can"},null,-1),A(" ลบการแจ้งเตือนนี้ ")]),8,xe)])):y("",!0)])])]),g!==d.value.length-1?(f(),u("div",ve)):y("",!0)]))),128))]),e("div",be,[p(i,{to:"/admin/notifications",class:"block w-full px-4 py-2 text-sm font-medium text-center text-blue-700 rounded-lg bg-blue-50 hover:bg-blue-100",onClick:t[2]||(t[2]=a=>o.value=!1)},{default:x(()=>t[12]||(t[12]=[A(" View All Notification ")])),_:1,__:[12]})])],512)):y("",!0)]),_:1})]),e("div",ye,[e("span",he,w($(c).firstName),1),t[13]||(t[13]=e("div",{class:"flex items-center justify-center w-10 h-10 bg-blue-600 rounded-full"},[e("i",{class:"w-6 text-lg text-center text-white fas fa-user"})],-1))])])])])}}},Ne=q(we,[["__scopeId","data-v-00484687"]]),_e={id:"sidebar",class:"fixed bottom-0 left-0 bg-white shadow-lg sidebar top-16"},ke={class:"py-4"},Ae={class:"px-3 space-y-1"},Ce={class:"group"},Be={id:"ecom-menu",class:"hidden mt-1 ml-12 space-y-1 sidebar-text"},Ee={__name:"AdminSidebar",setup(D){const{logout:r}=j();function c(){const o=document.getElementById("sidebar"),s=document.getElementById("main-content"),n=document.getElementById("toggle-icon");!o||!s||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(s.style.marginLeft="80px",n&&n.classList.replace("fa-chevron-left","fa-chevron-right")):(s.style.marginLeft="280px",n&&n.classList.replace("fa-chevron-right","fa-chevron-left")))}function _(o){const s=document.getElementById(o),n=document.getElementById(o+"-icon");!s||!n||(s.classList.toggle("hidden"),n.classList.toggle("fa-chevron-down"),n.classList.toggle("fa-chevron-up"))}return(o,s)=>{const n=S;return f(),u("aside",_e,[e("div",ke,[e("button",{onClick:c,class:"absolute flex items-center justify-center hidden w-6 h-6 transition-colors bg-white rounded-full shadow-md lg:block -right-3 top-6 hover:bg-blue-600 hover:text-white"},s[2]||(s[2]=[e("i",{class:"text-xs fas fa-chevron-left",id:"toggle-icon"},null,-1)])),e("nav",Ae,[p(n,{to:"/admin/users",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50"},{default:x(()=>s[3]||(s[3]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-user"},null,-1),e("span",{class:"sidebar-text"},"User Management",-1)])),_:1,__:[3]}),p(n,{to:"/admin/vehicles",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50","active-class":"font-semibold text-blue-600 bg-blue-50"},{default:x(()=>s[4]||(s[4]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-car-side"},null,-1),e("span",{class:"sidebar-text"},"Vehicle Management",-1)])),_:1,__:[4]}),p(n,{to:"/admin/routes",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50","active-class":"font-semibold text-blue-600 bg-blue-50"},{default:x(()=>s[5]||(s[5]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-route"},null,-1),e("span",{class:"sidebar-text"},"Route Management",-1)])),_:1,__:[5]}),p(n,{to:"/admin/bookings",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50","active-class":"font-semibold text-blue-600 bg-blue-50"},{default:x(()=>s[6]||(s[6]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-calendar-check"},null,-1),e("span",{class:"sidebar-text"},"Booking Management",-1)])),_:1,__:[6]}),p(n,{to:"/admin/driver-verifications",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50","active-class":"font-semibold text-blue-600 bg-blue-50"},{default:x(()=>s[7]||(s[7]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-id-card"},null,-1),e("span",{class:"sidebar-text"},"Driver Verification Management",-1)])),_:1,__:[7]}),p(n,{to:"/",class:"sidebar-item flex items-center gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50"},{default:x(()=>s[8]||(s[8]=[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-home"},null,-1),e("span",{class:"sidebar-text"},"Home",-1)])),_:1,__:[8]}),e("div",Ce,[e("button",{onClick:s[0]||(s[0]=h=>_("ecom-menu")),class:"sidebar-item w-full flex items-center justify-between gap-3 px-3 py-2.5 text-gray-700 rounded-lg hover:bg-blue-50"},s[9]||(s[9]=[e("div",{class:"flex items-center gap-3"},[e("i",{class:"w-6 text-lg text-center text-gray-500 fas fa-gear"}),e("span",{class:"sidebar-text"},"Setting")],-1),e("i",{class:"text-xs transition-transform fas fa-chevron-down sidebar-text",id:"ecom-menu-icon"},null,-1)])),e("div",Be,[e("button",{onClick:s[1]||(s[1]=(...h)=>$(r)&&$(r)(...h)),class:"block px-3 py-2 text-sm text-gray-600 hover:text-blue-600"}," Logout ")])])])])])}}};export{Ne as A,Ee as _};
