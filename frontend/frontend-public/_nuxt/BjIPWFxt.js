import{_ as R}from"./Lcixqshc.js";import{A as P,r as g,i as V,H as A,c as m,b as y,a as t,w as D,h as i,v as d,z as N,g as M,d as z,s as H,J as _,y as $,C as j,o as p}from"./DPSIKoxe.js";import{A as F,_ as T}from"./CaCOxDSn.js";import{u as G}from"./BaxiziUg.js";import"./DOK8vhV6.js";const O={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},q={class:"mb-8"},J={class:"mx-auto max-w-8xl"},W={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},Z={class:"grid grid-cols-1 gap-6 p-4 sm:p-6"},K={class:"w-full max-w-[80rem] mx-auto space-y-6"},Q={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},X={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Y={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ee={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},te={key:0,class:"flex items-center justify-center"},se=["src"],le={key:1,class:"text-gray-500"},oe={key:0,class:"flex items-center justify-center"},ne=["src"],re={key:1,class:"text-gray-500"},ie={class:"flex items-center justify-end gap-2 px-4 py-4 border-t border-gray-200 sm:px-6"},ae=["disabled"],de={key:0,class:"w-4 h-4 mr-1 -ml-1 animate-spin",viewBox:"0 0 24 24"},ce={__name:"create",setup(ue){const{toast:f}=H(),s=P({email:"",username:"",password:"",firstName:"",lastName:"",phoneNumber:"",gender:"",role:"PASSENGER",nationalIdNumber:"",nationalIdExpiryDate:"",nationalIdPhotoUrl:null,selfiePhotoUrl:null}),b=g(!1),c=g(null),x=g(null),v=g(null),w=g(null);G({});function U(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.remove("mobile-open"),e.classList.add("hidden"))}function L(){window.toggleSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("toggle-icon");!o||!e||(o.classList.toggle("collapsed"),o.classList.contains("collapsed")?(e.style.marginLeft="80px",n&&n.classList.replace("fa-chevron-left","fa-chevron-right")):(e.style.marginLeft="280px",n&&n.classList.replace("fa-chevron-right","fa-chevron-left")))},window.toggleMobileSidebar=function(){const o=document.getElementById("sidebar"),e=document.getElementById("overlay");!o||!e||(o.classList.toggle("mobile-open"),e.classList.toggle("hidden"))},window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),e=document.getElementById("main-content"),n=document.getElementById("overlay");!o||!e||!n||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),n.classList.add("hidden"),e.style.marginLeft=o.classList.contains("collapsed")?"80px":"280px"):e.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function S(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.toggleSidebar,delete window.toggleMobileSidebar,delete window.closeMobileSidebar,delete window.__adminResizeHandler__}V(()=>{L(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__()}),A(()=>{S()});function I(o){var e,n;o==="idCardInput"&&((e=v.value)==null||e.click()),o==="selfieInput"&&((n=w.value)==null||n.click())}function k(o,e){var r;const n=(r=o.target.files)==null?void 0:r[0];if(!n)return;const l=new FileReader;l.onload=u=>{var a,E;e==="id"?(s.nationalIdPhotoUrl=n,c.value=(a=u.target)==null?void 0:a.result):(s.selfiePhotoUrl=n,x.value=(E=u.target)==null?void 0:E.result)},l.readAsDataURL(n)}function h(o){return o?new Date(`${o}T00:00:00.000Z`).toISOString():""}async function C(o,e,n){const l=await fetch(o,{method:"POST",headers:{Accept:"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:e,credentials:"include"});let r;try{r=await l.json()}catch{const u=await l.text(),a=new Error(u||"Unexpected response from server");throw a.status=l.status,a}if(!l.ok){const u=(r==null?void 0:r.message)||`Request failed with status ${l.status}`,a=new Error(u);throw a.status=l.status,a.payload=r,a}return r}async function B(){var o;if(!s.email||!s.username||!s.password||!s.firstName||!s.lastName||!s.phoneNumber||!s.gender||!s.nationalIdNumber||!s.nationalIdExpiryDate||!s.nationalIdPhotoUrl||!s.selfiePhotoUrl){f.error("กรอกข้อมูลไม่ครบ","โปรดกรอกข้อมูลที่มี * ให้ครบถ้วน");return}b.value=!0;try{const e=new FormData;e.append("email",s.email),e.append("username",s.username),e.append("password",s.password),e.append("firstName",s.firstName),e.append("lastName",s.lastName),e.append("phoneNumber",s.phoneNumber),e.append("gender",s.gender.toUpperCase()),e.append("nationalIdNumber",s.nationalIdNumber),e.append("nationalIdExpiryDate",h(s.nationalIdExpiryDate)),e.append("nationalIdPhotoUrl",s.nationalIdPhotoUrl),e.append("selfiePhotoUrl",s.selfiePhotoUrl),e.append("role",s.role);let n="";try{n=((o=_("token"))==null?void 0:o.value)||""}catch{}n||(n=localStorage.getItem("token")||"");const l=$().public.apiBase||"http://localhost:3000/api",r=await C(`${l}/users`,e,n);f.success("สำเร็จ",(r==null?void 0:r.message)||"สร้างผู้ใช้เรียบร้อย"),j("/admin/users")}catch(e){const n=e==null?void 0:e.status,l=(e==null?void 0:e.message)||"สร้างผู้ใช้ไม่สำเร็จ";n===409?f.error("ข้อมูลซ้ำ",l):f.error("เกิดข้อผิดพลาด",l)}finally{b.value=!1}}return(o,e)=>{const n=R;return p(),m("div",null,[y(F),y(T),t("main",O,[t("div",q,[y(n,{to:"/admin/users",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:D(()=>e[14]||(e[14]=[t("i",{class:"fa-solid fa-arrow-left"},null,-1),t("span",null,"ย้อนกลับ",-1)])),_:1,__:[14]})]),t("div",J,[e[37]||(e[37]=t("div",{class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},[t("div",{class:"flex items-center gap-3"},[t("h1",{class:"text-2xl font-semibold text-gray-800"},"สร้างผู้ใช้ใหม่"),t("span",{class:"text-sm text-gray-500"},"กรอกข้อมูลให้ครบถ้วน แล้วกด “บันทึก”")])],-1)),t("div",W,[e[36]||(e[36]=t("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[t("h2",{class:"font-medium text-gray-800"},"ข้อมูลผู้ใช้")],-1)),t("div",Z,[t("div",K,[t("div",null,[e[19]||(e[19]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัญชีผู้ใช้",-1)),t("div",Q,[t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"อีเมล *",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.email=l),type:"email",placeholder:"example@email.com",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.email,void 0,{trim:!0}]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ใช้ (username) *",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.username=l),type:"text",placeholder:"user_001",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.username,void 0,{trim:!0}]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รหัสผ่าน *",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.password=l),type:"password",placeholder:"อย่างน้อย 8 ตัวอักษร",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.password]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เบอร์โทรศัพท์ *",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.phoneNumber=l),type:"tel",placeholder:"0891234567",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.phoneNumber,void 0,{trim:!0}]])])])]),t("div",null,[e[26]||(e[26]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ข้อมูลส่วนตัว",-1)),t("div",X,[t("div",null,[e[20]||(e[20]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อจริง *",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.firstName=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.firstName,void 0,{trim:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"นามสกุล *",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.lastName=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.lastName,void 0,{trim:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เพศ *",-1)),i(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.gender=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[22]||(e[22]=[t("option",{value:""},"-- เลือก --",-1),t("option",{value:"MALE"},"MALE",-1),t("option",{value:"FEMALE"},"FEMALE",-1)]),512),[[N,s.gender]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"บทบาท *",-1)),i(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.role=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},e[24]||(e[24]=[t("option",{value:"PASSENGER"},"PASSENGER",-1),t("option",{value:"DRIVER"},"DRIVER",-1),t("option",{value:"ADMIN"},"ADMIN",-1)]),512),[[N,s.role]])])])]),t("div",null,[e[29]||(e[29]=t("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัตรประชาชน",-1)),t("div",Y,[t("div",null,[e[27]||(e[27]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เลขบัตรประชาชน *",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.nationalIdNumber=l),type:"text",placeholder:"13 หลัก",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.nationalIdNumber,void 0,{trim:!0}]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วันหมดอายุบัตร *",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.nationalIdExpiryDate=l),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[d,s.nationalIdExpiryDate]])])])]),t("div",ee,[t("div",null,[e[31]||(e[31]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปบัตรประชาชน *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[10]||(e[10]=l=>I("idCardInput"))},[c.value?(p(),m("div",te,[t("img",{src:c.value,class:"rounded max-h-82"},null,8,se)])):(p(),m("div",le,e[30]||(e[30]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"idCardInput",ref:v,type:"file",accept:"image/*",class:"hidden",onChange:e[11]||(e[11]=l=>k(l,"id"))},null,544)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปถ่ายใบหน้า (Selfie) *",-1)),t("div",{class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500",onClick:e[12]||(e[12]=l=>I("selfieInput"))},[x.value?(p(),m("div",oe,[t("img",{src:x.value,class:"rounded max-h-82"},null,8,ne)])):(p(),m("div",re,e[32]||(e[32]=[t("i",{class:"text-3xl fa-regular fa-image"},null,-1),t("p",{class:"mt-1 text-sm"},"กดเพื่อเลือกรูปภาพ",-1)])))]),t("input",{ref_key:"selfieInput",ref:w,type:"file",accept:"image/*",class:"hidden",onChange:e[13]||(e[13]=l=>k(l,"selfie"))},null,544)])])])]),t("div",ie,[t("button",{onClick:B,disabled:b.value,class:"inline-flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed"},[b.value?(p(),m("svg",de,e[34]||(e[34]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"white","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{d:"M4 12a8 8 0 018-8",fill:"white",opacity:"0.75"},null,-1)]))):M("",!0),e[35]||(e[35]=z(" บันทึก "))],8,ae)])])])]),t("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:U})])}}};export{ce as default};
