import{m as M,D as F,r as i,i as $,c as r,a as t,g as b,h as v,z as w,l as s,e as C,t as n,F as U,q as T,d as S,n as N,v as G,s as W,o as d}from"./DPSIKoxe.js";import{u as j}from"./DOK8vhV6.js";const z={class:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},Y={class:"max-w-6xl mx-auto"},q={class:"mb-8"},J={class:"bg-white rounded-lg shadow p-4 grid grid-cols-1 md:grid-cols-3 gap-4"},K={key:0,class:"text-center py-12"},Q={key:1,class:"p-4 bg-red-50 border border-red-200 rounded-lg mb-4"},X={class:"text-red-800"},Z={key:2,class:"bg-white rounded-lg shadow-md p-8 text-center"},tt={key:3,class:"bg-white rounded-lg shadow-md overflow-hidden"},et={class:"w-full"},st={class:"divide-y"},ot={class:"px-6 py-4 text-sm text-gray-900 font-medium"},lt={class:"px-6 py-4 text-sm text-gray-600"},at={class:"px-6 py-4 text-sm text-gray-600"},nt={class:"px-6 py-4"},rt={class:"px-6 py-4 text-sm text-gray-600"},dt={class:"px-6 py-4"},it=["onClick"],ut={key:4,class:"mt-8 flex justify-center gap-2"},pt=["onClick"],gt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},mt={class:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-96 overflow-y-auto"},ct={class:"p-6"},xt={class:"flex justify-between items-start mb-4"},yt={class:"text-2xl font-bold text-gray-900"},bt={class:"text-sm text-gray-600 mt-1"},vt={class:"font-medium"},ft={class:"mb-4"},Et={class:"text-gray-700"},_t={class:"grid grid-cols-2 gap-4 mb-4 p-3 bg-gray-50 rounded"},ht={class:"text-sm text-gray-800"},wt={class:"text-xs"},St={key:0},Nt={class:"text-sm text-gray-800"},Rt={class:"text-xs"},It={class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded"},Dt={class:"space-y-3"},Vt=["disabled"],At={key:0,class:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded"},kt={class:"text-sm text-gray-800 mt-1"},Ot={__name:"index",setup(Ct){var k;const{$api:R}=M(),O=F(),{user:P}=j(),f=W();((k=P.value)==null?void 0:k.role)!=="ADMIN"&&O.push("/");const E=i([]),_=i(!0),g=i(""),m=i(1),c=i(null),a=i(null),x=i(!1),u=i({status:"",type:""}),p=i({status:"PENDING",adminNotes:""}),h=async()=>{var l,e;try{_.value=!0,g.value="";let o=`/incidents/admin/all?page=${m.value}&limit=10`;u.value.status&&(o+=`&status=${u.value.status}`),u.value.type&&(o+=`&type=${u.value.type}`);const y=await R.get(o);E.value=y.data,c.value=y.pagination}catch(o){g.value=((e=(l=o.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to load incidents",f.addToast(g.value,"error")}finally{_.value=!1}},I=()=>{m.value=1,h()},L=l=>{a.value=l,p.value={status:l.status,adminNotes:l.adminNotes||""}},B=async()=>{var l,e;try{x.value=!0,await R.patch(`/incidents/admin/${a.value.id}/status`,{status:p.value.status,adminNotes:p.value.adminNotes}),f.addToast("Incident status updated successfully","success"),a.value=null,h()}catch(o){f.addToast(((e=(l=o.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to update incident","error")}finally{x.value=!1}},D=l=>({DRIVER_BEHAVIOR:"Driver Behavior",PASSENGER_BEHAVIOR:"Passenger Behavior",SAFETY_ISSUE:"Safety Issue",VEHICLE_ISSUE:"Vehicle Issue",HARASSMENT:"Harassment",OTHER:"Other"})[l]||l,V=l=>({PENDING:"Pending Review",REVIEWED:"Under Review",RESOLVED:"Resolved",CLOSED:"Closed"})[l]||l,A=l=>({PENDING:"bg-yellow-100 text-yellow-800",REVIEWED:"bg-blue-100 text-blue-800",RESOLVED:"bg-green-100 text-green-800",CLOSED:"bg-gray-100 text-gray-800"})[l]||"bg-gray-100 text-gray-800",H=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return $(()=>{h()}),(l,e)=>(d(),r("div",z,[t("div",Y,[t("div",q,[e[9]||(e[9]=t("h1",{class:"text-3xl font-bold text-gray-900 mb-4"},"Incident Management",-1)),t("div",J,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>s(u).status=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},e[5]||(e[5]=[C('<option value="">All Statuses</option><option value="PENDING">Pending Review</option><option value="REVIEWED">Under Review</option><option value="RESOLVED">Resolved</option><option value="CLOSED">Closed</option>',5)]),512),[[w,s(u).status]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type",-1)),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>s(u).type=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},e[7]||(e[7]=[C('<option value="">All Types</option><option value="DRIVER_BEHAVIOR">Driver Behavior</option><option value="PASSENGER_BEHAVIOR">Passenger Behavior</option><option value="SAFETY_ISSUE">Safety Issue</option><option value="VEHICLE_ISSUE">Vehicle Issue</option><option value="HARASSMENT">Harassment</option><option value="OTHER">Other</option>',7)]),512),[[w,s(u).type]])]),t("div",{class:"flex items-end"},[t("button",{onClick:I,class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition"}," Apply Filters ")])])]),s(_)?(d(),r("div",K,e[10]||(e[10]=[t("p",{class:"text-gray-600"},"Loading incidents...",-1)]))):s(g)?(d(),r("div",Q,[t("p",X,n(s(g)),1)])):s(E).length===0?(d(),r("div",Z,e[11]||(e[11]=[t("p",{class:"text-gray-600"},"No incidents found.",-1)]))):(d(),r("div",tt,[t("table",et,[e[12]||(e[12]=t("thead",{class:"bg-gray-100 border-b"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Title"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Type"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Reporter"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Status"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Date"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-900"},"Actions")])],-1)),t("tbody",st,[(d(!0),r(U,null,T(s(E),o=>(d(),r("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",ot,n(o.title),1),t("td",lt,n(D(o.type)),1),t("td",at,n(o.reporter.username),1),t("td",nt,[t("span",{class:N([A(o.status),"px-3 py-1 rounded-full text-xs font-medium"])},n(V(o.status)),3)]),t("td",rt,n(H(o.createdAt)),1),t("td",dt,[t("button",{onClick:y=>L(o),class:"text-blue-600 hover:text-blue-800 font-medium text-sm"}," View Details ",8,it)])]))),128))])])])),s(c)&&s(c).totalPages>1?(d(),r("div",ut,[(d(!0),r(U,null,T(s(c).totalPages,o=>(d(),r("button",{key:o,onClick:y=>{m.value=o,I()},class:N([s(m)===o?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-300","px-4 py-2 rounded-lg font-medium transition"])},n(o),11,pt))),128))])):b("",!0)]),s(a)?(d(),r("div",gt,[t("div",mt,[t("div",ct,[t("div",xt,[t("div",null,[t("h2",yt,n(s(a).title),1),t("p",bt,[e[13]||(e[13]=S(" Type: ")),t("span",vt,n(D(s(a).type)),1)])]),t("span",{class:N([A(s(a).status),"px-3 py-1 rounded-full text-sm font-medium"])},n(V(s(a).status)),3)]),t("div",ft,[e[14]||(e[14]=t("h3",{class:"font-semibold text-gray-900 mb-2"},"Description:",-1)),t("p",Et,n(s(a).description),1)]),t("div",_t,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-sm text-gray-600"},[t("strong",null,"Reporter:")],-1)),t("p",ht,[S(n(s(a).reporter.firstName)+" "+n(s(a).reporter.lastName)+" ",1),e[15]||(e[15]=t("br",null,null,-1)),t("span",wt,"("+n(s(a).reporter.username)+")",1)])]),s(a).reportedUser?(d(),r("div",St,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-600"},[t("strong",null,"Against:")],-1)),t("p",Nt,[S(n(s(a).reportedUser.firstName)+" "+n(s(a).reportedUser.lastName)+" ",1),e[17]||(e[17]=t("br",null,null,-1)),t("span",Rt,"("+n(s(a).reportedUser.username)+")",1)])])):b("",!0)]),t("div",It,[e[20]||(e[20]=t("h3",{class:"font-semibold text-gray-900 mb-3"},"Update Status:",-1)),t("div",Dt,[v(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>s(p).status=o),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},e[19]||(e[19]=[t("option",{value:"PENDING"},"Pending Review",-1),t("option",{value:"REVIEWED"},"Under Review",-1),t("option",{value:"RESOLVED"},"Resolved",-1),t("option",{value:"CLOSED"},"Closed",-1)]),512),[[w,s(p).status]]),v(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>s(p).adminNotes=o),placeholder:"Add admin notes (optional)",rows:"3",maxlength:"1000",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,512),[[G,s(p).adminNotes]]),t("button",{onClick:B,disabled:s(x),class:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition"},n(s(x)?"Updating...":"Update Status"),9,Vt)])]),s(a).adminNotes?(d(),r("div",At,[e[21]||(e[21]=t("p",{class:"text-sm text-gray-600"},[t("strong",null,"Admin Notes:")],-1)),t("p",kt,n(s(a).adminNotes),1)])):b("",!0),t("button",{onClick:e[4]||(e[4]=o=>a.value=null),class:"w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-medium py-2 px-4 rounded-lg transition"}," Close ")])])])):b("",!0)]))}};export{Ot as default};
