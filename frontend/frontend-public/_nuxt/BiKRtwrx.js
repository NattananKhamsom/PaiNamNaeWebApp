import{_ as M}from"./Lcixqshc.js";import{a5 as j,r as b,x as H,i as $,H as Y,c as u,b as k,a as e,w as X,g as E,n as J,t as i,h as O,z as q,e as G,v as K,l as W,y as I,J as B,s as Q,o as c}from"./DPSIKoxe.js";import{u as Z}from"./BaxiziUg.js";import{d as S}from"./B5yDJBm8.js";import{A as ee,_ as te}from"./CaCOxDSn.js";import"./Cpj98o6Y.js";import"./DOK8vhV6.js";const se={id:"main-content",class:"main-content mt-16 ml-0 lg:ml-[280px] p-6"},oe={class:"mb-8"},ae={class:"mx-auto max-w-8xl"},le={class:"flex flex-col gap-3 mb-6 sm:flex-row sm:items-center sm:justify-between"},re={key:0,class:"flex items-center gap-2"},ie={class:"inline-flex items-center cursor-pointer select-none switch"},ne=["checked","disabled"],de={class:"bg-white border border-gray-300 rounded-lg shadow-sm"},ue={key:0,class:"p-8 text-center text-gray-500"},ce={key:1,class:"p-8 text-center text-red-600"},me={key:2,class:"grid grid-cols-1 gap-6 p-4 sm:p-6 text-[15px]"},ge={class:"w-full max-w-[80rem] mx-auto space-y-6"},be={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ye={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},fe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},pe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},xe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},ve={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},_e={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},we={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},he={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},ke={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ee={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Ie={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Be={class:"grid grid-cols-1 gap-6 mt-4 sm:grid-cols-2"},Se={class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md bg-gray-50"},Ve={key:0,class:"flex items-center justify-center"},Ce=["href"],Re=["src"],Le={key:1,class:"text-gray-500"},Oe={class:"p-4 text-center border-2 border-gray-300 border-dashed rounded-md bg-gray-50"},Ae={key:0,class:"flex items-center justify-center"},De=["href"],Ne=["src"],Ue={key:1,class:"text-gray-500"},Fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Pe={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},Te={class:"w-full px-3 py-2.5 border border-gray-300 rounded-md bg-gray-50 text-gray-900"},ze={class:"pt-6 mt-4 border-t border-gray-200"},Me={class:"flex items-center justify-between px-4 mb-3 sm:px-0"},je={key:0,class:"text-xs text-gray-500"},He={class:"grid grid-cols-1 gap-4"},$e={key:0},Ye={class:"flex items-center justify-end gap-2"},Xe=["disabled"],Je=["disabled"],qe="VERIFICATION",Ge="ยืนยันตัวตนไม่สำเร็จ",Ke="/profile/verification",We="system",rt={__name:"index",setup(Qe){S.locale("th"),Z({});const V=j(),{toast:f}=Q(),_=b(!0),p=b(""),w=b(!1),s=b(null),x=b(!1),g=b(""),v=b(""),A={VERIFY_FAIL_DOC:"ข้อมูลบัตรประชาชน/รูปถ่ายของคุณไม่ผ่านการตรวจสอบ กรุณาตรวจสอบและส่งใหม่อีกครั้ง",VERIFY_FAIL_SELFIE:"รูปถ่ายใบหน้าไม่ชัดเจน กรุณาถ่ายใหม่ให้เห็นใบหน้าชัดเจนและไม่มีแสงสะท้อน",VERIFY_APPROVED:"การยืนยันตัวตนเสร็จสมบูรณ์ ขอบคุณที่ให้ความร่วมมือ",DOC_EXPIRE_SOON:"บัตรประชาชนของคุณใกล้หมดอายุ กรุณาอัปเดตข้อมูลเพื่อใช้งานได้ต่อเนื่อง"},C=H(()=>g.value==="CUSTOM"?(v.value||"").trim():A[g.value]||"");function R(){g.value="",v.value=""}function D(){g.value!=="CUSTOM"&&(v.value="")}async function N(){var t;if(!s.value)return;const o=C.value;if(o){x.value=!0;try{const a=I().public.apiBase,l=((t=B("token"))==null?void 0:t.value)||localStorage.getItem("token"),y={userId:s.value.id,type:qe,title:Ge,body:o,link:Ke,metadata:{kind:"user_verification",userId:s.value.id,initiatedBy:We}},r=await fetch(`${a}/notifications/admin`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...l?{Authorization:`Bearer ${l}`}:{}},body:JSON.stringify(y),credentials:"include"});let n;try{n=await r.json()}catch{const d=await r.text(),m=new Error(d||"Unexpected response from server");throw m.status=r.status,m}if(!r.ok){const d=new Error((n==null?void 0:n.message)||`Request failed with status ${r.status}`);throw d.status=r.status,d.payload=n,d}f.success("ส่งการแจ้งเตือนแล้ว","ผู้ใช้จะได้รับการแจ้งเตือนในระบบ"),R()}catch(a){console.error(a),f.error("ส่งการแจ้งเตือนไม่สำเร็จ",(a==null?void 0:a.message)||"เกิดข้อผิดพลาด")}finally{x.value=!1}}}function h(o,t=!1){return o?t?S(o).format("D MMM BBBB HH:mm"):S(o).format("D MMM BBBB"):"-"}async function U(){var o,t;_.value=!0,p.value="";try{const a=V.params.id,l=I(),y=((o=B("token"))==null?void 0:o.value)||localStorage.getItem("token"),r=await $fetch(`/users/admin/${a}`,{baseURL:l.public.apiBase,headers:{Accept:"application/json",...y?{Authorization:`Bearer ${y}`}:{}}});s.value=(r==null?void 0:r.data)||null}catch(a){console.error(a),p.value=((t=a==null?void 0:a.data)==null?void 0:t.message)||"ไม่สามารถโหลดข้อมูลผู้ใช้ได้",f.error("เกิดข้อผิดพลาด",p.value)}finally{_.value=!1}}async function F(o){var a;if(!s.value)return;const t=!!s.value.isVerified;if(t!==o){s.value.isVerified=o,w.value=!0;try{const l=V.params.id,y=I().public.apiBase;let r=((a=B("token"))==null?void 0:a.value)||localStorage.getItem("token");const n=await fetch(`${y}/users/admin/${l}/status`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify({isVerified:o}),credentials:"include"});let d;try{d=await n.json()}catch{const m=await n.text(),L=new Error(m||"Unexpected response from server");throw L.status=n.status,L}if(!n.ok){const m=new Error((d==null?void 0:d.message)||`Request failed with status ${n.status}`);throw m.status=n.status,m.payload=d,m}f.success("อัปเดตการยืนยันแล้ว",o?"ยืนยันผู้ใช้สำเร็จ":"ยกเลิกการยืนยันผู้ใช้สำเร็จ")}catch(l){console.error(l),s.value.isVerified=t,f.error("ไม่สามารถอัปเดตสถานะยืนยันได้",(l==null?void 0:l.message)||"เกิดข้อผิดพลาด")}finally{w.value=!1}}}function P(){const o=document.getElementById("sidebar"),t=document.getElementById("overlay");!o||!t||(o.classList.remove("mobile-open"),t.classList.add("hidden"))}function T(){window.__adminResizeHandler__=function(){const o=document.getElementById("sidebar"),t=document.getElementById("main-content"),a=document.getElementById("overlay");!o||!t||!a||(window.innerWidth>=1024?(o.classList.remove("mobile-open"),a.classList.add("hidden"),t.style.marginLeft=o.classList.contains("collapsed")?"80px":"280px"):t.style.marginLeft="0")},window.addEventListener("resize",window.__adminResizeHandler__)}function z(){window.removeEventListener("resize",window.__adminResizeHandler__||(()=>{})),delete window.__adminResizeHandler__}return $(async()=>{T(),typeof window.__adminResizeHandler__=="function"&&window.__adminResizeHandler__(),await U()}),Y(()=>z()),(o,t)=>{const a=M;return c(),u("div",null,[k(ee),k(te),e("main",se,[e("div",oe,[k(a,{to:"/admin/users",class:"inline-flex items-center gap-2 px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"},{default:X(()=>t[3]||(t[3]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),e("span",null,"ย้อนกลับ",-1)])),_:1,__:[3]})]),e("div",ae,[e("div",le,[t[5]||(t[5]=e("div",{class:"flex items-center gap-3"},[e("h1",{class:"text-2xl font-semibold text-gray-800"},"รายละเอียดผู้ใช้"),e("span",{class:"text-sm text-gray-500"},"ดูข้อมูลทั้งหมดของผู้ใช้งาน")],-1)),s.value?(c(),u("div",re,[e("label",ie,[e("input",{type:"checkbox",class:"switch-input",checked:s.value.isVerified,disabled:_.value||w.value,onChange:t[0]||(t[0]=l=>F(l.target.checked))},null,40,ne),t[4]||(t[4]=e("span",{class:"switch-slider"},null,-1))]),e("span",{class:J(["text-sm",s.value.isVerified?"text-green-700":"text-gray-500"])},i(s.value.isVerified?"Verified":"Unverified"),3)])):E("",!0)]),e("div",de,[t[29]||(t[29]=e("div",{class:"px-4 py-4 border-b border-gray-200 sm:px-6"},[e("h2",{class:"font-medium text-gray-800"},"ข้อมูลผู้ใช้")],-1)),_.value?(c(),u("div",ue,"กำลังโหลดข้อมูล...")):p.value?(c(),u("div",ce,i(p.value),1)):(c(),u("div",me,[e("div",ge,[e("section",null,[t[10]||(t[10]=e("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัญชีผู้ใช้",-1)),e("div",be,[e("div",null,[t[6]||(t[6]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"อีเมล",-1)),e("div",ye,i(s.value.email),1)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อผู้ใช้ (username)",-1)),e("div",fe,i(s.value.username),1)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เบอร์โทรศัพท์",-1)),e("div",pe,i(s.value.phoneNumber||"-"),1)]),e("div",null,[t[9]||(t[9]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"บทบาท",-1)),e("div",xe,i(s.value.role),1)])])]),e("section",null,[t[14]||(t[14]=e("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ข้อมูลส่วนตัว",-1)),e("div",ve,[e("div",null,[t[11]||(t[11]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ชื่อจริง",-1)),e("div",_e,i(s.value.firstName),1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"นามสกุล",-1)),e("div",we,i(s.value.lastName),1)]),e("div",null,[t[13]||(t[13]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เพศ",-1)),e("div",he,i(s.value.gender||"-"),1)])])]),e("section",null,[t[21]||(t[21]=e("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"บัตรประชาชน",-1)),e("div",ke,[e("div",null,[t[15]||(t[15]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เลขบัตรประชาชน",-1)),e("div",Ee,i(s.value.nationalIdNumber||"-"),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"วันหมดอายุบัตร",-1)),e("div",Ie,i(h(s.value.nationalIdExpiryDate)),1)])]),e("div",Be,[e("div",null,[t[18]||(t[18]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปบัตรประชาชน",-1)),e("div",Se,[s.value.nationalIdPhotoUrl?(c(),u("div",Ve,[e("a",{href:s.value.nationalIdPhotoUrl,target:"_blank",class:"block"},[e("img",{src:s.value.nationalIdPhotoUrl,alt:"National ID",class:"rounded max-h-82"},null,8,Re)],8,Ce)])):(c(),u("div",Le,t[17]||(t[17]=[e("i",{class:"text-3xl fa-regular fa-image"},null,-1),e("p",{class:"mt-1 text-sm"},"ไม่มีรูป",-1)])))])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"รูปถ่ายใบหน้า (Selfie)",-1)),e("div",Oe,[s.value.selfiePhotoUrl?(c(),u("div",Ae,[e("a",{href:s.value.selfiePhotoUrl,target:"_blank",class:"block"},[e("img",{src:s.value.selfiePhotoUrl,alt:"Selfie",class:"rounded max-h-82"},null,8,Ne)],8,De)])):(c(),u("div",Ue,t[19]||(t[19]=[e("i",{class:"text-3xl fa-regular fa-image"},null,-1),e("p",{class:"mt-1 text-sm"},"ไม่มีรูป",-1)])))])])])]),e("section",null,[t[24]||(t[24]=e("h3",{class:"mb-3 text-sm font-semibold text-gray-700"},"ระบบ",-1)),e("div",Fe,[e("div",null,[t[22]||(t[22]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"สร้างเมื่อ",-1)),e("div",Pe,i(h(s.value.createdAt,!0)),1)]),e("div",null,[t[23]||(t[23]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"ปรับปรุงล่าสุด",-1)),e("div",Te,i(h(s.value.updatedAt,!0)),1)])])]),e("section",ze,[e("div",Me,[t[25]||(t[25]=e("h3",{class:"text-base font-semibold text-gray-800"},"ส่งการแจ้งเตือนถึงผู้ใช้",-1)),x.value?(c(),u("span",je,"กำลังส่ง...")):E("",!0)]),e("div",He,[e("div",null,[t[27]||(t[27]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เลือกข้อความสำหรับผู้ใช้ (body)",-1)),O(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),onChange:D,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},t[26]||(t[26]=[G('<option value="">-- เลือก --</option><option value="VERIFY_FAIL_DOC"> ข้อมูลบัตรประชาชน/รูปถ่ายของคุณไม่ผ่านการตรวจสอบ กรุณาตรวจสอบและส่งใหม่อีกครั้ง </option><option value="VERIFY_FAIL_SELFIE"> รูปถ่ายใบหน้าไม่ชัดเจน กรุณาถ่ายใหม่ให้เห็นใบหน้าชัดเจนและไม่มีแสงสะท้อน </option><option value="VERIFY_APPROVED"> การยืนยันตัวตนเสร็จสมบูรณ์ ขอบคุณที่ให้ความร่วมมือ </option><option value="DOC_EXPIRE_SOON"> บัตรประชาชนของคุณใกล้หมดอายุ กรุณาอัปเดตข้อมูลเพื่อใช้งานได้ต่อเนื่อง </option><option value="CUSTOM">กำหนดข้อความเอง</option>',6)]),544),[[q,g.value]])]),g.value==="CUSTOM"?(c(),u("div",$e,[t[28]||(t[28]=e("label",{class:"block mb-1 text-xs font-medium text-gray-600"},"เนื้อหา (body)",-1)),O(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),rows:"3",placeholder:"พิมพ์ข้อความถึงผู้ใช้...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[K,v.value,void 0,{trim:!0}]])])):E("",!0),e("div",Ye,[e("button",{onClick:R,disabled:x.value,class:"px-3 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-60"}," ล้างฟอร์ม ",8,Xe),e("button",{onClick:N,disabled:x.value||!s.value||!W(C),class:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-400"}," ส่งการแจ้งเตือน ",8,Je)])])])])]))])])]),e("div",{id:"overlay",class:"fixed inset-0 z-40 hidden bg-black bg-opacity-50 lg:hidden",onClick:P})])}}};export{rt as default};
